<?xml version="1.0" encoding="UTF-8"?>
<dictionary>
<item key="key"><![CDATA[com.zms.sendmail]]></item>
<item key="value" type="dictionary"><dictionary>
<item key="__obj_attrs__" type="list"><list>
<item type="dictionary"><dictionary>
<item key="custom"><![CDATA[# ------------------------------------------------------------------------------
# Changes:
# 2008-10-10 [st]: Added support for smtp-authentication.
# ------------------------------------------------------------------------------

import smtplib
import os
from email.MIMEMultipart import MIMEMultipart
from email.MIMEBase import MIMEBase
from email.MIMEText import MIMEText
from email.Utils import COMMASPACE, formatdate
from email import Encoders

def send_mail(send_from, send_to, subject, text, files=[], server="localhost", send_cc=[], send_bcc=[], smtp_user=None, smtp_passwd=None):
  assert type(send_to)==list
  assert type(send_cc)==list
  assert type(send_bcc)==list
  assert type(files)==list
 
  msg = MIMEMultipart('related')
  msg['From'] = send_from
  msg['To'] = COMMASPACE.join(send_to)
  if send_cc: msg['Cc'] = COMMASPACE.join(send_cc)
  msg['Date'] = formatdate(localtime=True)
  msg['Subject'] = subject
  msg.preamble = 'This is a multi-part message in MIME format.'

  msg.attach( MIMEText(text, _subtype='html', _charset='utf-8'))

  for f in files:
    assert type(f)==dict
    part = MIMEBase('application', "octet-stream")
    part.set_payload( f['data'] )
    Encoders.encode_base64(part)
    part.add_header('Content-Disposition', 'attachment; filename="%s"' % os.path.basename(f['filename']))
    msg.attach(part)
 
  send_to = send_to + send_cc + send_bcc

  smtp = smtplib.SMTP(server)
  if smtp_user is not None:
    smtp.login(smtp_user,smtp_passwd)
  smtp.sendmail(send_from, send_to, msg.as_string())
  
  smtp.close()]]></item>
<item key="id"><![CDATA[send_mail]]></item>
<item key="mandatory" type="int">0</item>
<item key="multilang" type="int">0</item>
<item key="name"><![CDATA[send_mail]]></item>
<item key="repetitive" type="int">0</item>
<item key="type"><![CDATA[External Method]]></item>
</dictionary>
</item>
</list>
</item>
<item key="access" type="dictionary"><dictionary>
<item key="delete" type="list"><list>
</list>
</item>
<item key="delete_custom"/>
<item key="edit" type="list"><list>
</list>
</item>
<item key="edit_custom"/>
<item key="insert" type="list"><list>
</list>
</item>
<item key="insert_custom"/>
</dictionary>
</item>
<item key="acquired" type="int">0</item>
<item key="enabled" type="int">0</item>
<item key="id"><![CDATA[com.zms.sendmail]]></item>
<item key="name"><![CDATA[com.zms.sendmail]]></item>
<item key="package"/>
<item key="type"><![CDATA[ZMSLibrary]]></item>
</dictionary>
</item>
</dictionary>