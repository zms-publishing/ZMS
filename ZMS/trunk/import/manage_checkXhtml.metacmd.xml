<?xml version="1.0" encoding="utf-8"?>
<list>
<item type="dictionary"><dictionary>
<item key="data"><![CDATA[<dtml-comment>
##########################################################################################
# Author:   Dr.Frank Hoffmann <fh@hoffmannliebenberg.de>
# Company:  HOFFMANN+LIEBENBERG GmbH
# WWW:      http://www.hoffmannliebenberg.de
# Date:     12.09.2005
# Version:  0.2 fh: added 'euro' entity
# Comments: Action checks (X)HTML validity of object rendering (recursive).
##########################################################################################
</dtml-comment>

<dtml-var manage_page_header>
<title>(X)HTML validity</title>
</head>

<dtml-var "manage_tabs(_,_,my_manage_options=[{'label':'(X)HTML validity','action':''}])">

<dtml-var f_bo_area>

<dtml-call "REQUEST.set('pages',[getSelf()])">
<dtml-call "pages.extend(pages[0].getTreeNodes(REQUEST,PAGES))">

<table cellspacing="1" cellpadding="1" border="0" class="neutralColorStrong0" width="100%">
<dtml-in pages>
<dtml-let page=sequence-item notok="[]">
 <tr>
  <td valign="top" class="neutralColorMedium">
   <table cellspacing="0" cellpadding="1" border="0" width="100%">
    <tr valign="middle" class="<dtml-if sequence-odd>zmiTableRowOdd<dtml-else>zmiTableRowEven</dtml-if>">
     <td class="form-small"><dtml-var "f_breadcrumbs(_,_,objectPathElements=page.breadcrumbs_obj_path(),no_icon=1,REQUEST=REQUEST)"></td>
     <td class="form-small" align="right">
      <dtml-in "getChildNodes(REQUEST,PAGEELEMENTS)">
       <dtml-let pageelement=sequence-item>

        <dtml-call "REQUEST.set( 'live', 'live')">
        <dtml-let html="getBodyContent( REQUEST)">
        
        <dtml-call "REQUEST.set( 'xhtml', 
          '<?xml version='+QUOT+'1.0'+QUOT+' encoding='+QUOT+'utf-8'+QUOT+'?>'
          +'<!DOCTYPE DocumentElement [')">
        <dtml-call "REQUEST.set('entities',{
'nbsp'   :'160',
'iexcl'  :'161',
'cent'   :'162',
'pound'  :'163',
'curren' :'164',
'yen'    :'165',
'brvbar' :'166',
'sect'   :'167',
'uml'    :'168',
'copy'   :'169',
'ordf'   :'170',
'laquo'  :'171',
'not'    :'172',
'shy'    :'173',
'reg'    :'174',
'macr'   :'175',
'deg'    :'176',
'plusmn' :'177',
'sup2'   :'178',
'sup3'   :'179',
'acute'  :'180',
'micro'  :'181',
'para'   :'182',
'middot' :'183',
'cedil'  :'184',
'sup1'   :'185',
'ordm'   :'186',
'raquo'  :'187',
'frac14' :'188',
'frac12' :'189',
'frac34' :'190',
'iquest' :'191',
'Agrave' :'192',
'Aacute' :'193',
'Acirc'  :'194',
'Atilde' :'195',
'Auml'   :'196',
'Aring'  :'197',
'AElig'  :'198',
'Ccedil' :'199',
'Egrave' :'200',
'Eacute' :'201',
'Ecirc'  :'202',
'Euml'   :'203',
'Igrave' :'204',
'Iacute' :'205',
'Icirc'  :'206',
'Iuml'   :'207',
'ETH'    :'208',
'Ntilde' :'209',
'Ograve' :'210',
'Oacute' :'211',
'Ocirc'  :'212',
'Otilde' :'213',
'Ouml'   :'214',
'times'  :'215',
'Oslash' :'216',
'Ugrave' :'217',
'Uacute' :'218',
'Ucirc'  :'219',
'Uuml'   :'220',
'Yacute' :'221',
'THORN'  :'222',
'szlig'  :'223',
'agrave' :'224',
'aacute' :'225',
'acirc'  :'226',
'atilde' :'227',
'auml'   :'228',
'aring'  :'229',
'aelig'  :'230',
'ccedil' :'231',
'egrave' :'232',
'eacute' :'233',
'ecirc'  :'234',
'euml'   :'235',
'igrave' :'236',
'iacute' :'237',
'icirc'  :'238',
'iuml'   :'239',
'eth'    :'240',
'ntilde' :'241',
'ograve' :'242',
'oacute' :'243',
'ocirc'  :'244',
'otilde' :'245',
'ouml'   :'246',
'divide' :'247',
'oslash' :'248',
'ugrave' :'249',
'uacute' :'250',
'ucirc'  :'251',
'uuml'   :'252',
'yacute' :'253',
'thorn'  :'254',
'yuml'   :'255',
'lt'     :'60',
'gt'     :'62',
'amp'    :'38',
'mu'     :'181',
'le'     :'x2264',
'ge'     :'x2265',
'euro'   :'x20AC',
})">
        <dtml-in "entities.keys()">
         <dtml-let key=sequence-item value="entities[key]">
          <dtml-if "html.find('&'+key+';')>=0">
           <dtml-call "REQUEST.set( 'xhtml', xhtml+'<!ENTITY '+key+' '+QUOT+'&#'+value+';'+QUOT+' >')">
          </dtml-if>
         </dtml-let>
        </dtml-in>
        <dtml-call "REQUEST.set( 'xhtml', xhtml+']><DocumentElement>'+html+'</DocumentElement>')">
        <dtml-try>
         <dtml-call "xmlParse( xhtml)">
        <dtml-except>
         <dtml-call "notok.append({'pageelement':pageelement,'error_type':error_type,'error_value':error_value})">
        </dtml-try>
        
        </dtml-let>
        <dtml-call "REQUEST.set( 'live', '')">

       </dtml-let>
      </dtml-in>
 
      <dtml-if notok>
       <img src="<dtml-var MISC_ZMS>redEx.gif" title="Invalid XML!" border="0" align="absmiddle"/>
       Invalid XML!</td></tr>
       <tr>
        <td class="form-small" colspan="2">
         <dtml-in notok mapping>
          <dtml-with pageelement>
           <a href="<dtml-var absolute_url>/manage_main?lang=<dtml-var lang>" class="zmi" target="_blank"><img src="<dtml-var "display_icon(REQUEST)">" title="<dtml-var "display_type(REQUEST)">" border="0" align="absmiddle"/><dtml-var "display_type(REQUEST)"></a>
           <div class="form-small">
            <b><dtml-var error_type>:</b> <dtml-var error_value>
           </div>
          </dtml-with>
         </dtml-in>
        </td>
       </tr>
      <dtml-else>
       <img src="<dtml-var MISC_ZMS>greenCheck.gif" title="Valid XML!" border="0" align="absmiddle"/>
       Valid XML!</td></tr>
      </dtml-if>

    </table>
  </td>
 </tr> 
</dtml-let>
</dtml-in>
</table>

<dtml-var f_eo_area>

<dtml-var manage_page_footer>]]></item>
<item key="description"></item>
<item key="exec" type="int">0</item>
<item key="id"><![CDATA[manage_checkXhtmlRecursive]]></item>
<item key="meta_type"><![CDATA[DTML Method]]></item>
<item key="meta_types" type="list"><list>
<item><![CDATA[ZMSDocument]]></item>
<item><![CDATA[ZMSFolder]]></item>
</list>
</item>
<item key="name"><![CDATA[Check (X)HTML validity (recursive)...]]></item>
<item key="roles" type="list"><list>
<item><![CDATA[ZMSAdministrator]]></item>
</list>
</item>
</dictionary>
</item>
<item type="dictionary"><dictionary>
<item key="data"><![CDATA[<dtml-comment>
##########################################################################################
# Author:   Dr.Frank Hoffmann <fh@hoffmannliebenberg.de>
# Company:  HOFFMANN+LIEBENBERG GmbH
# WWW:      http://www.hoffmannliebenberg.de
# Date:     12.09.2005
# Version:  0.4 (fh euro entity)
# Comments: Action for checks (X)HTML validity of object rendering.
##########################################################################################
</dtml-comment>

<dtml-var manage_page_header>
<title><dtml-var "getZMILangStr('CAPTION_EDIT')%display_type(REQUEST)"></title>
</head>

<dtml-var "manage_tabs(_,_,p_languages=_.True)">

<dtml-unless fmName><dtml-call "REQUEST.set('fmName', 'form0')"></dtml-unless>

<dtml-var f_submitHrefForm
><form name="<dtml-var fmName>" action="#" method="post" style="margin:0px"
><input type="hidden" name="lang" value="<dtml-var lang>"
><input type="hidden" name="preview" value="preview"
><input type="hidden" name="_sort_id:int" value="0">

<dtml-call "REQUEST.set('id_prefix','e')">
<dtml-if "meta_type=='ZMSTrashcan'">
 <dtml-call "REQUEST.set('id_prefix','')">
</dtml-if>

<dtml-let childNodes="getObjChildren(id_prefix,REQUEST)">

<dtml-call "REQUEST.set('pageCountMin',_.int(getConfProperty('ZMS.compactview.pagecount.min','99999')))">
<dtml-call "SESSION.set('pageCountMax',REQUEST.form.get('sess_pageCountMax',SESSION.get('pageCountMax',REQUEST.get('pageCountMin'))))">
<dtml-call "REQUEST.set('pageCount',0)">
<dtml-in childNodes>
 <dtml-if "isPage()">
  <dtml-call "REQUEST.set('pageCount',pageCount+1)">
 </dtml-if>
</dtml-in>
<dtml-call "REQUEST.set('pageElementCount',_.len(childNodes)-pageCount)">

<dtml-comment>
<!-- ###################################################################### -->
<!-- ###################################################################### -->
<!-- ####
<!-- ####   C u r r e n t   N o d e
<!-- ####
<!-- ###################################################################### -->
<!-- ###################################################################### -->
</dtml-comment>

<dtml-let oCurrent="this()">

<table cellspacing="0" cellpadding="0" border="0" width="100%" class="zmiNeutralColorMedium0">

<tr>
<td width="5" rowspan="3"><img src="<dtml-var spacer_gif>" title="" border="0" width="5" height="2"></td>
<td width="744" colspan="4" class="zmiHSep"><img src="<dtml-var spacer_gif>" title="" border="0" width="2" height="1"></td>
</tr>

<tr valign="top">

<dtml-comment>
<!-- ##### object ##### -->
</dtml-comment>
<td class="form-small" width="260"
><div class="zmiNeutralColorMedium0" style="padding:1px"
><dtml-if "meta_type=='ZMSTrashcan'"
><img src="<dtml-var "display_icon(REQUEST)">" title="" border="0" align="absmiddle" class="zmiDisplayIcon"
><b><dtml-var "display_type(REQUEST)"></b
><dtml-else
><a href="manage_properties?lang=<dtml-var lang>" class="zmi"
><img src="<dtml-var "display_icon(REQUEST)">" title="" border="0" align="absmiddle" class="zmiDisplayIcon"
><b><dtml-var "getZMILangStr('CAPTION_PROPERTIES')%display_type(REQUEST)"></b
></a
></dtml-if
><br />
<dtml-var "manage_main_btn(_,_,offs=0,REQUEST=REQUEST)">
</div>
</td>

<dtml-comment>
<!-- ##### renderShort ##### -->
</dtml-comment>
<td width="384" class="zmiNeutralColorWhite">
 <table cellspacing="0" cellpadding="3" border="0" width="374">
 <tr>
  <td>
  <dtml-let img="getObjProperty('titleimage',REQUEST)">
   <dtml-if img>
    <div class="form-small">
     <dtml-var "getTitle(REQUEST)"><br />
     <img src="<dtml-var "img.getHref(REQUEST)">" title="" border="0"
      <dtml-try>
       <dtml-if "_.int(img.width)>360">
        width="360" height="<dtml-var "_.int(360*_.int(img.height)/_.int(img.width))">"
       <dtml-else>
        width="<dtml-var "img.width">" height="<dtml-var "img.height">"
       </dtml-if>
      <dtml-except></dtml-try>>
    </div>
   <dtml-else>
    <h1><dtml-var "getTitle(REQUEST)"></h1>
   </dtml-if>
  </dtml-let>
   <p class="description"><dtml-var "getDCDescription(REQUEST)"></p>
  <dtml-unless childNodes>
   <p class="form-element"><dtml-var "getZMILangStr('MSG_EMPTYCONTAINER')"> <dtml-var "display_type(REQUEST)"> <em><dtml-var "getTitlealt(REQUEST)"></em>!</p>
  </dtml-unless>
  </td>
 </tr>
 </table>
</td>

<dtml-comment>
<!-- ##### change ##### -->
</dtml-comment>
<td width="100" class="zmiNeutralColorLight1"></td>

</tr>

</table>

<dtml-comment>
<!-- ###################################################################### -->
<!-- ###################################################################### -->
<!-- ####
<!-- ####   C h i l d   N o d e s
<!-- ####
<!-- ###################################################################### -->
<!-- ###################################################################### -->
</dtml-comment>

<dtml-in childNodes>
<dtml-let oCurrent=sequence-item
          coverage="getDCCoverage(REQUEST)"
          accessRights="hasAccess(REQUEST)">

<table cellspacing="0" cellpadding="0" border="0" width="100%" class="zmiNeutralColorMedium0">

<dtml-comment>
<!-- ##### separator ##### -->
</dtml-comment>
<dtml-if sequence-start>
<tr>
<td width="28" style="background-image:url(<dtml-var MISC_ZMS>tv_line.gif);"><img src="<dtml-var spacer_gif>" title="" border="0" width="2" height="1"></td>
<td colspan="2" class="zmiHSep"><img src="<dtml-var spacer_gif>" title="" border="0" width="2" height="1"></td>
<td colspan="2" class="zmiNeutralColorWhite"><img src="<dtml-var spacer_gif>" title="" border="0" width="2" height="2"></td>
</tr>
</dtml-if>

<tr valign="top" id="tr_<dtml-var id>">

<dtml-comment>
<!-- ##### tree ##### -->
</dtml-comment>
<td rowspan="2" style="width:16px;"
><dtml-if "_['sequence-index']==pageElementCount and pageCount>pageCountMin"
><a href="<dtml-var URL>?lang=<dtml-var lang>&sess_pageCountMax:int=<dtml-var pageCountMin>#_<dtml-var id>"
><img src="/p_/mi" border="0" title="<dtml-var "getZMILangStr('ATTR_COMPACTVIEW')">"
></a
></dtml-if
></td>

<dtml-comment>
<!-- ##### object ##### -->
</dtml-comment>
<td width="18">
<dtml-if "accessRights and (getAutocommit() or coverage[coverage.find('.')+1:]==lang)">
<input class="form-checkbox" type="checkbox" name="ids:list" value="<dtml-var id>" onclick="switchButtons()">
<dtml-else>
<img src="<dtml-var MISC_ZMS>checkbox_disabled0.gif" title="" border="0" align="absmiddle" />
</dtml-if>
</td>
<td width="218" class="form-small"
><dtml-if accessRights
><a name="_<dtml-var id>" class="zmi" href="<dtml-var id>/manage_main?lang=<dtml-var lang>"
><img src="<dtml-var "display_icon(REQUEST)">" title="" border="0" align="absmiddle" class="zmiDisplayIcon"
><dtml-if "isPage()"
><dtml-var "getZMILangStr('ACTION_SELECT')%display_type(REQUEST)"
><dtml-else
><dtml-var "getZMILangStr('CAPTION_EDIT')%display_type(REQUEST)"
></dtml-if
></a
><dtml-else
><img src="<dtml-var "display_icon(REQUEST)">" title="" border="0" align="absmiddle" class="zmiDisplayIcon"
><dtml-var "display_type(REQUEST)"
></dtml-if
><br />
</td>

<dtml-comment>
<!-- ##### renderShort ##### -->
</dtml-comment>
<td width="384" valign="top" <dtml-if "isPage()">class="zmiNeutralColorLight0"<dtml-else>class="zmiNeutralColorWhite"</dtml-if>>
 <table cellspacing="0" cellpadding="3" border="0" width="374">
 <tr>
  <td><dtml-var "renderShort(REQUEST)"></td>
 </tr>
 </table>
</td>

<dtml-comment>
<!-- ##### change ##### -->
</dtml-comment>
<td width="100" class="zmiNeutralColorLight1">
 <div class="form-small">
<dtml-comment>
***********************************************************************************************
*** <BO XHTML Check> **************************************************************************
***********************************************************************************************
</dtml-comment>
<dtml-if "isPageElement()">
<dtml-call "REQUEST.set( 'live', 'live')">
<dtml-let html="getBodyContent( REQUEST)">
<dtml-call "REQUEST.set( 'xhtml', 
  '<?xml version='+QUOT+'1.0'+QUOT+' encoding='+QUOT+'utf-8'+QUOT+'?>'
  +'<!DOCTYPE DocumentElement [')">
<dtml-call "REQUEST.set('entities',{
'nbsp'   :'160',
'iexcl'  :'161',
'cent'   :'162',
'pound'  :'163',
'curren' :'164',
'yen'    :'165',
'brvbar' :'166',
'sect'   :'167',
'uml'    :'168',
'copy'   :'169',
'ordf'   :'170',
'laquo'  :'171',
'not'    :'172',
'shy'    :'173',
'reg'    :'174',
'macr'   :'175',
'deg'    :'176',
'plusmn' :'177',
'sup2'   :'178',
'sup3'   :'179',
'acute'  :'180',
'micro'  :'181',
'para'   :'182',
'middot' :'183',
'cedil'  :'184',
'sup1'   :'185',
'ordm'   :'186',
'raquo'  :'187',
'frac14' :'188',
'frac12' :'189',
'frac34' :'190',
'iquest' :'191',
'Agrave' :'192',
'Aacute' :'193',
'Acirc'  :'194',
'Atilde' :'195',
'Auml'   :'196',
'Aring'  :'197',
'AElig'  :'198',
'Ccedil' :'199',
'Egrave' :'200',
'Eacute' :'201',
'Ecirc'  :'202',
'Euml'   :'203',
'Igrave' :'204',
'Iacute' :'205',
'Icirc'  :'206',
'Iuml'   :'207',
'ETH'    :'208',
'Ntilde' :'209',
'Ograve' :'210',
'Oacute' :'211',
'Ocirc'  :'212',
'Otilde' :'213',
'Ouml'   :'214',
'times'  :'215',
'Oslash' :'216',
'Ugrave' :'217',
'Uacute' :'218',
'Ucirc'  :'219',
'Uuml'   :'220',
'Yacute' :'221',
'THORN'  :'222',
'szlig'  :'223',
'agrave' :'224',
'aacute' :'225',
'acirc'  :'226',
'atilde' :'227',
'auml'   :'228',
'aring'  :'229',
'aelig'  :'230',
'ccedil' :'231',
'egrave' :'232',
'eacute' :'233',
'ecirc'  :'234',
'euml'   :'235',
'igrave' :'236',
'iacute' :'237',
'icirc'  :'238',
'iuml'   :'239',
'eth'    :'240',
'ntilde' :'241',
'ograve' :'242',
'oacute' :'243',
'ocirc'  :'244',
'otilde' :'245',
'ouml'   :'246',
'divide' :'247',
'oslash' :'248',
'ugrave' :'249',
'uacute' :'250',
'ucirc'  :'251',
'uuml'   :'252',
'yacute' :'253',
'thorn'  :'254',
'yuml'   :'255',
'lt'     :'60',
'gt'     :'62',
'amp'    :'38',
'mu'     :'181',
'le'     :'x2264',
'ge'     :'x2265',
'euro'   :'x20AC',
})">
<dtml-in "entities.keys()">
 <dtml-let key=sequence-item value="entities[key]">
  <dtml-if "html.find('&'+key+';')>=0">
   <dtml-call "REQUEST.set( 'xhtml', xhtml+'<!ENTITY '+key+' '+QUOT+'&#'+value+';'+QUOT+' >')">
  </dtml-if>
 </dtml-let>
</dtml-in>
<dtml-call "REQUEST.set( 'xhtml', xhtml+']><DocumentElement>'+html+'</DocumentElement>')">
<dtml-try>
  <dtml-call "xmlParse( xhtml)">
 <img src="<dtml-var MISC_ZMS>greenCheck.gif" title="Valid XML!" border="0" align="absmiddle"/>
 Valid XML!<br/>
<dtml-except>
 <img src="<dtml-var MISC_ZMS>redEx.gif" title="Invalid XML!" border="0" align="absmiddle"/>
 Invalid XML!<br />
 Type: <dtml-var error_type><br />
 Value: <dtml-var error_value><br />
 <img src="<dtml-var MISC_ZMS>mime_type.text_xml.gif" title="<dtml-var xhtml html_quote>" border="0" align="absmiddle"/><br />
</dtml-try>
</dtml-let>
<dtml-call "REQUEST.set( 'live', '')">
</dtml-if>
<dtml-comment>
***********************************************************************************************
*** <EO XHTML Check> **************************************************************************
***********************************************************************************************
</dtml-comment>
</div>
</td>

</tr>

<tr>
<td colspan="2" class="zmiHSep"><img src="<dtml-var spacer_gif>" title="" border="0" width="2" height="1"></td>
<td colspan="2" class="zmiNeutralColorWhite"><img src="<dtml-var spacer_gif>" title="" border="0" width="2" height="2"></td>
</tr>

</table>

</dtml-let>
</dtml-in>

<dtml-comment>
<!-- ###################################################################### -->
</dtml-comment>

<table cellspacing="0" cellpadding="0" border="0" width="100%" class="zmiNeutralColorMedium0">

</table>

</dtml-let>

<dtml-comment>
<!-- ###################################################################### -->
</dtml-comment>

</dtml-let>

</form>

<dtml-var manage_page_footer>]]></item>
<item key="description"></item>
<item key="exec" type="int">0</item>
<item key="id"><![CDATA[manage_checkXhtml]]></item>
<item key="meta_type"><![CDATA[DTML Method]]></item>
<item key="meta_types" type="list"><list>
<item><![CDATA[ZMSDocument]]></item>
<item><![CDATA[ZMSFolder]]></item>
<item><![CDATA[ZMS]]></item>
</list>
</item>
<item key="name"><![CDATA[Check (X)HTML validity...]]></item>
<item key="roles" type="list"><list>
<item><![CDATA[ZMSEditor]]></item>
<item><![CDATA[ZMSAdministrator]]></item>
</list>
</item>
</dictionary>
</item>
</list>
