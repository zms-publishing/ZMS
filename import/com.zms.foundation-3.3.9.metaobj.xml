<?xml version="1.0" encoding="utf-8"?>

<list>
  <item type="dictionary">
    <dictionary>
      <item key="key"><![CDATA[ZMS]]></item>
      <item key="value" type="dictionary">
        <dictionary>
          <item key="__obj_attrs__" type="list">
            <list>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[icon-home]]></item>
                  <item key="id"><![CDATA[icon_clazz]]></item>
                  <item key="name"><![CDATA[Icon (Class)]]></item>
                  <item key="type"><![CDATA[constant]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[titlealt]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Title.Alt]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[title]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Title]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[titleimage]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[Titleimage]]></item>
                  <item key="type"><![CDATA[image]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[levelnfc]]></item>
                  <item key="keys" type="list">
                    <list>
                      <item><![CDATA[0]]></item>
                      <item><![CDATA[1]]></item>
                      <item><![CDATA[2]]></item>
                    </list>
                  </item>
                  <item key="name"><![CDATA[Level]]></item>
                  <item key="type"><![CDATA[select]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[TAB_METADATA]]></item>
                  <item key="name"><![CDATA[TAB_METADATA]]></item>
                  <item key="type"><![CDATA[delimiter]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_dc_description]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Description]]></item>
                  <item key="type"><![CDATA[text]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_dc_subject]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Subject]]></item>
                  <item key="type"><![CDATA[text]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_dc_type]]></item>
                  <item key="keys" type="list">
                    <list>
                      <item><![CDATA[Home]]></item>
                      <item><![CDATA[Artikel]]></item>
                      <item><![CDATA[Forum]]></item>
                      <item><![CDATA[News]]></item>
                      <item><![CDATA[Resource]]></item>
                    </list>
                  </item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Type]]></item>
                  <item key="type"><![CDATA[select]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_dc_creator]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Creator]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[delimiter_permalinks]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[Permalinks]]></item>
                  <item key="type"><![CDATA[delimiter]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<!-- ZMS.interface_permalinks -->

<div class="control-group" tal:define="zmscontext options/zmscontext">
	<label class="control-label col-sm-2"><span>Permalinks</span></label>
	<div class="col-sm-10" style="padding:0 0 1em 5px">
		<table class="table table-bordered" style="margin:0">
		<colgroup>
			<col width="2em"/>
		</colgroup>
		<tbody tal:define="prefix python:'%s.permalink.'%zmscontext.meta_id;
			keys python:filter(lambda x:x.startswith(prefix),zmscontext.getConfProperties().keys());
			dummy0 python:keys.sort();">
		<tal:block tal:repeat="key keys">
		<tr tal:define="id python:key[len(prefix):]">
			<td class="meta-sort">
				<div class="btn-group">
					<span class="btn btn-default" tal:attributes="onclick python:'if (confirm(getZMILangStr(\'MSG_CONFIRM_DELOBJ\'))){$(this).parents(\'tr\').remove()}'; title python:here.getZMILangStr('BTN_DELETE')">
						<tal:block tal:content="structure python:here.zmi_icon(name='icon-remove')"></tal:block>
					</span>
				</div><!-- .btn-group -->
			</td>
			<td class="meta-id"><input class="form-control input-sm" tal:attributes="name python:'permalink_key_%s'%id; value id;"/>
			<td class="meta-url"><input class="form-control input-sm url-input" tal:attributes="name python:'permalink_val_%s'%id; value python:zmscontext.getConfProperty(key)"/>
		</tr>
		</tal:block>
		<tr class="row_insert">
			<td class="meta-sort"><tal:block tal:content="structure python:zmscontext.zmi_icon(name='icon-plus')"></tal:block></td>
			<td class="meta-id"><input class="form-control input-sm" name="permalink_key__" placeholder="Enter Id..."/>
			<td class="meta-url"><input class="form-control input-sm url-input" name="permalink_val__" placeholder="Select Url..."/>
		</tr>
		</tbody>
		</table>
	</div>
</div>

<!-- /ZMS.interface_permalinks -->]]>
                  </item>
                  <item key="id"><![CDATA[interface_permalinks]]></item>
                  <item key="name"><![CDATA[interface_permalinks]]></item>
                  <item key="type"><![CDATA[interface]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[zmsindex]]></item>
                  <item key="name"><![CDATA[ZMSIndex]]></item>
                  <item key="type"><![CDATA[ZMSIndexZCatalog]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[e]]></item>
                  <item key="keys" type="list">
                    <list>
                      <item><![CDATA[type(ZMSDocument)]]></item>
                      <item><![CDATA[type(ZMSObject)]]></item>
                      <item><![CDATA[type(ZMSRecordSet)]]></item>
                      <item><![CDATA[type(ZMSReference)]]></item>
                      <item><![CDATA[type(ZMSModule)]]></item>
                    </list>
                  </item>
                  <item key="name"><![CDATA[Objects]]></item>
                  <item key="repetitive" type="int">1</item>
                  <item key="type"><![CDATA[*]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMS.onChangeObjEvt"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext
##title=py: Event: onChange
##
# --// ZMS.onChangeObjEvt //--

request = zmscontext.REQUEST
# permalinks
if request.has_key('permalink_key__') and request.has_key('permalink_val__'):
  prefix = '%s.permalink.'%zmscontext.meta_id
  # delete all conf-properties
  for key in filter(lambda x:x.startswith(prefix),zmscontext.getConfProperties()):
    zmscontext.delConfProperty(key)
  # set new conf-properties
  reqprefix = 'permalink_key_'
  for reqkey in request.form.keys():
    if reqkey.find(reqprefix) >= 0:
      id = reqkey[len(reqprefix):]
      k = request.get('permalink_key_%s'%id)
      v = request.get('permalink_val_%s'%id)
      if k and v:
        zmscontext.setConfProperty(prefix+k,v)

# --// /ZMS.onChangeObjEvt //--
]]>
                  </item>
                  <item key="id"><![CDATA[onChangeObjEvt]]></item>
                  <item key="name"><![CDATA[Event: onChange]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<!-- ZMS.standard_html -->

<tal:block tal:define="global 
		zmscontext options/zmscontext"
		tal:content="structure python:zmscontext.bodyContentZMSLib_page(zmscontext,request)">
	The page-content
</tal:block>

<!-- /ZMS.standard_html -->]]>
                  </item>
                  <item key="id"><![CDATA[standard_html]]></item>
                  <item key="name"><![CDATA[Template: ZMS]]></item>
                  <item key="type"><![CDATA[zpt]]></item>
                </dictionary>
              </item>
            </list>
          </item>
          <item key="access" type="dictionary">
            <dictionary>
              <item key="delete_custom"></item>
              <item key="delete_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
              <item key="insert_custom"><![CDATA[{$}]]></item>
              <item key="insert_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
            </dictionary>
          </item>
          <item key="enabled" type="int">0</item>
          <item key="id"><![CDATA[ZMS]]></item>
          <item key="name"><![CDATA[ZMS]]></item>
          <item key="package"><![CDATA[com.zms.foundation]]></item>
          <item key="revision"><![CDATA[3.2.6]]></item>
          <item key="type"><![CDATA[ZMSDocument]]></item>
        </dictionary>
      </item>
    </dictionary>
  </item>
  <item type="dictionary">
    <dictionary>
      <item key="key"><![CDATA[ZMSDocument]]></item>
      <item key="value" type="dictionary">
        <dictionary>
          <item key="__obj_attrs__" type="list">
            <list>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[icon-file-alt]]></item>
                  <item key="id"><![CDATA[icon_clazz]]></item>
                  <item key="name"><![CDATA[Icon (Class)]]></item>
                  <item key="type"><![CDATA[constant]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[titlealt]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Title.Alt]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[title]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Title]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[titleimage]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[Titleimage]]></item>
                  <item key="type"><![CDATA[image]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[levelnfc]]></item>
                  <item key="keys" type="list">
                    <list>
                      <item><![CDATA[0]]></item>
                      <item><![CDATA[1]]></item>
                      <item><![CDATA[2]]></item>
                    </list>
                  </item>
                  <item key="name"><![CDATA[Level]]></item>
                  <item key="type"><![CDATA[select]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[TAB_METADATA]]></item>
                  <item key="name"><![CDATA[TAB_METADATA]]></item>
                  <item key="type"><![CDATA[delimiter]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_dc_description]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Description]]></item>
                  <item key="type"><![CDATA[text]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_dc_subject]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Subject]]></item>
                  <item key="type"><![CDATA[text]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_dc_type]]></item>
                  <item key="keys" type="list">
                    <list>
                      <item><![CDATA[Home]]></item>
                      <item><![CDATA[Artikel]]></item>
                      <item><![CDATA[Forum]]></item>
                      <item><![CDATA[News]]></item>
                      <item><![CDATA[Resource]]></item>
                    </list>
                  </item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Type]]></item>
                  <item key="type"><![CDATA[select]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_dc_creator]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Creator]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[e]]></item>
                  <item key="keys" type="list">
                    <list>
                      <item><![CDATA[type(ZMSObject)]]></item>
                      <item><![CDATA[type(ZMSRecordSet)]]></item>
                      <item><![CDATA[type(ZMSModule)]]></item>
                    </list>
                  </item>
                  <item key="name"><![CDATA[Objects]]></item>
                  <item key="repetitive" type="int">1</item>
                  <item key="type"><![CDATA[*]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<!-- ZMSDocument.standard_html -->

<tal:block tal:define="global 
		zmscontext options/zmscontext"
		tal:content="structure python:zmscontext.bodyContentZMSLib_page(zmscontext,request)">
	The page-content
</tal:block>

<!-- /ZMSDocument.standard_html -->]]>
                  </item>
                  <item key="id"><![CDATA[standard_html]]></item>
                  <item key="name"><![CDATA[Template: ZMSDocument]]></item>
                  <item key="type"><![CDATA[zpt]]></item>
                </dictionary>
              </item>
            </list>
          </item>
          <item key="access" type="dictionary">
            <dictionary>
              <item key="delete_custom"></item>
              <item key="delete_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
              <item key="insert_custom"><![CDATA[{$}]]></item>
              <item key="insert_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
            </dictionary>
          </item>
          <item key="enabled" type="int">1</item>
          <item key="id"><![CDATA[ZMSDocument]]></item>
          <item key="name"><![CDATA[ZMSDocument]]></item>
          <item key="package"><![CDATA[com.zms.foundation]]></item>
          <item key="revision"><![CDATA[3.0.1]]></item>
          <item key="type"><![CDATA[ZMSDocument]]></item>
        </dictionary>
      </item>
    </dictionary>
  </item>
  <item type="dictionary">
    <dictionary>
      <item key="key"><![CDATA[ZMSFile]]></item>
      <item key="value" type="dictionary">
        <dictionary>
          <item key="__obj_attrs__" type="list">
            <list>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[icon-download-alt]]></item>
                  <item key="id"><![CDATA[icon_clazz]]></item>
                  <item key="name"><![CDATA[Icon (Class)]]></item>
                  <item key="type"><![CDATA[constant]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[
div.ZMSFile.none, div.ZMSLinkElement.none 
	{
	background-color: transparent;
	border: 2px dashed #eee;
	}

div.ZMSFile.floatleft, div.ZMSLinkElement.floatleft 
	{ 
	float:left;
	width:50%
	}

div.ZMSFile.floatright, div.ZMSLinkElement.floatright 
	{ 
	float:right;
	width:50%
	}

div.ZMSFile div.title a:link, div.ZMSFile div.title a:visited, 
div.ZMSLinkElement div.title a:link, div.ZMSLinkElement div.title a:visited 
	{
	font-weight:bold;
	text-decoration:none;
	}
]]>
                  </item>
                  <item key="id"><![CDATA[f_css_defaults]]></item>
                  <item key="name"><![CDATA[CSS: Default]]></item>
                  <item key="type"><![CDATA[resource]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[title]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Title]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[file]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[File]]></item>
                  <item key="type"><![CDATA[file]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[align]]></item>
                  <item key="keys" type="list">
                    <list>
                      <item><![CDATA[LEFT]]></item>
                      <item><![CDATA[LEFT_FLOAT]]></item>
                      <item><![CDATA[RIGHT]]></item>
                      <item><![CDATA[RIGHT_FLOAT]]></item>
                      <item><![CDATA[NONE]]></item>
                    </list>
                  </item>
                  <item key="mandatory" type="int">1</item>
                  <item key="name"><![CDATA[Align]]></item>
                  <item key="type"><![CDATA[select]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSFile.titlealt"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext=None,options=None
##title=py: DC.Title.Alt
##
# --// titlealt //--

return zmscontext.attr('title')

# --// /titlealt //--
]]>
                  </item>
                  <item key="id"><![CDATA[titlealt]]></item>
                  <item key="name"><![CDATA[DC.Title.Alt]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<script type="text/javascript" tal:define="global
		zmscontext options/zmscontext">

$(function(){
	$("#file_"+getZMILang()).change( function() {
			var filename = $(this).val();
			var i = Math.max(filename.lastIndexOf('/'),filename.lastIndexOf('\\'));
			if (i > 0) {
				filename = filename.substring(i+1);
			}
			var title = $("#title_"+getZMILang());
			if (title.val().length == 0) {
				title.attr({'data-value-attr':'placeholder','placeholder':filename});
			}
		});
});

</script>]]>
                  </item>
                  <item key="id"><![CDATA[interface0]]></item>
                  <item key="name"><![CDATA[interface0]]></item>
                  <item key="type"><![CDATA[interface]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[TAB_METADATA]]></item>
                  <item key="name"><![CDATA[TAB_METADATA]]></item>
                  <item key="type"><![CDATA[delimiter]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_dc_description]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Description]]></item>
                  <item key="type"><![CDATA[text]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSFile.attr_img_src"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext
##title=py: Alias: Teaser.Image
##
# --// BO attr_img_src //--

file = zmscontext.attr('file')
return file.getMimeTypeIconSrc()

# --// EO attr_img_src //--
]]>
                  </item>
                  <item key="id"><![CDATA[attr_img_src]]></item>
                  <item key="name"><![CDATA[Alias: Teaser.Image]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSFile.attr_url"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext
##title=py: Alias: Teaser.Url
##
# --// BO attr_url //--

file = zmscontext.attr('file')
return file.getHref(zmscontext.REQUEST)

# --// EO attr_url //--
]]>
                  </item>
                  <item key="id"><![CDATA[attr_url]]></item>
                  <item key="name"><![CDATA[Alias: Teaser.Url]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSFile.attr_abstract"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext
##title=py: Alias: Teaser.Abstract
##
# --// BO attr_abstract //--
#
return zmscontext.attr('attr_dc_description')

# --// EO attr_abstract //--
]]>
                  </item>
                  <item key="id"><![CDATA[attr_abstract]]></item>
                  <item key="name"><![CDATA[Alias: Teaser.Abstract]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSFile.getHref2IndexHtml"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext
##title=py: Function: index_html
##
# --// BO getHref2IndexHtml //--

file = zmscontext.attr('file')
if file:
    return file.getHref(zmscontext.REQUEST)
return ''

# --// EO getHref2IndexHtml //--
]]>
                  </item>
                  <item key="id"><![CDATA[getHref2IndexHtml]]></item>
                  <item key="name"><![CDATA[Function: index_html]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<!-- ZMSFile.standard_html -->

<tal:block tal:define="Std modules/Products.PythonScripts/standard; newline_to_br nocall:Std/newline_to_br; global 
		zmscontext options/zmscontext;
		subclass      python:[zmscontext.meta_id];
		title         python:zmscontext.attr('title');
		titlealt      python:zmscontext.attr('titlealt');
		file          python:zmscontext.attr('file');
		align         python:zmscontext.attr('align');
		displaytype   python:zmscontext.attr('displaytype');
		abstract      python:zmscontext.attr('attr_abstract')">
	<tal:block tal:condition="python:align not in ['','NONE'] or request.get('URL','').find('/manage')>0">
		<tal:block tal:condition="python:align in [ '', 'NONE']">
			<tal:block tal:define="global subclass python:subclass+['none']"></tal:block>
		</tal:block>
		<tal:block tal:condition="python:align in [ 'LEFT', 'CENTER', 'RIGHT']">
			<tal:block tal:define="global subclass python:subclass+[align.lower()]"></tal:block>
		</tal:block>
		<tal:block tal:condition="python:align in [ 'LEFT_FLOAT'] and displaytype in [ 'top', 'bottom']">
			<tal:block tal:define="global subclass python:subclass+['floatleft']"></tal:block>
		</tal:block>
		<tal:block tal:condition="python:align in [ 'RIGHT_FLOAT'] and displaytype in [ 'top', 'bottom']">
			<tal:block tal:define="global subclass python:subclass+['floatright']"></tal:block>
		</tal:block>
		<div tal:attributes="id python:zmscontext.id; class python:' '.join(subclass)">
			<span tal:omit-tag="" tal:condition="python:file">
				<div class="title">
					<img tal:attributes="src python:file.getMimeTypeIconSrc(); title python:'%s (%s)'%(file.getContentType(),file.getDataSizeStr())" border="0" alt="Icon" align="absmiddle"/>
					<a tal:attributes="href python:file.getHref(request)" tal:content="structure python:titlealt" target="_blank">The titlealt</a>
					(<span tal:content="python:file.getDataSizeStr()">The data-size string</span>)
				</div>
				<div tal:condition="python:title and title!=titlealt" tal:content="structure title" class="text">The title</div>
				<div tal:condition="python:abstract" tal:content="structure python:newline_to_br(abstract)" class="description">The abstract</div>
			</span>
			<span tal:omit-tag="" tal:condition="python:not (file)" tal:content="python:zmscontext.getZMILangStr('ATTR_NONE')">
				None
			</span>
		</div>
	</tal:block>
</tal:block>

<!-- /ZMSFile.standard_html -->]]>
                  </item>
                  <item key="id"><![CDATA[standard_html]]></item>
                  <item key="name"><![CDATA[Template: ZMSFile]]></item>
                  <item key="type"><![CDATA[zpt]]></item>
                </dictionary>
              </item>
            </list>
          </item>
          <item key="access" type="dictionary">
            <dictionary>
              <item key="delete_custom"></item>
              <item key="delete_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
              <item key="insert_custom"><![CDATA[{$}]]></item>
              <item key="insert_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
            </dictionary>
          </item>
          <item key="enabled" type="int">1</item>
          <item key="id"><![CDATA[ZMSFile]]></item>
          <item key="name"><![CDATA[ZMSFile]]></item>
          <item key="package"><![CDATA[com.zms.foundation]]></item>
          <item key="revision"><![CDATA[3.3.8]]></item>
          <item key="type"><![CDATA[ZMSObject]]></item>
        </dictionary>
      </item>
    </dictionary>
  </item>
  <item type="dictionary">
    <dictionary>
      <item key="key"><![CDATA[ZMSFolder]]></item>
      <item key="value" type="dictionary">
        <dictionary>
          <item key="__obj_attrs__" type="list">
            <list>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[icon-folder-close-alt]]></item>
                  <item key="id"><![CDATA[icon_clazz]]></item>
                  <item key="name"><![CDATA[Icon (Class)]]></item>
                  <item key="type"><![CDATA[constant]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[titlealt]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Title.Alt]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[title]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Title]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[titleimage]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[Titleimage]]></item>
                  <item key="type"><![CDATA[image]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[levelnfc]]></item>
                  <item key="keys" type="list">
                    <list>
                      <item><![CDATA[0]]></item>
                      <item><![CDATA[1]]></item>
                      <item><![CDATA[2]]></item>
                    </list>
                  </item>
                  <item key="name"><![CDATA[Level]]></item>
                  <item key="type"><![CDATA[select]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[TAB_METADATA]]></item>
                  <item key="name"><![CDATA[TAB_METADATA]]></item>
                  <item key="type"><![CDATA[delimiter]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_dc_description]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Description]]></item>
                  <item key="type"><![CDATA[text]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_dc_subject]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Subject]]></item>
                  <item key="type"><![CDATA[text]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_dc_type]]></item>
                  <item key="keys" type="list">
                    <list>
                      <item><![CDATA[Home]]></item>
                      <item><![CDATA[Artikel]]></item>
                      <item><![CDATA[Forum]]></item>
                      <item><![CDATA[News]]></item>
                      <item><![CDATA[Resource]]></item>
                    </list>
                  </item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Type]]></item>
                  <item key="type"><![CDATA[select]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_dc_creator]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Creator]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[e]]></item>
                  <item key="keys" type="list">
                    <list>
                      <item><![CDATA[type(ZMSDocument)]]></item>
                      <item><![CDATA[type(ZMSObject)]]></item>
                      <item><![CDATA[type(ZMSRecordSet)]]></item>
                      <item><![CDATA[type(ZMSModule)]]></item>
                    </list>
                  </item>
                  <item key="name"><![CDATA[Objects]]></item>
                  <item key="repetitive" type="int">1</item>
                  <item key="type"><![CDATA[*]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<!-- ZMSFolder.standard_html -->

<tal:block tal:define="global 
		zmscontext options/zmscontext"
		tal:content="structure python:zmscontext.bodyContentZMSLib_page(zmscontext,request)">
	The page-content
</tal:block>

<!-- /ZMSFolder.standard_html -->]]>
                  </item>
                  <item key="id"><![CDATA[standard_html]]></item>
                  <item key="name"><![CDATA[Template: ZMSFolder]]></item>
                  <item key="type"><![CDATA[zpt]]></item>
                </dictionary>
              </item>
            </list>
          </item>
          <item key="access" type="dictionary">
            <dictionary>
              <item key="delete_custom"></item>
              <item key="delete_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
              <item key="insert_custom"><![CDATA[{$}]]></item>
              <item key="insert_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
            </dictionary>
          </item>
          <item key="enabled" type="int">1</item>
          <item key="id"><![CDATA[ZMSFolder]]></item>
          <item key="name"><![CDATA[ZMSFolder]]></item>
          <item key="package"><![CDATA[com.zms.foundation]]></item>
          <item key="revision"><![CDATA[3.0.1]]></item>
          <item key="type"><![CDATA[ZMSDocument]]></item>
        </dictionary>
      </item>
    </dictionary>
  </item>
  <item type="dictionary">
    <dictionary>
      <item key="key"><![CDATA[ZMSGraphic]]></item>
      <item key="value" type="dictionary">
        <dictionary>
          <item key="__obj_attrs__" type="list">
            <list>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[icon-picture fa fa-picture-o]]></item>
                  <item key="id"><![CDATA[icon_clazz]]></item>
                  <item key="name"><![CDATA[Icon (Class)]]></item>
                  <item key="type"><![CDATA[constant]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[
/*--------- .ZMSGraphic --------------*/
a.fancybox img {
	padding:1px 1px 21px 1px;
	background:transparent url(/misc_/zms/zoom.gif) bottom right no-repeat;
	background-color:transparent;
}
div.ZMSGraphic {
	background-color: transparent;
	margin: 1em 0;
}
.zmi div.ZMSGraphic {
	margin:0;
}
div.ZMSGraphic.left {
	text-align:left;
}
div.ZMSGraphic.right {
	text-align:right;
}
div.ZMSGraphic.center {
	text-align:center;
}
div.ZMSGraphic.floatleft {
	float:left;
	margin-right:2em;
}
div.ZMSGraphic.floatright {
	float:right;
	margin-left:2em;
}
div.ZMSGraphic .alignleft {
	margin-right:10px;
}
div.ZMSGraphic.center div.graphic {
	text-align:center;
	margin:0px auto;
}
div.graphic {
	max-width:100% !important;
}
div.graphic.alignleft {
	float:left;
	text-align:right;
}
div.graphic.alignright {
	float:right;
	text-align:right;
}
div.ZMSGraphic div.text {
	padding: 4px;
}
.ZMSGraphic .text {
	background-color:transparent;
	padding:.5em 1em 0em 1em;
	font-size:smaller;
	font-style:italic;
}
.ZMSGraphic .graphic {
	margin-bottom: 7px;
}
.ZMSGraphic.center div.graphic  {
	margin:0 auto
}
.ZMSGraphic.left .graphic.alignleft {
	float:left;
	margin-right:15px;
}
.ZMSGraphic.left .text,
.ZMSGraphic.right .graphic,
.ZMSGraphic.right .text {
	width: auto !important;
}
/*-- ## FF Patch ## --*/
div.ZMSGraphic.right div.graphic {
	width:100% !important;
}
div.ZMSGraphic.right div.graphic img {
	display:inline !important;
}
a.zoom img.zoom,
a.superzoom img.superzoom {
	width: 26px;
	height: 21px;
	background-position:top right;
	background-repeat:no-repeat;
	margin:0px;
	padding:0px;
}
a.zoom img.zoom {
	background-image: url(/misc_/zms/zoom.gif);
}
a.superzoom img.superzoom {
	background-image: url(/misc_/zms/superzoom.gif);
}
/*--------- /.ZMSGraphic --------------*/
]]>
                  </item>
                  <item key="id"><![CDATA[f_css_defaults]]></item>
                  <item key="name"><![CDATA[CSS: Default]]></item>
                  <item key="type"><![CDATA[resource]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="default"><![CDATA[2]]></item>
                  <item key="id"><![CDATA[displaytype]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="name"><![CDATA[Display-Type]]></item>
                  <item key="type"><![CDATA[int]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[img]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[Image]]></item>
                  <item key="type"><![CDATA[image]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[imghires]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[Image (Hires)]]></item>
                  <item key="type"><![CDATA[image]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[imgsuperres]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[Image (Superres)]]></item>
                  <item key="type"><![CDATA[image]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="default"><![CDATA[alt=""]]></item>
                  <item key="id"><![CDATA[img_attrs_spec]]></item>
                  <item key="name"><![CDATA[WAI-Attributes]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_url]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[Image (URL)]]></item>
                  <item key="type"><![CDATA[url]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[align]]></item>
                  <item key="keys" type="list">
                    <list>
                      <item><![CDATA[LEFT]]></item>
                      <item><![CDATA[LEFT_FLOAT]]></item>
                      <item><![CDATA[RIGHT]]></item>
                      <item><![CDATA[RIGHT_FLOAT]]></item>
                      <item><![CDATA[CENTER]]></item>
                    </list>
                  </item>
                  <item key="mandatory" type="int">1</item>
                  <item key="name"><![CDATA[Align]]></item>
                  <item key="type"><![CDATA[select]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[text]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[Text]]></item>
                  <item key="type"><![CDATA[richtext]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="default"><![CDATA[##
return context.getTextFormatDefault()]]>
                  </item>
                  <item key="id"><![CDATA[format]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="name"><![CDATA[Format]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[textalign]]></item>
                  <item key="keys" type="list">
                    <list>
                      <item><![CDATA[LEFT]]></item>
                      <item><![CDATA[RIGHT]]></item>
                      <item><![CDATA[CENTER]]></item>
                    </list>
                  </item>
                  <item key="mandatory" type="int">1</item>
                  <item key="name"><![CDATA[Text-Align]]></item>
                  <item key="type"><![CDATA[select]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSGraphic.titlealt"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext=None
##title=py: DC.Title.Alt
##
# --// BO titlealt //--

try:
    titlealt = zmscontext.attr('text')
    img = zmscontext.attr('img')
    if titlealt:
        if len(titlealt) < 24:
            return titlealt
        else:
            return '%s...'%(titlealt)
    else:
        return img.getFilename() 
except:
    return zmscontext.display_type(zmscontext.REQUEST)

# --// EO titlealt //--
]]>
                  </item>
                  <item key="id"><![CDATA[titlealt]]></item>
                  <item key="name"><![CDATA[DC.Title.Alt]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSGraphic.getHref2IndexHtml"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext=None,options=None
##title=py: Function: index_html
##
# --// getHref2IndexHtml //--

img = zmscontext.attr('img')
if img:
    return img.getHref(zmscontext.REQUEST)
return ''

# --// /getHref2IndexHtml //--
]]>
                  </item>
                  <item key="id"><![CDATA[getHref2IndexHtml]]></item>
                  <item key="name"><![CDATA[Function: index_html]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<!-- ZMSGraphic.standard_html -->

<tal:block tal:define="global
		zmscontext options/zmscontext;
		subclass      python:[zmscontext.meta_id];
		text          python:unicode(zmscontext.getText(request),'utf-8');
		format        python:unicode(zmscontext.attr('format'),'utf-8');
		textclass     python:'text';
		displaytype   python:zmscontext.dctDisplaytype.get(str(zmscontext.attr('displaytype')),'left');
		align         python:zmscontext.attr('align');
		textalign     python:zmscontext.attr('textalign');
		imgclass      python:'img img-responsive';
		imgurl        python:zmscontext.getLinkUrl(zmscontext.attr('attr_url'),request);
		isimghires    python:zmscontext.attr('imghires');
		imgthumb      python:request['URL'].find('/manage')>0;
		imgspecial    python:zmscontext.attr('img_attrs_spec')">
	<tal:block tal:condition="python:imgurl and isimghires">
		<tal:block
			tal:define="global text python:text+'\n<span class=\042imgurl\042>'+zmscontext.getLangStr('HREF_MORE',request['lang'])%(' href=\042%s\042'%imgurl)+'</span>';
			            global imgurl python:''">
		</tal:block>
	</tal:block>
	<tal:block
		tal:define="global renderedtext python:zmscontext.renderText(format,'text',text,request);
		            global bodyContent python:zmscontext.renderDisplaytype(displaytype,'img','imghires',imgurl,imgthumb,imgspecial,imgclass,renderedtext,textalign,textclass,request)">
	</tal:block>
	<tal:block tal:condition="python:align in [ 'LEFT', 'CENTER', 'RIGHT']">
		<tal:block tal:define="global subclass python:subclass+[align.lower()]"></tal:block>
	</tal:block>
	<tal:block tal:condition="python:align in [ 'LEFT_FLOAT'] and displaytype in [ 'top', 'bottom']">
		<tal:block tal:define="global subclass python:subclass+['floatleft']"></tal:block>
	</tal:block>
	<tal:block tal:condition="python:align in [ 'RIGHT_FLOAT'] and displaytype in [ 'top', 'bottom']">
		<tal:block tal:define="global subclass python:subclass+['floatright']"></tal:block>
	</tal:block>
	<div tal:attributes="id python:zmscontext.id; class python:' '.join(subclass)" tal:content="structure bodyContent">
		The graphic
	</div>
</tal:block>

<!-- /ZMSGraphic.standard_html -->]]>
                  </item>
                  <item key="id"><![CDATA[standard_html]]></item>
                  <item key="name"><![CDATA[Template: ZMSGraphic]]></item>
                  <item key="type"><![CDATA[zpt]]></item>
                </dictionary>
              </item>
            </list>
          </item>
          <item key="access" type="dictionary">
            <dictionary>
              <item key="delete_custom"></item>
              <item key="delete_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
              <item key="insert_custom"><![CDATA[{$}]]></item>
              <item key="insert_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
            </dictionary>
          </item>
          <item key="enabled" type="int">1</item>
          <item key="id"><![CDATA[ZMSGraphic]]></item>
          <item key="name"><![CDATA[ZMSGraphic]]></item>
          <item key="package"><![CDATA[com.zms.foundation]]></item>
          <item key="revision"><![CDATA[3.3.2]]></item>
          <item key="type"><![CDATA[ZMSObject]]></item>
        </dictionary>
      </item>
    </dictionary>
  </item>
  <item type="dictionary">
    <dictionary>
      <item key="key"><![CDATA[ZMSLib]]></item>
      <item key="value" type="dictionary">
        <dictionary>
          <item key="__obj_attrs__" type="list">
            <list>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[f_css_defaults]]></item>
                  <item key="name"><![CDATA[CSS: Default]]></item>
                  <item key="type"><![CDATA[resource]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<!-- bodyContentZMSLib_page -->

	<tal:block tal:condition="python:here.meta_id in ['ZMS','ZMSFolder','ZMSDocument']" tal:define="global 
		childNodes python:here.getObjChildren('e',request,here.PAGEELEMENTS)">
			<tal:block tal:repeat="childNode childNodes" tal:content="structure python:childNode.getBodyContent(request)">
				The page-element body-content
			</tal:block>
	</tal:block>
	<tal:block tal:condition="python:here.meta_id not in ['ZMS','ZMSFolder','ZMSDocument']">
		<tal:block tal:content="structure python:here.getBodyContent(request)">
			The body-content
		</tal:block>
	</tal:block>

<!-- /bodyContentZMSLib_page -->]]>
                  </item>
                  <item key="id"><![CDATA[bodyContentZMSLib_page]]></item>
                  <item key="name"><![CDATA[Template: Page]]></item>
                  <item key="type"><![CDATA[Page Template]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSLib.uploadMedia"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext=None
##title=py: Upload: Media
##
# --// BO uploadMedia //--
from Products.zms import pilutil

result = {}
temp_folder = context.temp_folder
request = context.REQUEST
base_url = request.get('SERVER_URL')
session_id = request.get('session_id')
form_id = request.get('form_id')
file = request.get('file')

def resize_image(context, orig, maxdims):
  width = orig.getWidth()
  height = orig.getHeight()
  while width > maxdims or height > maxdims:
    if width > maxdims:
      height = int(height * maxdims / width)
      width = maxdims
    elif height > maxdims:
      width = int(width * maxdims / height)
      height = maxdims
  size = (width,height)
  blob = pilutil.resize( orig, size)
  return blob

def create_blob(container, blob):
  filename = blob.getFilename()
  data = blob.getData()
  id = session_id + '_' + form_id + '_' + filename
  if id in container.objectIds():
    container.manage_delObjects(ids=[id])
  if blob.getContentType().startswith('image'):
    container.manage_addImage( id=id, title=filename, file=data)
  else:
    container.manage_addFile( id=id, title=filename, file=data)
  ob = getattr(container,id)
  d = {}
  d['content_type'] = blob.getContentType()
  d['filename'] = blob.getFilename()
  d['absolute_url'] = ob.absolute_url()[len(base_url):]
  return d

if file and file.filename:
  blobs = {}
  blob = context.FileFromData(file,file.filename)
  content_type = blob.getContentType()
  if content_type.startswith('image'):
    image = context.ImageFromData(file,file.filename)
    maxdims = int(context.getConfProperty('InstalledProducts.pil.thumbnail.max'))
    if image.getWidth() > maxdims:
      result['imghires'] = create_blob(temp_folder,image)
      result['image'] = create_blob(temp_folder,resize_image(context, image, maxdims))
    else:
      result['image'] = create_blob(temp_folder,image)
  else:
    result['file'] = create_blob(temp_folder,blob)

result['message'] = context.getZMILangStr( 'MSG_UPLOADED')
return context.str_json(result)

# --// EO uploadMedia //--
]]>
                  </item>
                  <item key="id"><![CDATA[uploadMedia]]></item>
                  <item key="name"><![CDATA[Upload: Media]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<!-- ZMSLib.show_version -->

<tal:block tal:define="global zmscontext options/zmscontext">
	<tal:block tal:condition="python:zmscontext.getHistory()">
		<script>
		<!--
			function showHistory(el) {
				var v = $(el).val();
				var version_nr = v.substr(0,v.indexOf(" "));
				var version_dt = v.substr(v.indexOf(" ")+1);
				$(el).prop('selectedIndex',0);
				$.get("ajaxBodyContentObjHistory",{lang:$("input#lang").val(),version_nr:version_nr,revision:1,ts:new Date()},function(data) {
					var $xml = $( data );
					var body = $xml.find( "ObjHistory" );
					var title = $xml.find("title").text();
					var description = $xml.find("description").text();
					if ($("div#revision").length==0) {
						$("body").append('<'+'div id="revision"><'+'/div>');
					}
					var html = ''
						+ '<'+'div id="flow" class="hyphenate">'
						+ '<'+'article>'
						+ '<'+'header>'
						+ '<'+'h1 style="font-weight:bold!important">'+title+'<'+'/h1>'
						+ '<'+'p style="text-decoration:italic!important" class="description">'+description+'<'+'/p>'
						+ '<'+'/header>'
						+ '<'+'/section>';
					for (var i = 0; i < body.length; i++) {
						html += $(body[i]).text();
					}
					html += ''
						+ '<'+'/section>';
						+ '<'+'/article>';
						+ '<'+'/div>';
					$("div#revision").html(html);
					showFancybox({
						'href':'#revision',
						'title':'r'+v,
						'autoDimensions':true,
						'transitionIn':'fade',
						'transitionOut':'fade',
						onCleanup:function() {
							$("div#revision").remove();
						}
					});
					$("div#revision>div").show();
				});
			}
		-->
		</script>
		<input type="hidden" id="lang" name="lang" tal:attributes="value request/lang"/>
		<select onchange="showHistory(this)">
			<option value="" tal:content="python:'--- %s ---'%zmscontext.getLangStr('TAB_HISTORY',request['lang'])">the history</option>
			<tal:block tal:define="global 
					change_history python:zmscontext.attr('change_history');
					rchange_history python:map(lambda x: change_history[len(change_history)-(x+1)], range(len(change_history)))"
					tal:repeat="history rchange_history">
				<option
						tal:attributes="value python:'%i.%i.%i %s'%(history['master_version'],history['major_version'],0,zmscontext.getLangFmtDate(history['version_dt'],request['lang'],'SHORTDATETIME_FMT'))" 
						tal:content="python:'r%i.%i.%i (%s)'%(history['master_version'],history['major_version'],0,zmscontext.getLangFmtDate(history['version_dt'],request['lang'],'SHORTDATETIME_FMT'))">version_nr version_dt</option>
			</tal:block>
		</select>
	</tal:block>
</tal:block>

<!-- /ZMSLib.show_version -->]]>
                  </item>
                  <item key="id"><![CDATA[show_version]]></item>
                  <item key="name"><![CDATA[Show version]]></item>
                  <item key="type"><![CDATA[zpt]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "index_html"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=
##title=Index-Html
##
# --// index_html //--

request = container.REQUEST
RESPONSE =  request.RESPONSE
RESPONSE.redirect(context.objectValues(['ZMS'])[0].getHref2IndexHtml(request,deep=False), status=301)

# --// /index_html //--
]]>
                  </item>
                  <item key="id"><![CDATA[index_html]]></item>
                  <item key="name"><![CDATA[Index-Html]]></item>
                  <item key="type"><![CDATA[Script (Python)]]></item>
                </dictionary>
              </item>
            </list>
          </item>
          <item key="access" type="dictionary">
            <dictionary>
              <item key="delete_custom"></item>
              <item key="delete_deny" type="list">
                <list>
                </list>
              </item>
              <item key="insert_custom"></item>
              <item key="insert_deny" type="list">
                <list>
                </list>
              </item>
            </dictionary>
          </item>
          <item key="enabled" type="int">0</item>
          <item key="id"><![CDATA[ZMSLib]]></item>
          <item key="name"><![CDATA[ZMSLib]]></item>
          <item key="package"><![CDATA[com.zms.foundation]]></item>
          <item key="revision"><![CDATA[3.1.1]]></item>
          <item key="type"><![CDATA[ZMSLibrary]]></item>
        </dictionary>
      </item>
    </dictionary>
  </item>
  <item type="dictionary">
    <dictionary>
      <item key="key"><![CDATA[ZMSLinkContainer]]></item>
      <item key="value" type="dictionary">
        <dictionary>
          <item key="__obj_attrs__" type="list">
            <list>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[icon-link]]></item>
                  <item key="id"><![CDATA[icon_clazz]]></item>
                  <item key="name"><![CDATA[Icon (Class)]]></item>
                  <item key="type"><![CDATA[constant]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[div.ZMSLinkContainer {
	background-color: #eee;
}]]>
                  </item>
                  <item key="id"><![CDATA[f_css_defaults]]></item>
                  <item key="name"><![CDATA[CSS: Defaults]]></item>
                  <item key="type"><![CDATA[resource]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<tal:block tal:condition="not:python:request.get('ZMS_INSERT')">
<tal:block tal:define="global
		zmscontext options/zmscontext;">

<style>
table.ZMSLinkContainer td.meta-sort .input-append {
	width: 68px;
}
table.ZMSLinkContainer td.meta-sort select.zmi-sort {
    width: 3em !important;
}
.zmi-manage-main-change div.constraint {
	display:block;
	max-width:200px;
	overflow:hidden;
}
</style>

<!--
################################################################################
##### Align: EDIT
################################################################################
-->
<div class="form-group" id="tr_align" tal:condition="python:zmscontext.getParentNode().meta_id in ['ZMS','ZMSFolder','ZMSDocument']">
	<label class="col-sm-2 control-label" for="title_ger"><span tal:content="structure python:here.getZMILangStr('ALIGN')">Align</span></label>
	<div class="col-sm-10" tal:content="structure python:zmscontext.getObjInput('align',request)">the align-input</div>
</div>

<table class="table table-striped table-bordered zmi-sortable ZMSLinkContainer">
<tr>
	<colgroup>
		<col style="width:5%">
		<col style="width:30%">
		<col style="width:30%">
		<col style="width:30%">
		<col style="width:5%">
	</colgroup> 
	<th>&nbsp;</th>
	<th>
		<label for="_url" tal:content="structure python:here.getZMILangStr('ATTR_URL')">Url*</label>
	</th>
	<th>
		<label for="_title" tal:content="structure python:here.getZMILangStr('ATTR_TITLE')">Title*</label>
	</th>
	<th colspan="2">
		<label for="_description" tal:content="structure python:here.getZMILangStr('ATTR_DESCRIPTION')">Description</label>
	</th>
</tr>

<!--
################################################################################
##### Link-Elements: EDIT
################################################################################
-->
<tal:block tal:condition="python:request.get( 'ZMS_INSERT', None)==None">
<tal:block tal:define="objChildren python:zmscontext.getObjChildren('e',request); hasChildren python:len(objChildren)>0">
<tr tal:repeat="childNode objChildren">
	<td class="meta-sort">
		<div class="input-append">
			<select class="zmi-sort" tal:attributes="onchange python:'location.href=\'%s/manage_moveObjToPos?lang=%s&pos:int=\'+(this.selectedIndex+1)'%(childNode.id,request['lang'])">
				<tal:block tal:repeat="seqindex python:range(len(objChildren))">
					<option tal:attributes="selected python:['','selected'][int(seqindex==objChildren.index(childNode))]" tal:content="python:seqindex+1">seqindex+1</option>
				</tal:block>
			</select>
			<span class="add-on btn" tal:attributes="onclick python:'if (confirm(getZMILangStr(\'MSG_CONFIRM_DELOBJ\'))){self.location.href=\'manage_deleteObjs?ids:list=%s&lang=%s&preview=%s\'}'%(childNode.id,request['lang'],request['preview']); title python:here.getZMILangStr('BTN_DELETE')">
				<tal:block tal:content="structure python:here.zmi_icon(name='icon-remove')"></tal:block>
			</span>
		</div><!-- .input-append -->
	</td>
	<td tal:content="structure python:childNode.getUrlInput(fmName='form0',elName='url%s'%(childNode.getId()),elTextName='title%s'%(childNode.getId()),size=15,value=childNode.getObjAttrValue(childNode.getObjAttr('attr_ref'),request),enabled=1,REQUEST=request)"><input/></td>
	<td tal:content="structure python:childNode.getTextInput(fmName='form0',elName='title%s'%(childNode.getId()),size=15,value=childNode.getObjAttrValue(childNode.getObjAttr('title'),request),enabled=1,REQUEST=request)"><input/></td>
	<td tal:content="structure python:childNode.getTextArea(fmName='form0',elName='description%s'%(childNode.getId()),cols=20,rows=2,value=childNode.getObjAttrValue(childNode.getObjAttr('attr_dc_description'),request),enabled=1,REQUEST=request)"><textarea/></td>
	<td>
		<div class="zmi-manage-main-change" style="display:block;visibility:visible" tal:content="structure python:childNode.zmi_manage_main_change(childNode,request)">
			the info child-node
		</div>
	</td>
</tr>
</tal:block>
</tal:block>
<!--
################################################################################
##### Link-Elements: INSERT
################################################################################
-->
<tal:block tal:define="global dummy0 python:request.set( 'ZMS_INSERT', 'ZMSLinkElement')"></tal:block>
<tr class="row_insert">
	<td class="meta-sort"><tal:block tal:content="structure python:here.zmi_icon(name='icon-plus')"></tal:block></td>
	<td tal:content="structure python:here.getUrlInput(fmName='form0',elName='url_',elTextName='_title',size=15,value='',enabled=1,REQUEST=request)"><input/></td>
	<td tal:content="structure python:here.getTextInput(fmName='form0',elName='title_',size=15,value='',enabled=1,REQUEST=request)"><input/></td>
	<td colspan="2"
		tal:content="structure python:here.getTextArea(fmName='form0',elName='description_',cols=20,rows=2,value='',enabled=1,REQUEST=request)"><textarea/>
	</td>
</tr>
<tal:block tal:define="global dummy0 python:request.set( 'ZMS_INSERT', None)"></tal:block>

</table>

</tal:block>
</tal:block>
<tal:block tal:define="dummy0 python:request.set('ZMS_HIDE_ELEMENTS',request.get('ZMS_HIDE_ELEMENTS',[])+['align','e'])"></tal:block>]]>
                  </item>
                  <item key="id"><![CDATA[interface0]]></item>
                  <item key="name"><![CDATA[interface0]]></item>
                  <item key="type"><![CDATA[interface]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[align]]></item>
                  <item key="keys" type="list">
                    <list>
                      <item><![CDATA[LEFT]]></item>
                      <item><![CDATA[LEFT_FLOAT]]></item>
                      <item><![CDATA[RIGHT]]></item>
                      <item><![CDATA[RIGHT_FLOAT]]></item>
                      <item><![CDATA[NONE]]></item>
                    </list>
                  </item>
                  <item key="mandatory" type="int">1</item>
                  <item key="name"><![CDATA[Align]]></item>
                  <item key="type"><![CDATA[select]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[e]]></item>
                  <item key="name"><![CDATA[Link-Elements]]></item>
                  <item key="repetitive" type="int">1</item>
                  <item key="type"><![CDATA[ZMSLinkElement]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSLinkContainer.onChangeObjEvt"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext
##title=py: Event: onChangeObj
##
# --// BO onChangeObjEvt //--

def equals(o, d):
  for k in d.keys():
    if o.attr(k) != d[k]:
      return False
  return True

request = zmscontext.REQUEST
lang = request['lang']
if request.get('btn') == zmscontext.getZMILangStr('BTN_SAVE'):
  align = zmscontext.attr('align')
  # Save.
  for childNode in zmscontext.getChildNodes(request,['ZMSLinkElement']):
    id = childNode.id
    url = request['url%s'%id].strip()
    title = request['title%s'%id].strip()
    description = request['description%s'%id].strip()
    attr_type = ['new','replace'][int(url.startswith('{$') and url.endswith('}'))]
    d = {'title':title,'titlealt':title,'attr_ref':url,'attr_dc_description':description,'attr_type':attr_type,'align':align}
    if not equals(childNode,d):
      childNode.setObjStateModified(request)
      for k in d.keys():
        childNode.setObjProperty(k,d[k],lang)
      childNode.onChangeObj(request)
  # Insert.
  id = '_'
  url = request['url%s'%id].strip()
  if len(url) > 0:
    title = request['title%s'%id].strip()
    description = request['description%s'%id].strip()
    attr_type = ['new','replace'][int(url.startswith('{$') and url.endswith('}'))]
    d = {'title':title,'titlealt':title,'attr_ref':url,'attr_dc_description':description,'attr_type':attr_type,'align':align}
    childNode = zmscontext.manage_addZMSCustom('ZMSLinkElement',d,request)

# --// EO onChangeObjEvt //--
]]>
                  </item>
                  <item key="id"><![CDATA[onChangeObjEvt]]></item>
                  <item key="name"><![CDATA[Event: onChangeObj]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<!-- ZMSLinkContainer.standard_html -->

<tal:block tal:define="global 
		zmscontext options/zmscontext;
		subclass      python:[zmscontext.meta_id];
		align         python:zmscontext.attr('align')">
  <tal:block tal:condition="python:align in [ 'LEFT', 'CENTER', 'RIGHT']">
    <tal:block tal:define="global subclass python:subclass+[align.lower()]"></tal:block>
  </tal:block>
  <tal:block tal:condition="python:align in [ 'LEFT_FLOAT']">
    <tal:block tal:define="global subclass python:subclass+['floatleft']"></tal:block>
  </tal:block>
  <tal:block tal:condition="python:align in [ 'RIGHT_FLOAT']">
    <tal:block tal:define="global subclass python:subclass+['floatright']"></tal:block>
  </tal:block>
  <div tal:condition="python:len(subclass)>0"
       tal:attributes="id python:zmscontext.id; class python:' '.join(subclass)"
       tal:content="structure python:unicode(''.join(map(lambda x:x.renderShort(request),zmscontext.filteredChildNodes(request,'ZMSLinkElement'))),'utf-8')">
    The content
  </div>
</tal:block>

<!-- /ZMSLinkContainer.standard_html -->]]>
                  </item>
                  <item key="id"><![CDATA[standard_html]]></item>
                  <item key="name"><![CDATA[Template: ZMSLinkContainer]]></item>
                  <item key="type"><![CDATA[zpt]]></item>
                </dictionary>
              </item>
            </list>
          </item>
          <item key="access" type="dictionary">
            <dictionary>
              <item key="delete_custom"></item>
              <item key="delete_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
              <item key="insert_custom"><![CDATA[{$}]]></item>
              <item key="insert_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
            </dictionary>
          </item>
          <item key="enabled" type="int">1</item>
          <item key="id"><![CDATA[ZMSLinkContainer]]></item>
          <item key="name"><![CDATA[ZMSLinkContainer]]></item>
          <item key="package"><![CDATA[com.zms.foundation]]></item>
          <item key="revision"><![CDATA[3.1.7]]></item>
          <item key="type"><![CDATA[ZMSObject]]></item>
        </dictionary>
      </item>
    </dictionary>
  </item>
  <item type="dictionary">
    <dictionary>
      <item key="key"><![CDATA[ZMSLinkElement]]></item>
      <item key="value" type="dictionary">
        <dictionary>
          <item key="__obj_attrs__" type="list">
            <list>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[icon-link]]></item>
                  <item key="id"><![CDATA[icon_clazz]]></item>
                  <item key="name"><![CDATA[Icon (Class)]]></item>
                  <item key="type"><![CDATA[constant]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[/* @see ZMSFile.f_css_defaults */]]></item>
                  <item key="id"><![CDATA[f_css_defaults]]></item>
                  <item key="name"><![CDATA[CSS: Default]]></item>
                  <item key="type"><![CDATA[resource]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[titlealt]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Title.Alt]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[title]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Title]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<div id="inferface0" tal:define="global
		zmscontext options/zmscontext;
		dummy0 python:request.set('beforeSubmitBtnClick','if ( zmiOnSubmitEventHandler(this)) { ');
		dummy0 python:request.set('afterSubmitBtnClick',' } ')">
<script type="text/javascript">
<!--//

var btn = null;
var remoteHref = null;
var remoteHrefValid = false;
var remoteHrefResponseWaiting = false;
var remoteHrefResponseTimeout = 5000;

function zmiOnSubmitEventHandler(el) {
	btn = el;
	if ($("#attr_type").val() == "remote") {
		var href = $("#attr_ref").val();
		if ( !remoteHrefValid || remoteHref != href) {
			remoteHref = href;
			remoteHrefValid = false;
			remoteHrefResponseWaiting = true;
			self.btnClicked = 'break';
			// Set wait-cursor.
			$(document.body).css( "cursor", "wait");
			// JQuery.AJAX.get
			$.get( remoteHref+"/ajaxGetBodyContent", remoteResponse);
			// Set time-out.
			setTimeout("remoteResponseTimedout()",remoteHrefResponseTimeout);
		}
		return remoteHrefValid;
	}
	return true;
}

function remoteResponse(data) {
	if (remoteHrefResponseWaiting) {
		remoteHrefResponseWaiting = false;
		// Reset wait-cursor.
		$(document.body).css( "cursor", "auto");
		//
		$("#attr_ref").removeClass("form-error");
		remoteHrefValid = true;
		btn.click();
	}
}

function remoteResponseTimedout() {
	if (remoteHrefResponseWaiting) {
		remoteHrefResponseWaiting = false;
		// Reset wait-cursor.
		$(document.body).css( "cursor", "auto");
		//
		$("#attr_ref").addClass("form-error");
		remoteHrefValid = false;
		if (confirm( "Time-Out "+getZMILangStr('ATTR_URL')+": "+remoteHref)) {
			remoteHrefValid = true;
			btn.click();
		}
	}
}

initAttrRef = function() {
		var v = $(this).val();
		var $select = $("select#attr_type");
		$("option",$select).each(function() {
			$(this).prop("disabled","");
			if (v.indexOf("{$")!=0 && $.inArray($(this).prop("value"),["embed","recursive","remote"])>=0) {
				$(this).prop("disabled","disable");
			}
		});
	};

$(function(){

	$ZMI.afterInitInputFields(function() {
		$("input#attr_ref").each(function() {
				var $input = $(this);
				var $inputgroup = $input.parent();
				if ($input.val().indexOf('{$')==0 && $input.prop("disabled")) {
					$input.attr("data-value",$input.val());
					if ($(".dropdown.languages .dropdown-menu li").length>0) {
						var html = ''
							+ '<div class="btn-group">'
							+ '<button type="button" class="dropdown-toggle btn btn-default" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'
								+ $ZMI.icon("icon-flag")
							+ '</button>'
							+ '<ul class="dropdown-menu">'
							+ '<li><a href="#" data-language="">'+$ZMI.icon("icon-check-empty")+' Default</a></li>';
						$(".dropdown.languages .dropdown-menu li").each(function() {
								html += '<li><a href="#" data-language="'+$("a",this).attr("data-language")+'">'+$ZMI.icon("icon-check-empty")+' '+$("a",this).text()+'</a></li>';
							});
						html += ''
							+ '</ul>'
							+ '</div><!-- .btn-group -->';
						$(".input-group-addon",$inputgroup).html(html).addClass("input-group-dropdown");
						var fn = function() {
								var v = $("#ref_lang").val();
								var attr_ref = $input.attr("data-value");
								if (v!="") {
									attr_ref = attr_ref.replace(/;lang\=\w*/gi,'');
									attr_ref = attr_ref.substr(0,attr_ref.indexOf('}'));
									attr_ref += ';lang='+v+'}';
								}
								$input.val(attr_ref).change();
								$(".input-group-addon button .icon-flag",$inputgroup).removeClass("text-muted text-primary").addClass(v==""?"text-muted":"text-primary");
								$(".input-group-addon .dropdown-menu li a",$inputgroup).each(function() {
										$(".icon-check",this).toggleClass("icon-check-empty icon-check");
										if (v==$(this).attr("data-language")) {
											$(".icon-check-empty",this).toggleClass("icon-check-empty icon-check");
										}
									});
							};
						fn();
						$(".input-group-addon .dropdown-menu li a",$inputgroup)
							.click(function() {
									$("#ref_lang").val($(this).attr("data-language"));
									fn();
								});
					}
				}
				else {
				$("#ref_lang").val("");
				}
			});
		});

	$("input#attr_ref").change(initAttrRef).change();
	$("#tr_attr_ref_type select").css("width", "100%");
});

//-->
</script>
<!--
################################################################################
##### Ref & Type: EDIT
################################################################################
-->
<input type="hidden" id="ref_lang" tal:attributes="name python:'ref_lang_%s'%request['lang']; value python:zmscontext.attr('ref_lang')"/>
<div class="form-group controls-row" id="tr_attr_ref">
	<label class="col-sm-2 col-md-2 col-lg-2 control-label mandatory" for="attr_ref"><span tal:content="structure python:here.getZMILangStr('ATTR_URL')">Url</span></label>
	<div class="col-sm-10">
		<div class="pull-left" style="width:50%">
			<tal:block tal:content="structure python:zmscontext.getObjInput('attr_ref',request)">the ref-input</tal:block>
		</div>
		<div id="tr_attr_ref_type" class="form-inline" style="width:50%;float:right" tal:content="structure python:zmscontext.getObjInput('attr_type',request)">the type-input</div>
	</div>
</div>
<!--
################################################################################
##### Embedded Object: PREVIEW
################################################################################
-->
<div class="form-group controls-row" id="tr_attr_preview" tal:condition="not:python:request.get('ZMS_INSERT')">
<label class="col-sm-2 control-label" for="attr_ref_preview"><span></span></label>
	<div id="attr_ref_preview" class="col-sm-10 attr_ref_preview"
		tal:attributes="style python:['background-color:#fff','background-color:#eee'][int(zmscontext.isPage())]"
		tal:content="structure python:zmscontext.renderShort(request)">
			renderShort
	</div>
</div>
<tal:block tal:define="global dummy0 python:request.set('ZMS_HIDE_ELEMENTS',request.get('ZMS_HIDE_ELEMENTS',[])+['attr_ref','ref_lang','attr_type'])"></tal:block>
</div>]]>
                  </item>
                  <item key="id"><![CDATA[inferface0]]></item>
                  <item key="name"><![CDATA[inferface0]]></item>
                  <item key="type"><![CDATA[interface]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_ref]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="name"><![CDATA[Reference]]></item>
                  <item key="type"><![CDATA[url]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[ref_lang]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[Reference (lang)]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_type]]></item>
                  <item key="keys" type="list">
                    <list>
                      <item><![CDATA[replace]]></item>
                      <item><![CDATA[new]]></item>
                      <item><![CDATA[embed]]></item>
                      <item><![CDATA[recursive]]></item>
                      <item><![CDATA[remote]]></item>
                      <item><![CDATA[iframe]]></item>
                    </list>
                  </item>
                  <item key="mandatory" type="int">1</item>
                  <item key="name"><![CDATA[Type]]></item>
                  <item key="type"><![CDATA[select]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[align]]></item>
                  <item key="keys" type="list">
                    <list>
                      <item><![CDATA[LEFT]]></item>
                      <item><![CDATA[LEFT_FLOAT]]></item>
                      <item><![CDATA[RIGHT]]></item>
                      <item><![CDATA[RIGHT_FLOAT]]></item>
                      <item><![CDATA[NONE]]></item>
                    </list>
                  </item>
                  <item key="mandatory" type="int">1</item>
                  <item key="name"><![CDATA[Align]]></item>
                  <item key="type"><![CDATA[select]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[TAB_METADATA]]></item>
                  <item key="name"><![CDATA[TAB_METADATA]]></item>
                  <item key="type"><![CDATA[delimiter]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_dc_description]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Description]]></item>
                  <item key="type"><![CDATA[text]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_dc_creator]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Creator]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSLinkElement.attr_url"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext=None,options=None
##title=py: Alias: Url
##
# --// attr_url //--

request = zmscontext.REQUEST
lang = request.get('lang',zmscontext.getPrimaryLanguage())
ref = zmscontext.attr('attr_ref')
if ref.startswith('{$') and ref.endswith('}'):
  ref_lang = zmscontext.attr('ref_lang')
  if lang != zmscontext.getPrimaryLanguage() and len(ref_lang) > 0:
    ref = zmscontext.re_sub(';lang\\=\\w*','',ref)
    ref = ref[:-1]
    ref += ';lang='+ref_lang+'}'
return ref

# --// /attr_url //--
]]>
                  </item>
                  <item key="id"><![CDATA[attr_url]]></item>
                  <item key="name"><![CDATA[Alias: Url]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSLinkElement.attr_abstract"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext=None,options=None
##title=py: Alias: Abstract
##
# --// attr_abstract //--

return zmscontext.attr('attr_dc_description')

# --// /attr_abstract //--
]]>
                  </item>
                  <item key="id"><![CDATA[attr_abstract]]></item>
                  <item key="name"><![CDATA[Alias: Abstract]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSLinkElement.check_constraints"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext=None,options=None
##title=py: Hook: check constraints
##
# --// check_constraints //--

constraints = {}
request = zmscontext.REQUEST
try:
  ref = zmscontext.getRef()
  if ref.startswith('{$') and ref.endswith('}'):
    ref_obj = zmscontext.getRefObj()
    if ref_obj is None:
      constraints['ERRORS'] = constraints.get('ERRORS',[])
      constraints['ERRORS'].append(('ref-obj','link-target not found: '+str(ref)))
except:
  constraints['ERRORS'] = constraints.get('ERRORS',[])
  constraints['ERRORS'].append(('ref-obj',zmscontext.writeError('can\'t check_constraints')))
return constraints

# --// /check_constraints //--
]]>
                  </item>
                  <item key="id"><![CDATA[check_constraints]]></item>
                  <item key="name"><![CDATA[Hook: Check constraints]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<!-- ZMSLinkElement.standard_html -->

<tal:block tal:on-error="structure string:<!-- URL ERROR -->" tal:define="global
		zmscontext options/zmscontext;
		zmsid         python:zmscontext.getId();
		title         python:zmscontext.attr('title');
		titlealt      python:zmscontext.attr('titlealt');
		ref           python:zmscontext.attr('attr_url');
		target        python:zmscontext.attr('attr_type');
		align         python:zmscontext.attr('align');
		abstract      python:zmscontext.attr('attr_abstract').replace('\n','<br/>');
		subclass      python:[zmscontext.meta_id]+[['external','internal'][int(ref.startswith('{$') and ref.endswith('}'))]];"
	><tal:block tal:condition="python:target!='iframe'"
		><tal:block tal:condition="python:align in [ 'LEFT', 'CENTER', 'RIGHT']"
			><tal:block tal:define="global subclass python:subclass+[align.lower()]"></tal:block
		></tal:block
		><tal:block tal:condition="python:align in [ 'LEFT_FLOAT']"
			><tal:block tal:define="global subclass python:subclass+['floatleft']"></tal:block
		></tal:block
		><tal:block tal:condition="python:align in [ 'RIGHT_FLOAT']"
			><tal:block tal:define="global subclass python:subclass+['floatright']"></tal:block
		></tal:block
		><div tal:condition="python:zmscontext.getParentNode().meta_id=='ZMSLinkContainer' or align not in ['','NONE'] or request.get('URL','').find('/manage')>0"
				tal:attributes="id python:zmscontext.id; class python:' '.join(subclass)">
			<div class="title" tal:condition="title">
				<tal:block tal:content="structure python:zmscontext.tal_anchor(zmscontext.getLinkUrl(ref,request),target=['','_blank'][int(zmscontext.attr('attr_type')=='new')],content=titlealt)">the link</tal:block>
			</div>
			<div tal:condition="python:title and title!=titlealt" class="text" tal:content="structure title">The title</div>
			<div tal:condition="python:abstract" class="description" tal:content="structure abstract">The abstract</div>
		</div>
	</tal:block
	><tal:block tal:condition="python:target=='iframe'"
		><iframe class="ZMSLinkElement" tal:attributes="src ref; id zmsid" style="width:100%;padding:0;margin:0;border:0;min-height:260px;background-color:#f5f5f5">IFRAME CONTENT</iframe>
		<tal:block tal:replace="structure python:'<script type=\042text/javascript\042>'"></tal:block>
			// $ZMI Register function: On Docment Ready the iFrameResizer Script will be Executed
			// IMOPRTANT HINT: Targetted Content Needs to be linked to the iframeResizer.contentWindow Script:
			// /++resource++zms_/iframeresizer/iframeResizer.contentWindow.min.js
			// SOURCE: https://github.com/davidjbradshaw/iframe-resizer/blob/master/js/iframeResizer.contentWindow.min.js
			if (typeof(ZMI)!='undefined') {
				$ZMI.registerReady(function() {
					try {
						<tal:block tal:replace="python:'iFrameResize({},\047iframe#%s.ZMSLinkElement\047);'%(zmsid)"></tal:block>
					}
					catch(err) {
					}
				})
			}
		<tal:block tal:replace="structure string:</script>"></tal:block>
		<script tal:condition="python:request.get('link_iframeResizer',True)"
			src="/++resource++zms_/iframeresizer/iframeResizer.min.js"></script>
		<tal:block tal:define="iframeexists python:request.set('link_iframeResizer',False)"></tal:block>
	</tal:block>
</tal:block>

<!-- /ZMSLinkElement.standard_html -->]]>
                  </item>
                  <item key="id"><![CDATA[standard_html]]></item>
                  <item key="name"><![CDATA[Template: ZMSLinkElement]]></item>
                  <item key="type"><![CDATA[zpt]]></item>
                </dictionary>
              </item>
            </list>
          </item>
          <item key="access" type="dictionary">
            <dictionary>
              <item key="delete_custom"></item>
              <item key="delete_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
              <item key="insert_custom"><![CDATA[{$}]]></item>
              <item key="insert_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
            </dictionary>
          </item>
          <item key="enabled" type="int">1</item>
          <item key="id"><![CDATA[ZMSLinkElement]]></item>
          <item key="name"><![CDATA[ZMSLinkElement]]></item>
          <item key="package"><![CDATA[com.zms.foundation]]></item>
          <item key="revision"><![CDATA[3.1.19]]></item>
          <item key="type"><![CDATA[ZMSObject]]></item>
        </dictionary>
      </item>
    </dictionary>
  </item>
  <item type="dictionary">
    <dictionary>
      <item key="key"><![CDATA[ZMSNote]]></item>
      <item key="value" type="dictionary">
        <dictionary>
          <item key="__obj_attrs__" type="list">
            <list>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[icon-comment-alt]]></item>
                  <item key="id"><![CDATA[icon_clazz]]></item>
                  <item key="name"><![CDATA[Icon (Class)]]></item>
                  <item key="type"><![CDATA[constant]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[GIF89a    dtl  wxh !          !     ,      ,Ijdw!;x{/S Hc ;]]></item>
                  <item key="id"><![CDATA[zmsnote_bg.gif]]></item>
                  <item key="name"><![CDATA[Resource: Background]]></item>
                  <item key="type"><![CDATA[resource]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[text]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[Memotext]]></item>
                  <item key="type"><![CDATA[text]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<script language="JavaScript">
	$ZMI.registerReady(function(){
		$('#zmiIframeAddDialog textarea').attr('title','INFO: the note element is just for internal usage - it is not published');
		$('#zmiIframeAddDialog textarea').attr('placeholder','INFO: the note element is just for internal usage - it is not published');
	});
	</script>]]>
                  </item>
                  <item key="id"><![CDATA[interface]]></item>
                  <item key="name"><![CDATA[interface]]></item>
                  <item key="type"><![CDATA[interface]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[catalogText]]></item>
                  <item key="name"><![CDATA[Hook: Catalog-Text]]></item>
                  <item key="type"><![CDATA[constant]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<!-- ZMSNote.renderShort -->

<tal:block tal:define="global zmscontext options/zmscontext;
	ishtml python:zmscontext.attr('text').find('<');
	id python:zmscontext.id;
	containerid python:'contentEditable_%s_%s'%(id,request.get('lang','ger'))">

<tal:block tal:condition="python:not request.get('ZMSNote.renderShort')">

<script language="JavaScript">
var firedZMSNoteDiv = false;
var repeatZMSNoteDiv = false;

function onKeyUpZMSNoteDiv(el) {
	if (!firedZMSNoteDiv) {
		firedZMSNoteDiv = true;
		setTimeout('onChangeZMSNoteDiv(\''+el.id+'\')',500);
	}
	else {
		repeatZMSNoteDiv = true;
	}
}

function onChangeZMSNoteDiv(id) {
	if (repeatZMSNoteDiv) {
		repeatZMSNoteDiv = false;
		setTimeout('onChangeZMSNoteDiv(\''+id+'\')',500);
	}
	else {
		firedZMSNoteDiv = false;
		repeatZMSNoteDiv = false;
		var el = $('div#'+id);
		var v = el.text();
		el.addClass('zmiTeaserColor');
		var lang = getZMILang();
		var params = {};
		params['lang'] = lang;
		params['text_'+lang] = v;
		$.post(id+'/manage_changeProperties',params,function(data){
			el.removeClass('zmiTeaserColor');
		},'html');
	}
}
</script>

<tal:block tal:define="global dummy0 python:request.set('ZMSNote.renderShort',True)"></tal:block>
</tal:block>

<div class="note alert alert-warning">
	<div 
		contentEditable="true"
		onkeyup="onKeyUpZMSNoteDiv(this)" 
		tal:attributes="id id;
			contentEditable python:'true' and ishtml<0 or 'false'; 
			onkeyup python:'onKeyUpZMSNoteDiv(this)' and ishtml<0 or None"
		tal:content="structure python:zmscontext.getText(request).replace('\n','<br/>')">the text</div>
</div>

</tal:block>

<!-- /ZMSNote.renderShort -->]]>
                  </item>
                  <item key="id"><![CDATA[renderShort]]></item>
                  <item key="name"><![CDATA[ZMI: Render short]]></item>
                  <item key="type"><![CDATA[zpt]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSNote.onChangeObjEvt"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext
##title=py: Event: onChangeObj
##
# --// BO onChangeObjEvt //--

request = zmscontext.REQUEST
zmscontext.commitObj(request)

# --// EO onChangeObjEvt //--
]]>
                  </item>
                  <item key="id"><![CDATA[onChangeObjEvt]]></item>
                  <item key="name"><![CDATA[Event: onChangeObj]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
            </list>
          </item>
          <item key="access" type="dictionary">
            <dictionary>
              <item key="delete" type="list">
                <list>
                  <item><![CDATA[ZMSAdministrator]]></item>
                  <item><![CDATA[ZMSAuthor]]></item>
                  <item><![CDATA[ZMSEditor]]></item>
                </list>
              </item>
              <item key="delete_custom"></item>
              <item key="insert" type="list">
                <list>
                  <item><![CDATA[ZMSAdministrator]]></item>
                  <item><![CDATA[ZMSAuthor]]></item>
                  <item><![CDATA[ZMSEditor]]></item>
                </list>
              </item>
              <item key="insert_custom"><![CDATA[{$}]]></item>
            </dictionary>
          </item>
          <item key="enabled" type="int">1</item>
          <item key="id"><![CDATA[ZMSNote]]></item>
          <item key="name"><![CDATA[ZMSNote]]></item>
          <item key="package"><![CDATA[com.zms.foundation]]></item>
          <item key="revision"><![CDATA[3.0.2]]></item>
          <item key="type"><![CDATA[ZMSObject]]></item>
        </dictionary>
      </item>
    </dictionary>
  </item>
  <item type="dictionary">
    <dictionary>
      <item key="key"><![CDATA[ZMSRichtext]]></item>
      <item key="value" type="dictionary">
        <dictionary>
          <item key="__obj_attrs__" type="list">
            <list>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[icon-file-text-alt]]></item>
                  <item key="id"><![CDATA[icon_clazz]]></item>
                  <item key="name"><![CDATA[Icon (Class)]]></item>
                  <item key="type"><![CDATA[constant]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<tal:block tal:define="global
		zmscontext options/zmscontext;
		session_id python:request.SESSION.getId();
		dummy0 python:request.set('CKEDITOR_config_toolbar',[
				['Format'],
				['Bold','Italic','Underline','NumberedList','BulletedList'],
				['Undo','Redo'],
				['mediabutton'],
				['Find','linkbutton','Link','Unlink'],
				['Anchor','Table'],
				['Source','ShowBlocks','Maximize','About']
			])">

<style>
span.active {
	background-color:#FFF;
	font-weight:bold;
}
span.mouseover {
	border:1px solid #999;
	background-color:#DFF1FF;
}
</style>

<!--
////////////////////////////////////////////////////////////////////////////////
/// CKEDITOR Plugin
////////////////////////////////////////////////////////////////////////////////
-->

<tal:block tal:content="structure python:'<script>'">script</tal:block>

$(function(){
	if($("form#form0 input[name=session_id]").length==0) {
		$("form#form0").append('<input type="hidden" name="session_id" tal:attributes="value session_id"/>');
	}
	$(".zmiRichtextEditorHeadline").hide();
});

<tal:block tal:content="structure python:'</script>'">/script</tal:block>

</tal:block>]]>
                  </item>
                  <item key="id"><![CDATA[interface0]]></item>
                  <item key="name"><![CDATA[interface0]]></item>
                  <item key="type"><![CDATA[interface]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[text]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[Text]]></item>
                  <item key="type"><![CDATA[richtext]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSRichtext.onChangeObjEvt"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext=None
##title=py: Event: onChange-Object
##
# --// BO onChangeObjEvt //--

temp_folder = context.temp_folder
request = context.REQUEST

# Find images/files.
text = zmscontext.attr('text')
l = []
lt = []
for sp in ['src="', 'href="' ]:
  for s in text.split(sp):
    ref = s[:s.find('"')]
    if ref.find('/'+zmscontext.id+'/') >= 0:
      idmedia = ref.split('/')[-1]
      l.append(idmedia)
    elif ref.find('/'+temp_folder.id+'/') >= 0:
      lt.append(ref)

# Remove unused images/files.
ob_ids = zmscontext.objectIds(['File','Image'])
for ref in l:
  id = ref.split('/')[-1]
  if id in ob_ids:
    ob_ids.remove(id)
if len(ob_ids) > 0:
  zmscontext.manage_delObjects(ids=ob_ids)

# Add new images/files from temp_folder.
for ref in lt:
  id = ref.split('/')[-1]
  ob = getattr(temp_folder,id,None)
  if ob is not None:
    new_id = ob.title_or_id()
    new_title = ''
    new_data = ob.data
    if ob.meta_type == 'Image':
      zmscontext.manage_addImage( id=new_id, title=new_title, file=new_data)
    else:
      zmscontext.manage_addFile( id=new_id, title=new_title, file=new_data)
    temp_folder.manage_delObjects(ids=[id])
    text = text.replace('"'+ref+'"','"./'+zmscontext.id+'/'+new_id+'"')
zmscontext.attr('text',text)

# --// EO onChangeObjEvt //--
]]>
                  </item>
                  <item key="id"><![CDATA[onChangeObjEvt]]></item>
                  <item key="name"><![CDATA[Event: onChange-Object]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<!-- ZMSRichtext.standard_html -->

<tal:block tal:define="global 
		zmscontext options/zmscontext;
		text          python:unicode(zmscontext.getText(request),'utf-8');
		format        python:unicode(zmscontext.attr('format'),'utf-8');
		renderedText  python:zmscontext.renderText(format,'text',text,request,zmscontext.id)"
		tal:content="structure renderedText">
	The text
</tal:block>

<!-- /ZMSRichtext.standard_html -->]]>
                  </item>
                  <item key="id"><![CDATA[standard_html]]></item>
                  <item key="name"><![CDATA[Template: ZMSRichtext]]></item>
                  <item key="type"><![CDATA[zpt]]></item>
                </dictionary>
              </item>
            </list>
          </item>
          <item key="access" type="dictionary">
            <dictionary>
              <item key="delete" type="list">
                <list>
                  <item><![CDATA[ZMSAdministrator]]></item>
                  <item><![CDATA[ZMSAuthor]]></item>
                  <item><![CDATA[ZMSEditor]]></item>
                </list>
              </item>
              <item key="delete_custom"></item>
              <item key="insert" type="list">
                <list>
                  <item><![CDATA[ZMSAdministrator]]></item>
                  <item><![CDATA[ZMSAuthor]]></item>
                  <item><![CDATA[ZMSEditor]]></item>
                </list>
              </item>
              <item key="insert_custom"><![CDATA[{$}]]></item>
            </dictionary>
          </item>
          <item key="enabled" type="int">0</item>
          <item key="id"><![CDATA[ZMSRichtext]]></item>
          <item key="name"><![CDATA[ZMSRichtext]]></item>
          <item key="package"><![CDATA[com.zms.foundation]]></item>
          <item key="revision"><![CDATA[3.0.0]]></item>
          <item key="type"><![CDATA[ZMSObject]]></item>
        </dictionary>
      </item>
    </dictionary>
  </item>
  <item type="dictionary">
    <dictionary>
      <item key="key"><![CDATA[ZMSSqlDb]]></item>
      <item key="value" type="dictionary">
        <dictionary>
          <item key="__obj_attrs__" type="list">
            <list>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[icon-building]]></item>
                  <item key="id"><![CDATA[icon_clazz]]></item>
                  <item key="name"><![CDATA[Icon (Class)]]></item>
                  <item key="type"><![CDATA[constant]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<!-- ZMSSqlDb.renderShort -->

<tal:block tal:define="global 
		zmscontext options/zmscontext">
	<h4>
		<i class="icon-table"></i>
		<tal:block tal:content="python:zmscontext.connection_id">the connection-id</tal:block>
	</h4>
	<ul>
		<li tal:repeat="table python:filter(lambda x:x['type']=='table',zmscontext.getEntities())">
			<a tal:attributes="href python:'%s/manage_main?qentity=%s'%(zmscontext.id,table['id'])" tal:content="table/id">the table</a>
		</li>
	</ul>
	<br/>
</tal:block>

<!-- /ZMSSqlDb.renderShort -->]]>
                  </item>
                  <item key="id"><![CDATA[renderShort]]></item>
                  <item key="name"><![CDATA[ZMI: Render short]]></item>
                  <item key="type"><![CDATA[zpt]]></item>
                </dictionary>
              </item>
            </list>
          </item>
          <item key="access" type="dictionary">
            <dictionary>
              <item key="delete" type="list">
                <list>
                  <item><![CDATA[ZMSAdministrator]]></item>
                  <item><![CDATA[ZMSAuthor]]></item>
                  <item><![CDATA[ZMSEditor]]></item>
                </list>
              </item>
              <item key="delete_custom"></item>
              <item key="insert" type="list">
                <list>
                  <item><![CDATA[ZMSAdministrator]]></item>
                  <item><![CDATA[ZMSAuthor]]></item>
                  <item><![CDATA[ZMSEditor]]></item>
                </list>
              </item>
              <item key="insert_custom"><![CDATA[{$}]]></item>
            </dictionary>
          </item>
          <item key="enabled" type="int">0</item>
          <item key="id"><![CDATA[ZMSSqlDb]]></item>
          <item key="name"><![CDATA[ZMSSqlDb]]></item>
          <item key="package"><![CDATA[com.zms.foundation]]></item>
          <item key="revision"><![CDATA[3.0.0]]></item>
          <item key="type"><![CDATA[ZMSObject]]></item>
        </dictionary>
      </item>
    </dictionary>
  </item>
  <item type="dictionary">
    <dictionary>
      <item key="key"><![CDATA[ZMSSysFolder]]></item>
      <item key="value" type="dictionary">
        <dictionary>
          <item key="__obj_attrs__" type="list">
            <list>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[icon-folder-close]]></item>
                  <item key="id"><![CDATA[icon_clazz]]></item>
                  <item key="name"><![CDATA[Icon (Class)]]></item>
                  <item key="type"><![CDATA[constant]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[titlealt]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Title.Alt]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[title]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Title]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[0]]></item>
                  <item key="id"><![CDATA[attr_cacheable]]></item>
                  <item key="name"><![CDATA[Cacheable]]></item>
                  <item key="type"><![CDATA[constant]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[TAB_METADATA]]></item>
                  <item key="name"><![CDATA[TAB_METADATA]]></item>
                  <item key="type"><![CDATA[delimiter]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_dc_description]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Description]]></item>
                  <item key="type"><![CDATA[text]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<tal:block tal:condition="not:python:request.get('ZMS_INSERT')">
<tal:block tal:define="global
		standard modules/Products.zms/standard;
		zmscontext options/zmscontext;
		SecurityManager modules/AccessControl/getSecurityManager;
		skey python:request.get('skey', 'id');
		rkey python:request.get('rkey', '')">

<!--
################################################################################
##### Action-List
################################################################################
-->
<div class="pull-right" style="margin:1.5em 0 0.5em">
	<select class="form-control" style="background-color: aliceblue;"
			name=":action"	tal:attributes="onchange python:'location.href=\'%s/\'+this.options[this.selectedIndex].value'%request['URL1']">
		<option value="manage_workspace" tal:content="python:'----- %s -----'%zmscontext.getZMILangStr('ACTION_INSERT')%zmscontext.display_type(request)">----- Insert -----</option>
		<tal:block tal:repeat="meta_type python:filter(lambda x:x['name'].find('ZMS')<>0,standard.sort_list(zmscontext.filtered_meta_types(),'name'))">
			<option tal:attributes="value python:meta_type['action']" tal:content="python:meta_type['name']">the name</option>
		</tal:block>
	</select>
</div>

<!--
################################################################################
##### Object-List
################################################################################
-->

<tal:block tal:define="global items python:filter(lambda x:x[1].meta_type.find('ZMS')<>0,zmscontext.objectItems())">
<tal:block tal:condition="python:len(items)>0">
<table class="table table-striped">
<thead>
<tr>
	<th>&nbsp;</th>
	<tal:block define="global
			columns python:['meta_type','id','get_size','bobobase_modification_time'];
			labels python:{'meta_type':'type','id':'name','get_size':'size','bobobase_modification_time':'last_modified'}">
		<tal:block tal:repeat="column columns">
			<th tal:define="global label python:zmscontext.getZMILangStr('ATTR_%s'%labels[column].upper())">
				<i tal:condition="python:skey==column or rkey==column" tal:attributes="class python:['icon-caret-down','icon-caret-up'][int(rkey==column)]"></i>
				<a tal:attributes="href python:zmscontext.url_append_params(request['URL'],{['skey','rkey'][int(skey==column)]:column}); title python:'Sort objects by %s'%label"><tal:block tal:content="label">the label</tal:block></a>
			</th>
		</tal:block>
	</tal:block>
</tr>
</thead>
<tbody>
<tr tal:repeat="item items">
	<td><input type="checkbox" name="ids:list" tal:attributes="value python:item[0]"/></td>
	<td>
		<tal:block tal:condition="python:item[1].icon">
			<img tal:attributes="src python:item[1].icon; title python:item[1].meta_type"/>
		</tal:block>
	</td>
	<td>
		<a tal:attributes="href python:'%s/manage_workspace'%item[1].absolute_url()">
			<tal:block tal:content="python:item[0]">the id</tal:block>
			<tal:block tal:condition="python:item[1].title">(<tal:block tal:content="python:item[1].title">the title</tal:block>)</tal:block>
		</a>
	</td>
	<td><tal:block tal:content="python:zmscontext.getDataSizeStr(item[1].get_size())">the size</tal:block></td>
	<td><tal:block tal:content="python:zmscontext.getLangFmtDate(item[1].bobobase_modification_time())">the timestamp</tal:block></td>
</tr>
</tbody>
</table>
<tal:block tal:condition="not:python:request.get('dontAllowCopyAndPaste')">
	<input class="btn" type="submit" name="manage_renameForm:method" tal:attributes="value python:zmscontext.getZMILangStr('BTN_RENAME')" tal:condition="items"/>
	<input class="btn" type="submit" name="manage_cutForm:method" tal:attributes="value python:zmscontext.getZMILangStr('BTN_CUT')" tal:condition="items"/>
	<input class="btn" type="submit" name="manage_copyForm:method" tal:attributes="value python:zmscontext.getZMILangStr('BTN_COPY')" tal:condition="items"/>
	<input class="btn" type="submit" name="manage_pasteForm:method" tal:attributes="value python:zmscontext.getZMILangStr('BTN_PASTE')" tal:condition="python:request.get('cb_dataValid')"/>
	<input class="btn" type="submit" name="manage_delObjects:method" tal:attributes="value python:zmscontext.getZMILangStr('BTN_DELETE')" tal:condition="python:SecurityManager.checkPermission('Delete objects',zmscontext)"/>
	<input class="btn" type="submit" name="manage_importExportForm:method" value="Import/Export" tal:condition="python:SecurityManager.checkPermission('Import/Export objects',zmscontext)"/>
</tal:block>
</tal:block>
</tal:block>

</tal:block>
</tal:block>]]>
                  </item>
                  <item key="id"><![CDATA[interface0]]></item>
                  <item key="name"><![CDATA[interface0]]></item>
                  <item key="type"><![CDATA[interface]]></item>
                </dictionary>
              </item>
            </list>
          </item>
          <item key="access" type="dictionary">
            <dictionary>
              <item key="delete" type="list">
                <list>
                  <item><![CDATA[ZMSAdministrator]]></item>
                  <item><![CDATA[ZMSAuthor]]></item>
                  <item><![CDATA[ZMSEditor]]></item>
                </list>
              </item>
              <item key="delete_custom"></item>
              <item key="insert" type="list">
                <list>
                  <item><![CDATA[ZMSAdministrator]]></item>
                  <item><![CDATA[ZMSAuthor]]></item>
                  <item><![CDATA[ZMSEditor]]></item>
                </list>
              </item>
              <item key="insert_custom"><![CDATA[{$}]]></item>
            </dictionary>
          </item>
          <item key="enabled" type="int">0</item>
          <item key="id"><![CDATA[ZMSSysFolder]]></item>
          <item key="name"><![CDATA[ZMSSysFolder]]></item>
          <item key="package"><![CDATA[com.zms.foundation]]></item>
          <item key="revision"><![CDATA[3.0.1]]></item>
          <item key="type"><![CDATA[ZMSDocument]]></item>
        </dictionary>
      </item>
    </dictionary>
  </item>
  <item type="dictionary">
    <dictionary>
      <item key="key"><![CDATA[ZMSTable]]></item>
      <item key="value" type="dictionary">
        <dictionary>
          <item key="__obj_attrs__" type="list">
            <list>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[icon-table]]></item>
                  <item key="id"><![CDATA[icon_clazz]]></item>
                  <item key="name"><![CDATA[Icon (Class)]]></item>
                  <item key="type"><![CDATA[constant]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[caption]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[Caption]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_dc_description]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Description]]></item>
                  <item key="type"><![CDATA[text]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<tal:block tal:define="textFormatDefault python:here.getConfProperty('ZMSTable.getTextFormatDefault',here.getTextFormatDefault())">

<!--
################################################################################
##### Table(Type,Cols,Rows): INSERT
################################################################################
-->
<tal:block tal:condition="python:request.get('ZMS_INSERT')">
<input type="hidden" name="redirect_self:int" value="1"/>

<span class="ui-helper-hidden" id="fmName" tal:content="request/fmName"></span>
<span class="ui-helper-hidden" id="textFormatDefault" tal:content="textFormatDefault"></span>
<style>
	.modal {
		z-index:10000;
	}
	.modal table.ZMSTable {
		margin:0;
	}
	.modal table.ZMSTable tr th,
	.modal table.ZMSTable tr td {
		padding:0 .5em;
	}
	.modal div.checkbox {
		float:left;
	}
</style>
<script>

var fmName;
var textFormatDefault;

$(function() {
		fmName = $('#fmName').text();
		textFormatDefault = $("#textFormatDefault").text();
		$("form[name="+fmName+"]").submit( onZMSTableFormSubmit);
	});

function onZMSTableFormSubmit() {
	var xml = '';
	var type = parseInt($("input[name=\x22type:int\x22]:checked").val());
	xml += '<'+'list>\n';
	for ( var y = 0; y < parseInt($('#rows').val()); y++) {
		xml += '<'+'item type="list"><list>\n';
		if ( y==0 && type == 2) {
			xml += '<'+'item type="dictionary"><'+'dictionary>\n';
			xml += '<'+'item key="colspan" type="int">'+parseInt($('#cols').val())+'<'+'/item>\n';
			xml += '<'+'item key="content"><'+'/item>\n';
			xml += '<'+'item key="format">'+textFormatDefault+'<'+'/item>\n';
			xml += '<'+'item key="tag">th<'+'/item>\n';
			xml += '<'+'/dictionary><'+'/item>\n';
		}
		else {
			for ( var x = 0; x < parseInt($('#cols').val()); x++) {
				xml += '<'+'item type="dictionary"><'+'dictionary>\n';
				if ( y==0 && x == 0 && type == 4) {
					xml += '<'+'item key="colspan" type="int">1<'+'/item>\n';
				}
				else {
					var tag = "td";
					if ( (type == 1 && y == 0) ||
						(type == 3 && x == 0) ||
						(type == 4 && (x == 0 || y == 0))) {
						tag = "th";
					}
					xml += '<'+'item key="colspan" type="int">1<'+'/item>\n';
					xml += '<'+'item key="content"><'+'/item>\n';
					xml += '<'+'item key="format">'+textFormatDefault+'<'+'/item>\n';
					xml += '<'+'item key="tag">'+tag+'<'+'/item>\n';
				}
				xml += '<'+'/dictionary><'+'/item>\n';
			}
		}
		xml += '<'+'/list><'+'/item>\n';
	}
	xml += '<'+'/list>\n';
	$("#table_table").val( xml);
	return onFormSubmit(fmName);
}

</script>

<div class="form-group">
	<label class="col-sm-2 control-label mandatory"><span tal:content="structure python:here.getZMILangStr('ATTR_COLS')">Cols</span></label>
	<div class="col-sm-2">
		<tal:block tal:content="structure python:here.getTextInput(fmName=request['fmName'],elName='cols',value='3',size=2)"></tal:block>
	</div>
	<label class="col-sm-1 control-label mandatory"><span tal:content="structure python:here.getZMILangStr('ATTR_ROWS')">Rows</span></label>
	<div class="col-sm-2">
		<tal:block tal:content="structure python:here.getTextInput(fmName=request['fmName'],elName='rows',value='3',size=2)"></tal:block>
	</div>
</div>

<div class="form-group">
	<label class="col-sm-2 control-label mandatory" tal:content="python:here.getZMILangStr('ATTR_TYPE')">the type-label</label>
	<div class="form-group" style="padding: 0 15px">
		<div class="col-xs-2 checkbox" title="Type 1" style="min-width: 72px !important;">
			<input type="radio" name="type:int" value="1" checked="checked" />
			<table class="ZMSTable">
				<tr><th>&nbsp;</th><th>&nbsp;</th><th>&nbsp;</th></tr>
				<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
				<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
			</table>
		</div>
		<div class="col-xs-2 checkbox" title="Type 2" style="min-width: 72px !important;">
			<input type="radio" name="type:int" value="2" />
			<table class="ZMSTable">
				<tr><th colspan="3">&nbsp;</th></tr>
				<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
				<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
			</table>
		</div>
		<div class="col-xs-2 checkbox" title="Type 3" style="min-width: 72px !important;">
			<input type="radio" name="type:int" value="3" />
			<table class="ZMSTable">
				<tr><th>&nbsp;</th><td>&nbsp;</td><td>&nbsp;</td></tr>
				<tr><th>&nbsp;</th><td>&nbsp;</td><td>&nbsp;</td></tr>
				<tr><th>&nbsp;</th><td>&nbsp;</td><td>&nbsp;</td></tr>
			</table>
		</div>
		<div class="col-xs-2 checkbox" title="Type 4" style="min-width: 72px !important;">
			<input type="radio" name="type:int" value="4" />
			<table class="ZMSTable">
				<tr><td>&nbsp;</td><th>&nbsp;</th><th>&nbsp;</th></tr>
				<tr><th>&nbsp;</th><td>&nbsp;</td><td>&nbsp;</td></tr>
				<tr><th>&nbsp;</th><td>&nbsp;</td><td>&nbsp;</td></tr>
			</table>
		</div>
		<div class="col-xs-2 checkbox" title="Type 5: Custom" style="min-width: 72px !important;">
			<input type="radio" name="type:int" value="5" />
			<table class="ZMSTable">
				<tr><th>&nbsp;</th><td>&nbsp;</td><th>&nbsp;</th></tr>
				<tr><td>&nbsp;</td><th>&nbsp;</th><td>&nbsp;</td></tr>
				<tr><th>&nbsp;</th><td>&nbsp;</td><th>&nbsp;</th></tr>
			</table>
		</div>
	</div>
</div>

<div class="form-group col-sm-12 col-sm-push-2" style="font-size: small;color: #999;" 
	tal:content="python:here.getZMILangStr('MSG_ZMSTABLE_TYPE')">Note: Type can not be changed later
</div>

</tal:block>

<!--
################################################################################
##### Table(Type,Cols,Rows): EDIT
################################################################################
-->
<tal:block tal:condition="not:python:request.get('ZMS_INSERT')">
<tal:block tal:define="global
		zmscontext options/zmscontext;
		table_table python:zmscontext.attr('table');
		table_type python:zmscontext.attr('type');
		table_colgroup_cols python:zmscontext.attr('cols');
		table_cols python:len(table_table[-1]);
		table_rows python:len(table_table);
		table_widths python:zmscontext.attr('widths');
		">

<!--
--------------------------------------------------------------------------------
--- Table-Cell Editor
--------------------------------------------------------------------------------
-->
<tal:block tal:define="celltypes python:[['td','td'],['th','th']];custom python:'<div class=\042pull-left celltypes\042>%s</div>'%(here.zmi_input_select(name='tag',value='',lang_str=here.getZMILangStr('ATTR_FORMAT'),options=celltypes))">
	<div class="ui-helper-hidden ui-helper-overlay modal-backdrop in">&nbsp;</div>
	<div class="ui-helper-hidden">
		<div id="div_table_cell_editor">
			<tal:block tal:content="structure python:here.f_selectRichtext(ob=here,fmName=request['fmName'],elName='content_editor',cols=25,rows=10,value='',key='cell',enabled=True,lang=request['lang'],lang_str=here.getZMILangStr('ACTION_EDIT_CELL'),custom_str=custom,REQUEST=request,wrap='virtual',format='')"></tal:block>
			<div class="control-group">
				<div class="controls save">
					<button class="btn btn-primary" type="submit" tal:attributes="value python:here.getZMILangStr('BTN_CHANGE')" onclick="return table_cell_change();">
						<tal:block tal:content="python:here.getZMILangStr('BTN_CHANGE')">Change</tal:block>
					</button>
					<button class="btn btn-default" type="submit" tal:attributes="value python:here.getZMILangStr('BTN_CANCEL')" onclick="return table_cell_cancel();">
						<tal:block tal:content="python:here.getZMILangStr('BTN_CANCEL')">Cancel</tal:block>
					</button>
				</div>
			</div>
		</div>
	</div>
</tal:block>

<!--
--------------------------------------------------------------------------------
--- Table-Cell Grid
--------------------------------------------------------------------------------
-->

<span class="ui-helper-hidden" id="fmName" tal:content="request/fmName"></span>
<span class="ui-helper-hidden" id="elName" tal:content="request/elName"></span>
<span class="ui-helper-hidden" id="textFormatDefault" tal:content="textFormatDefault"></span>
<tal:block tal:condition="python:request.get('richedit_fmt',None)"><span class="ui-helper-hidden" id="richedit_fmt" tal:content="python:request.get('richedit_fmt').getId()"></span></tal:block>
<span class="ui-helper-hidden" id="table_type" tal:content="table_type"></span>
<span class="ui-helper-hidden" id="table_cell_uid" tal:content="python:table_cols*table_rows"></span>
<style>
#table_cell_editor .btn {
	padding: 0 .3em;
}
div.zmi-interface {
	padding: 0 1em 1em;
	border: 1px solid #ccc;
	border-radius: 4px;
	background: #E7ECF0;
	box-shadow: inset 0 1px 10px rgba(0,0,0,0.075);
	margin-bottom:2em;
}
.zmi.ZMSTable.properties .modal-backdrop.in {
	filter: alpha(opacity=30);
	opacity: .3;
}
.div_table_cell_editor_parent {
	position:absolute;
	background:#FEFEFE;
	z-index:9999;
	border-radius: 4px;
	box-shadow: 0 4px 16px #333;
}
#div_table_cell_editor {
	width:65em;
	margin:1em;
}
#table_cell_editor #colgrouping td {
	min-width:6em
}
.celltypes select {
	width:10em;
}
/* Compensate Preview Styles */
#table_cell_editor table.ZMSTable {
	margin:0
}
#table_cell_editor table.ZMSTable td,
#table_cell_editor table.ZMSTable th {
	border:0 !important;
	margin:0;
	padding:0;
}
table#table_cell_editor > thead > tr > th,
table#table_cell_editor > tbody > tr > td {
	padding:2px;
}
img.vbutton {
	border:1px solid #CCC;
	height:16px!important;
	width:8px!important;
	border-radius:3px;
}
img.hbutton {
	border:1px solid #CCC;
	height:8px!important;
	width:16px!important;
	border-radius:3px;
}
td .btn-group {
	width:80px;
}
.ZMSTable-cell {
	border:1px solid #CCC;
	background: #f8f8f8;
}
.ZMSTable-cell.top {
	border-top:2px solid #666;
}
.ZMSTable-cell.right {
	border-right:2px solid #666;
}
.ZMSTable-cell.bottom {
	border-bottom:2px solid #666;
}
.ZMSTable-cell.left {
	border-left:2px solid #666;
}
.table_cell_editable.changed {
	background-color:#FFF;
}
.table_cell_editable.active {
	background-color:#FFC;
}
.table_cell_editable.new {
	background-color:#DFD;
}
.table_cell_editable.moved {
	background-color:#FFF;
}
/* shift url select modal win to top */
.modal {
	z-index:10000;
}
</style>

<script>

var fmName;
var elName;
var textFormatDefault;
var richedit_fmt;
var table_type;
var table_cell_uid;
var table_cell_id;
var table_cell_offs;

$(function() {
		fmName = $('#fmName').text();
		elName = $('#elName').text();
		textFormatDefault = $("#textFormatDefault").text();
		richedit_fmt = $('#richedit_fmt').text();
		table_type = parseInt($('#table_type').text());
		table_cell_uid = $('#table_cell_uid').text();
		table_cell_id = '';
		table_cell_offs = 2;
		$('form[name='+fmName+']').submit( onZMSTableFormSubmit);
		table_cell_init();
	});

function onZMSTableFormSubmit() {
	var xml = '';
	xml += '<'+'list>\n';
	var el_tbody = $($("#table_cell_editor").children()[0]);
	var el_trs = el_tbody.children().filter(":gt(1)").filter(":not(:last)");
	for ( var i=0; i < el_trs.length; i++) {
		xml += '<'+'item type="list"><'+'list>\n';
		var el_tds = $(el_trs[i]).children().filter(":gt(0)").filter(":not(:last)");
		for ( var j=0; j < el_tds.length; j++) {
			xml += '<'+'item type="dictionary"><'+'dictionary>\n';
			var colspan = $(el_tds[j]).prop("colspan");
			if (typeof colspan=="undefined") {
				colspan = 1;
			}
			xml += '<'+'item key="colspan" type="int">'+colspan+'<'+'/item>\n';
			var el_inputs = $("textarea,input",el_tds[j]);
			for ( var k=0; k < el_inputs.length; k++) {
				var key = el_inputs[k].id.substr(0,el_inputs[k].id.indexOf("_"));
				xml += '<'+'item key="'+key+'"><'+'![CDATA'+'['+$(el_inputs[k]).val()+']'+']><'+'/item>\n';
			}
			xml += '<'+'/dictionary><'+'/item>\n';
		}
		xml += '<'+'/list><'+'/item>\n';
	}
	xml += '<'+'/list>\n';
	$("#table_table").val( xml);
	xml = '';
	xml += '<'+'list>\n';
	var el_trs = el_tbody.children().filter(":eq(0)");
	for ( var i=0; i < el_trs.length; i++) {
		var el_inputs = $("input:text",el_trs[i]);
		for ( var j = 0; j < el_inputs.length; j++) {
			xml += '<'+'item type="string">'+$(el_inputs[j]).val()+'<'+'/item>\n';
		}
	}
	xml += '<'+'/list>\n';
	$("#table_colgroup_cols").val( xml);
	return onFormSubmit(fmName);
}
function table_cell_edit(el_td) {
	var el = $('textarea',el_td);
	var el_name = el.attr('name');
	table_cell_id = el_name.substr(el_name.indexOf('_')+1);
	// Set cell background.
	el_td.addClass("active");
	// Apply values.
	$('#zmiRichtextEditor'+elName).hide();
	$('#zmiStandardEditor'+elName).show();
	$('#content_editor').val($('#content_'+ table_cell_id).val());
	$('select[name="tag"]').val($('#tag_'+ table_cell_id).val());
	$('#format').val($('#format_'+ table_cell_id).val());
	if (typeof richedit_fmt != 'undefined') {
		zmiRichtextSyncDataToView(elName);
		if ( $('#format').val()==richedit_fmt) {
			$('#zmiRichtextEditor'+'content_editor').show();
			$('#zmiStandardEditor'+'content_editor').hide();
			zmiStandardOnSubmitEventHandler();
		}
	}
	// Open cell editor.
	var offset = $(el_td).offset();
	$('.ui-helper-overlay').removeClass('ui-helper-hidden');
	$('#div_table_cell_editor').parent().addClass('div_table_cell_editor_parent').css({left:offset.left,top:offset.top}).removeClass('ui-helper-hidden');
	$('#zmiRichtextEditor'+'content_editor').height(300);
	zmiRichtextResize('content_editor');
}

function table_cell_change() {
	if (typeof richedit_fmt != 'undefined') {
		if ( $('#format').val()==richedit_fmt) {
			zmiRichtextOnSubmitEventHandler();
			$('#input_'+ table_cell_id).hide();
			$('#preview_'+ table_cell_id).show();
		}
		else {
			$('#input_'+ table_cell_id).show();
			$('#preview_'+ table_cell_id).hide();
		}
	}
	$('#format_'+ table_cell_id).val($('#format').val());
	$('#tag_'+ table_cell_id).val($('select[name="tag"]').val());
	$('#content_'+ table_cell_id).val($('#content_editor').val());
	$('#preview_'+ table_cell_id).html($('#content_editor').val());
	return table_cell_cancel();
}

function table_cell_cancel(event) {
	// Reset cell background.
	var el_td = $("td.active");
	el_td.removeClass("active");
	// Close cell editor.
	if (!event) {
		/*
		$('#div_table_cell_editor').dialog('close');
		*/
		$('.ui-helper-overlay').addClass('ui-helper-hidden');
		$('#div_table_cell_editor').parent().addClass('ui-helper-hidden');
	}
	return false;
}


function table_cell_init() {
	$("form[name="+fmName+"] input[type=hidden]+textarea").change( function () { $(this).parents(".table_cell_editable").addClass('changed').removeClass('changed',1000);});
	$("form[name="+fmName+"] .table_cell_editable").dblclick( function () { table_cell_edit($(this));});
	$('div[id^=preview_]')
		.attr('contenteditable','').keyup(onKeyUpZMSTableDivContenteditable).blur(onKeyUpZMSTableDivContenteditable);
}

function actionBtnClick(el, fct) {
	var x = 0;
	var $td = $(el).closest("td");
	while ( $td.prev().length > 0) {
		x++;
		$td = $td.prev();
	}
	var y = 0;
	var $tr = $($td.parent("tr"));
	while ( $tr.prev().length > 0) {
		y++;
		$tr = $tr.prev();
	}
	var $tbody = $(el).closest("tbody");
	//////////////////////////////////////////////////////////////////////////////
	/// DELETE
	//////////////////////////////////////////////////////////////////////////////
	if (fct.indexOf('delete') == 0) {
		if (confirm(getZMILangStr('MSG_CONFIRM_DELOBJ'))) {
			if (fct.indexOf('delete_col') == 0) {
				var $trs = $tbody.children();
				for ( var i = 0; i < $trs.length; i++) {
					if ( i == table_cell_offs && table_type == 2) {
						var $td = $($trs[i]).children().filter(":eq("+table_cell_offs+")");
						$td.prop("colspan",parseInt($td.prop("colspan"))-1);
					}
					else {
						var $td = $($trs[i]).children().filter(":eq("+x+")");
						$td.remove();
					}
				}
				$('#cols').val( parseInt($('#cols').val())-1);
			}
			else if (fct.indexOf('delete_row') == 0) {
				var $tr = $tbody.children().filter(":eq("+y+")");
				$tr.remove();
				$('#rows').val( parseInt($('#rows').val())-1);
			}
		}
	}
	//////////////////////////////////////////////////////////////////////////////
	/// INSERT
	//////////////////////////////////////////////////////////////////////////////
	else if (fct.indexOf('insert_col') == 0) {
		var $trs = $tbody.children();
		for ( var i = 0; i < $trs.length; i++) {
			if ( i == table_cell_offs && table_type == 2) {
				var $td = $($trs[i]).children().filter(":eq("+table_cell_offs+")");
				$td.attr("colspan",parseInt($td.attr("colspan"))+1);
			}
			else {
				var $tds = $($trs[i]).children();
				var $td = $tds.filter(":eq("+x+")");
				var new_td = insertCell($tds[$tds.length-2]);
				new_td.insertBefore( $td);
			}
		}
		$('#cols').val( parseInt($('#cols').val())+1);
		table_cell_init();
	}
	else if (fct.indexOf('insert_row') == 0) {
		var $trs = $tbody.children();
		var $tr = $trs.filter(":eq("+y+")");
		var new_tr = insertCell($trs[$trs.length-2]);
		new_tr.insertBefore( $tr);
		$('#rows').val( parseInt($('#rows').val())-1);
		table_cell_init();
	}
	//////////////////////////////////////////////////////////////////////////////
	/// MOVE
	//////////////////////////////////////////////////////////////////////////////
	else if (fct.indexOf('move_col') == 0) {
		var source_x = x;
		var target_x = x;
		if (fct == 'move_col_left') {
			target_x = target_x - 1;
		}
		else {
			target_x = target_x + 1;
		}
		var $trs = $tbody.children().filter(":gt(1)").filter(":not(:last)");
		for ( var i = 0; i < $trs.length; i++) {
			var source_td = $($trs[i]).children().filter(":eq("+source_x+")");
			var target_td = $($trs[i]).children().filter(":eq("+target_x+")");
			moveCell(source_td, target_td);
		}
	}
	else if (fct.indexOf('move_row') == 0) {
		var source_y = y;
		var target_y = y;
		if (fct == 'move_row_up') {
			target_y = target_y - 1;
		}
		else {
			target_y = target_y + 1;
		}
		var source_tr = $tbody.children().filter(":eq("+source_y+")");
		var target_tr = $tbody.children().filter(":eq("+target_y+")");
		moveCell(source_tr, target_tr);
	}
	else {
		var par = Math.max(x,y)-table_cell_offs;
		var fm = document.forms[fmName];
		fm.elements['function'].value = fct;
		fm.elements['param'].value = par;
		fm.submit();
	}
}

function insertCell(source) {
	var $clone = $(source).clone();
	$("table.ZMSTable th, table.ZMSTable td",$clone).each(function() {
			// Remove table with inline-links (if exists).
			$("table",this).remove();
			$("textarea,input",this).each(function() {
					var key = this.id.substr(0,this.id.indexOf("_"));
					$(this).attr( "id", key+"_" + table_cell_uid);
					$(this).attr( "name", key+"_" + table_cell_uid);
					if ( key.indexOf("format") == 0) {
						$(this).val( textFormatDefault);
					}
					else if ( key.indexOf("content") == 0) {
						$(this).val( "").css( 'border', '2px solid #00FF00');
					}
				});
			$('div[id^="preview"]',this).each(function() {
					$(this).attr("id","preview_"+table_cell_uid)
						.html( "&nbsp;")
						.attr('contenteditable','')
						.keyup(onKeyUpZMSTableDivContenteditable).blur(onKeyUpZMSTableDivContenteditable);
				});
			$(this).addClass('new').removeClass('new',1000);
			table_cell_uid++;
		});
	return $clone;
}

function moveCell(source, target) {
	var source_inp = $("textarea,input",source);
	var target_inp = $("textarea,input",target);
	for ( var j = 0; j < source_inp.length; j++) {
		var v = $(source_inp[j]).val();
		$(source_inp[j]).val( $(target_inp[j]).val());
		$(target_inp[j]).val( v);
	}
	var source_preview = $("div[id^=preview]",source);
	var target_preview = $("div[id^=preview]",target);
	for ( var j = 0; j < source_preview.length; j++) {
		var v = $(source_preview[j]).html();
		$(source_preview[j]).html( $(target_preview[j]).html());
		$(target_preview[j]).html( v);
	}
	$("td.table_cell_editable",target).addClass("moved").removeClass("moved",1000);
}

function onKeyUpZMSTableDivContenteditable() {
	var $textarea = $("textarea",$(this).prev());
	$textarea.val($(this).html());
}

</script>

<table id="table_cell_editor" cellspacing="0" cellpadding="0" border="0">

<tr id="colgrouping">
	<td>
		<tal:block tal:content="structure python:zmscontext.getObjInput('colgroup',request)"></tal:block>
		<small>colgroup&nbsp;</small>
	</td>
	<tal:block tal:repeat="col_index python:range(table_cols)">
		<td align="center" tal:attributes="style python:'width:%s'%([ 'initial', '%s%%'%((table_colgroup_cols+[''])[min(col_index,len(table_colgroup_cols))]) ][zmscontext.attr('colgroup')] )">
			<tal:block tal:condition="python:zmscontext.attr('colgroup')">
				<input class="form-control input-sm" type="text" size="3"
					style="display:inline;width:4em;"
					onchange="$(this).parent().css('width',$(this).val()+'%')"
					tal:attributes="name python:'col%i'%col_index;
						value python:(table_colgroup_cols+[''])[min(col_index,len(table_colgroup_cols))];
						title python: 'Calculated Average-Width = %s%%'%(table_widths[col_index])" />
				&#37;
			</tal:block>
				&nbsp;
		</td>
	</tal:block>
	<td>&nbsp;</td>
</tr>

<tr>
	<td>
		<span id="tr_sortable">
			<tal:block tal:content="structure python:zmscontext.getObjInput('sortable',request)"></tal:block>
			<small>sortable&nbsp;</small>
		</span>
	</td>
	<td align="center" tal:repeat="col_index python:range(table_cols)">
		<div class="btn-group">
			<span class="btn btn-default" onclick="actionBtnClick(this,'move_col_left')"><tal:block tal:content="structure python:here.zmi_icon(name='icon-caret-left',extra='title=\042%s\042'%here.getZMILangStr('ACTION_MOVELEFT'))">icon-caret-left</tal:block></span>
			<span class="btn btn-default" onclick="actionBtnClick(this,'move_col_right')"><tal:block tal:content="structure python:here.zmi_icon(name='icon-caret-right',extra='title=\042%s\042'%here.getZMILangStr('ACTION_MOVERIGHT'))">icon-caret-right</tal:block></span>
			<span class="btn btn-default" onclick="actionBtnClick(this,'delete_col')" tal:condition="python:col_index>0 or table_type==1"><tal:block tal:content="structure python:here.zmi_icon(name='icon-trash',extra='title=\042%s\042'%here.getZMILangStr('ACTION_DELETE_COL'))">icon-trash</tal:block></span>
			<span class="btn btn-default" onclick="actionBtnClick(this,'insert_col')" tal:condition="python:col_index>0 or table_type==1"><tal:block tal:content="structure python:here.zmi_icon(name='icon-expand-alt',extra='title=\042%s\042'%here.getZMILangStr('ACTION_INSERT_COL'))">icon-expand-alt</tal:block></span>
		</div><!-- .btn-group -->
	</td>
	<td>
		<span class="btn btn-default" onclick="actionBtnClick(this,'insert_col')"><tal:block tal:content="structure python:here.zmi_icon(name='icon-expand-alt',extra='title=\042%s\042'%here.getZMILangStr('ACTION_INSERT_COL'))">icon-expand-alt</tal:block></span>
	</td>
</tr>

<tr tal:repeat="row_index python:range(table_rows)" tal:attributes="id python:'table_row_%i'%row_index">
	<td>
		<div class="btn-group">
			<span class="btn btn-default" onclick="actionBtnClick(this,'move_row_up')" tal:condition="python:row_index>0 or table_type==3"><tal:block tal:content="structure python:here.zmi_icon(name='icon-caret-up',extra='title=\042%s\042'%here.getZMILangStr('ACTION_MOVEUP'))">icon-caret-up</tal:block></span>
			<span class="btn btn-default" onclick="actionBtnClick(this,'move_row_down')" tal:condition="python:row_index>0 or table_type==3"><tal:block tal:content="structure python:here.zmi_icon(name='icon-caret-down',extra='title=\042%s\042'%here.getZMILangStr('ACTION_MOVEDOWN'))">icon-caret-down</tal:block></span>
			<span class="btn btn-default" onclick="actionBtnClick(this,'delete_row')" tal:condition="python:row_index>0 or table_type==3"><tal:block tal:content="structure python:here.zmi_icon(name='icon-trash',extra='title=\042%s\042'%here.getZMILangStr('ACTION_DELETE_ROW'))">icon-trash</tal:block></span>
			<span class="btn btn-default" onclick="actionBtnClick(this,'insert_row')" tal:condition="python:row_index>0 or table_type==3"><tal:block tal:content="structure python:here.zmi_icon(name='icon-expand-alt',extra='title=\042%s\042'%here.getZMILangStr('ACTION_INSERT_ROW'))">icon-expand-alt</tal:block></span>
		</div><!-- .btn-group -->
	</td>
	<tal:block tal:repeat="col_index python:range(len(table_table[row_index]))">
		<tal:block tal:define="global 
				cell python:table_table[row_index][col_index];
				pattern python:'%3Cdtml-var%20\042 getlinkurl\\((.*?),request\\)\042=\042\042>\042&gt\073';
				replacement python:'<dtml-var \042getLinkUrl(\\1,REQUEST)\042>\042>';
				cell_content python:here.re_sub(pattern,replacement,cell.get('content',''));
				cell_format python:cell.get('format',textFormatDefault);
				richedit_preview python:int(request.get('richedit_fmt') is not None and cell_format==request.get('richedit_fmt').getId())">
			<tal:block tal:condition="python:table_type==4 and row_index==0 and col_index==0">
				<td tal:attributes="colspan cell/colspan">&nbsp;</td>
			</tal:block>
			<tal:block tal:condition="not:python:table_type==4 and row_index==0 and col_index==0">
				<td class="ZMSTable-cell" tal:attributes="colspan cell/colspan">
				<div class="ZMSTable">
					<table style="width:100%" class="ZMSTable">
					<tr>
						<tal:block tal:content="structure python:'<%s title=\042onDblClick: %s\042 class=\042table_cell_editable\042>'%(['td',cell['tag']][cell['tag']!=''],here.getZMILangStr('ACTION_EDIT_CELL'))">start-tag</tal:block>
						<input type="hidden" tal:attributes="id python:'tag_%i_%i'%(col_index,row_index); value cell/tag" />
						<input type="hidden" tal:attributes="id python:'format_%i_%i'%(col_index,row_index); value cell_format" />
						<div tal:attributes="id python:'input_%i_%i'%(col_index,row_index); class python:['','ui-helper-hidden'][richedit_preview]">
							<tal:block tal:content="structure python:here.getTextArea(request['fmName'],'content_%i_%i'%(col_index,row_index),10,1,value=cell_content,enabled=True,REQUEST=request,extra=' style=\042border:none;background-color:transparent;width:100%;\042')"></tal:block>
						</div>
						<div tal:attributes="id python:'preview_%i_%i'%(col_index,row_index);class python:['ui-helper-hidden',''][richedit_preview]"
							><tal:block tal:condition="cell/content" tal:content="structure cell_content">the cell-content</tal:block
							><tal:block tal:condition="not:cell/content">&nbsp;</tal:block
						></div>
						<tal:block tal:content="structure python:'</%s><!-- .table_cell_editable -->'%cell['tag']">end-tag</tal:block>
					</tr>
					</table><!-- .ZMSTable -->
				</div><!-- .ZMSTable -->
				</td>
			</tal:block>
		</tal:block>
	</tal:block>
	<td></td>
</tr>

<tr>
	<td>
		<span class="btn btn-default" onclick="actionBtnClick(this,'insert_row')"><tal:block tal:content="structure python:here.zmi_icon(name='icon-expand-alt',extra='title=\042%s\042'%here.getZMILangStr('ACTION_INSERT_ROW'))">icon-expand-alt</tal:block></span>
	</td>
</tr>

</table><!-- #table_cell_editor -->

<input type="hidden" id="cols" tal:attributes="value table_cols"/>
<input type="hidden" id="rows" tal:attributes="value table_rows"/>

</tal:block>
</tal:block>

<input type="hidden" id="table_table" tal:attributes="name python:'table_%s'%request['lang']" value="<list></list>"/>
<input type="hidden" id="table_colgroup_cols" tal:attributes="name python:'cols_%s'%request['lang']" value="<list></list>"/>
<tal:block tal:define="global dummy0 python:request.set('ZMS_HIDE_ELEMENTS',request.get('ZMS_HIDE_ELEMENTS',[])+['type','table','colgroup','cols','sortable'])"></tal:block>

</tal:block>]]>
                  </item>
                  <item key="id"><![CDATA[interface0]]></item>
                  <item key="name"><![CDATA[interface0]]></item>
                  <item key="type"><![CDATA[interface]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="default"><![CDATA[0]]></item>
                  <item key="id"><![CDATA[sortable]]></item>
                  <item key="name"><![CDATA[Sortable]]></item>
                  <item key="type"><![CDATA[boolean]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[type]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="name"><![CDATA[Type]]></item>
                  <item key="type"><![CDATA[int]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[table]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[Table]]></item>
                  <item key="type"><![CDATA[list]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="default"><![CDATA[1]]></item>
                  <item key="id"><![CDATA[colgroup]]></item>
                  <item key="name"><![CDATA[Colgroup]]></item>
                  <item key="type"><![CDATA[boolean]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[cols]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[Cols]]></item>
                  <item key="type"><![CDATA[list]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[
(function($){$.extend({tablesorter:new
function(){var parsers=[],widgets=[];this.defaults={cssHeader:"header",cssAsc:"headerSortUp",cssDesc:"headerSortDown",cssChildRow:"expand-child",sortInitialOrder:"asc",sortMultiSortKey:"shiftKey",sortForce:null,sortAppend:null,sortLocaleCompare:true,textExtraction:"simple",parsers:{},widgets:[],widgetZebra:{css:["even","odd"]},headers:{},widthFixed:false,cancelSelection:true,sortList:[],headerList:[],dateFormat:"us",decimal:'/\.|\,/g',onRenderHeader:null,selectorHeaders:'thead th',debug:false};function benchmark(s,d){log(s+","+(new Date().getTime()-d.getTime())+"ms");}this.benchmark=benchmark;function log(s){if(typeof console!="undefined"&&typeof console.debug!="undefined"){console.log(s);}else{alert(s);}}function buildParserCache(table,$headers){if(table.config.debug){var parsersDebug="";}if(table.tBodies.length==0)return;var rows=table.tBodies[0].rows;if(rows[0]){var list=[],cells=rows[0].cells,l=cells.length;for(var i=0;i<l;i++){var p=false;if($.metadata&&($($headers[i]).metadata()&&$($headers[i]).metadata().sorter)){p=getParserById($($headers[i]).metadata().sorter);}else if((table.config.headers[i]&&table.config.headers[i].sorter)){p=getParserById(table.config.headers[i].sorter);}if(!p){p=detectParserForColumn(table,rows,-1,i);}if(table.config.debug){parsersDebug+="column:"+i+" parser:"+p.id+"\n";}list.push(p);}}if(table.config.debug){log(parsersDebug);}return list;};function detectParserForColumn(table,rows,rowIndex,cellIndex){var l=parsers.length,node=false,nodeValue=false,keepLooking=true;while(nodeValue==''&&keepLooking){rowIndex++;if(rows[rowIndex]){node=getNodeFromRowAndCellIndex(rows,rowIndex,cellIndex);nodeValue=trimAndGetNodeText(table.config,node);if(table.config.debug){log('Checking if value was empty on row:'+rowIndex);}}else{keepLooking=false;}}for(var i=1;i<l;i++){if(parsers[i].is(nodeValue,table,node)){return parsers[i];}}return parsers[0];}function getNodeFromRowAndCellIndex(rows,rowIndex,cellIndex){return rows[rowIndex].cells[cellIndex];}function trimAndGetNodeText(config,node){return $.trim(getElementText(config,node));}function getParserById(name){var l=parsers.length;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==name.toLowerCase()){return parsers[i];}}return false;}function buildCache(table){if(table.config.debug){var cacheTime=new Date();}var totalRows=(table.tBodies[0]&&table.tBodies[0].rows.length)||0,totalCells=(table.tBodies[0].rows[0]&&table.tBodies[0].rows[0].cells.length)||0,parsers=table.config.parsers,cache={row:[],normalized:[]};for(var i=0;i<totalRows;++i){var c=$(table.tBodies[0].rows[i]),cols=[];if(c.hasClass(table.config.cssChildRow)){cache.row[cache.row.length-1]=cache.row[cache.row.length-1].add(c);continue;}cache.row.push(c);for(var j=0;j<totalCells;++j){cols.push(parsers[j].format(getElementText(table.config,c[0].cells[j]),table,c[0].cells[j]));}cols.push(cache.normalized.length);cache.normalized.push(cols);cols=null;};if(table.config.debug){benchmark("Building cache for "+totalRows+" rows:",cacheTime);}return cache;};function getElementText(config,node){var text="";if(!node)return"";if(!config.supportsTextContent)config.supportsTextContent=node.textContent||false;if(config.textExtraction=="simple"){if(config.supportsTextContent){text=node.textContent;}else{if(node.childNodes[0]&&node.childNodes[0].hasChildNodes()){text=node.childNodes[0].innerHTML;}else{text=node.innerHTML;}}}else{if(typeof(config.textExtraction)=="function"){text=config.textExtraction(node);}else{text=$(node).text();}}return text;}function appendToTable(table,cache){if(table.config.debug){var appendTime=new Date()}var c=cache,r=c.row,n=c.normalized,totalRows=n.length,checkCell=(n[0].length-1),tableBody=$(table.tBodies[0]),rows=[];for(var i=0;i<totalRows;i++){var pos=n[i][checkCell];rows.push(r[pos]);if(!table.config.appender){var l=r[pos].length;for(var j=0;j<l;j++){tableBody[0].appendChild(r[pos][j]);}}}if(table.config.appender){table.config.appender(table,rows);}rows=null;if(table.config.debug){benchmark("Rebuilt table:",appendTime);}applyWidget(table);setTimeout(function(){$(table).trigger("sortEnd");},0);};function buildHeaders(table){if(table.config.debug){var time=new Date();}var meta=($.metadata)?true:false;var header_index=computeTableHeaderCellIndexes(table);$tableHeaders=$(table.config.selectorHeaders,table).each(function(index){this.column=header_index[this.parentNode.rowIndex+"-"+this.cellIndex];this.order=formatSortingOrder(table.config.sortInitialOrder);this.count=this.order;if(checkHeaderMetadata(this)||checkHeaderOptions(table,index))this.sortDisabled=true;if(checkHeaderOptionsSortingLocked(table,index))this.order=this.lockedOrder=checkHeaderOptionsSortingLocked(table,index);if(!this.sortDisabled){var $th=$(this).addClass(table.config.cssHeader);if(table.config.onRenderHeader)table.config.onRenderHeader.apply($th);}table.config.headerList[index]=this;});if(table.config.debug){benchmark("Built headers:",time);log($tableHeaders);}return $tableHeaders;};function computeTableHeaderCellIndexes(t){var matrix=[];var lookup={};var thead=t.getElementsByTagName('THEAD')[0];var trs=thead.getElementsByTagName('TR');for(var i=0;i<trs.length;i++){var cells=trs[i].cells;for(var j=0;j<cells.length;j++){var c=cells[j];var rowIndex=c.parentNode.rowIndex;var cellId=rowIndex+"-"+c.cellIndex;var rowSpan=c.rowSpan||1;var colSpan=c.colSpan||1
var firstAvailCol;if(typeof(matrix[rowIndex])=="undefined"){matrix[rowIndex]=[];}for(var k=0;k<matrix[rowIndex].length+1;k++){if(typeof(matrix[rowIndex][k])=="undefined"){firstAvailCol=k;break;}}lookup[cellId]=firstAvailCol;for(var k=rowIndex;k<rowIndex+rowSpan;k++){if(typeof(matrix[k])=="undefined"){matrix[k]=[];}var matrixrow=matrix[k];for(var l=firstAvailCol;l<firstAvailCol+colSpan;l++){matrixrow[l]="x";}}}}return lookup;}function checkCellColSpan(table,rows,row){var arr=[],r=table.tHead.rows,c=r[row].cells;for(var i=0;i<c.length;i++){var cell=c[i];if(cell.colSpan>1){arr=arr.concat(checkCellColSpan(table,headerArr,row++));}else{if(table.tHead.length==1||(cell.rowSpan>1||!r[row+1])){arr.push(cell);}}}return arr;};function checkHeaderMetadata(cell){if(($.metadata)&&($(cell).metadata().sorter===false)){return true;};return false;}function checkHeaderOptions(table,i){if((table.config.headers[i])&&(table.config.headers[i].sorter===false)){return true;};return false;}function checkHeaderOptionsSortingLocked(table,i){if((table.config.headers[i])&&(table.config.headers[i].lockedOrder))return table.config.headers[i].lockedOrder;return false;}function applyWidget(table){var c=table.config.widgets;var l=c.length;for(var i=0;i<l;i++){getWidgetById(c[i]).format(table);}}function getWidgetById(name){var l=widgets.length;for(var i=0;i<l;i++){if(widgets[i].id.toLowerCase()==name.toLowerCase()){return widgets[i];}}};function formatSortingOrder(v){if(typeof(v)!="Number"){return(v.toLowerCase()=="desc")?1:0;}else{return(v==1)?1:0;}}function isValueInArray(v,a){var l=a.length;for(var i=0;i<l;i++){if(a[i][0]==v){return true;}}return false;}function setHeadersCss(table,$headers,list,css){$headers.removeClass(css[0]).removeClass(css[1]);var h=[];$headers.each(function(offset){if(!this.sortDisabled){h[this.column]=$(this);}});var l=list.length;for(var i=0;i<l;i++){h[list[i][0]].addClass(css[list[i][1]]);}}function fixColumnWidth(table,$headers){var c=table.config;if(c.widthFixed){var colgroup=$('<colgroup>');$("tr:first td",table.tBodies[0]).each(function(){colgroup.append($('<col>').css('width',$(this).width()));});$(table).prepend(colgroup);};}function updateHeaderSortCount(table,sortList){var c=table.config,l=sortList.length;for(var i=0;i<l;i++){var s=sortList[i],o=c.headerList[s[0]];o.count=s[1];o.count++;}}function multisort(table,sortList,cache){if(table.config.debug){var sortTime=new Date();}var dynamicExp="var sortWrapper = function(a,b) {",l=sortList.length;for(var i=0;i<l;i++){var c=sortList[i][0];var order=sortList[i][1];var s=(table.config.parsers[c].type=="text")?((order==0)?makeSortFunction("text","asc",c):makeSortFunction("text","desc",c)):((order==0)?makeSortFunction("numeric","asc",c):makeSortFunction("numeric","desc",c));var e="e"+i;dynamicExp+="var "+e+" = "+s;dynamicExp+="if("+e+") { return "+e+"; } ";dynamicExp+="else { ";}var orgOrderCol=cache.normalized[0].length-1;dynamicExp+="return a["+orgOrderCol+"]-b["+orgOrderCol+"];";for(var i=0;i<l;i++){dynamicExp+="}; ";}dynamicExp+="return 0; ";dynamicExp+="}; ";if(table.config.debug){benchmark("Evaling expression:"+dynamicExp,new Date());}eval(dynamicExp);cache.normalized.sort(sortWrapper);if(table.config.debug){benchmark("Sorting on "+sortList.toString()+" and dir "+order+" time:",sortTime);}return cache;};function makeSortFunction(type,direction,index){var a="a["+index+"]",b="b["+index+"]";if(type=='text'&&direction=='asc'){return"("+a+" == "+b+" ? 0 : ("+a+" === null ? Number.POSITIVE_INFINITY : ("+b+" === null ? Number.NEGATIVE_INFINITY : ("+a+" < "+b+") ? -1 : 1 )));";}else if(type=='text'&&direction=='desc'){return"("+a+" == "+b+" ? 0 : ("+a+" === null ? Number.POSITIVE_INFINITY : ("+b+" === null ? Number.NEGATIVE_INFINITY : ("+b+" < "+a+") ? -1 : 1 )));";}else if(type=='numeric'&&direction=='asc'){return"("+a+" === null && "+b+" === null) ? 0 :("+a+" === null ? Number.POSITIVE_INFINITY : ("+b+" === null ? Number.NEGATIVE_INFINITY : "+a+" - "+b+"));";}else if(type=='numeric'&&direction=='desc'){return"("+a+" === null && "+b+" === null) ? 0 :("+a+" === null ? Number.POSITIVE_INFINITY : ("+b+" === null ? Number.NEGATIVE_INFINITY : "+b+" - "+a+"));";}};function makeSortText(i){return"((a["+i+"] < b["+i+"]) ? -1 : ((a["+i+"] > b["+i+"]) ? 1 : 0));";};function makeSortTextDesc(i){return"((b["+i+"] < a["+i+"]) ? -1 : ((b["+i+"] > a["+i+"]) ? 1 : 0));";};function makeSortNumeric(i){return"a["+i+"]-b["+i+"];";};function makeSortNumericDesc(i){return"b["+i+"]-a["+i+"];";};function sortText(a,b){if(table.config.sortLocaleCompare)return a.localeCompare(b);return((a<b)?-1:((a>b)?1:0));};function sortTextDesc(a,b){if(table.config.sortLocaleCompare)return b.localeCompare(a);return((b<a)?-1:((b>a)?1:0));};function sortNumeric(a,b){return a-b;};function sortNumericDesc(a,b){return b-a;};function getCachedSortType(parsers,i){return parsers[i].type;};this.construct=function(settings){return this.each(function(){if(!this.tHead||!this.tBodies)return;var $this,$document,$headers,cache,config,shiftDown=0,sortOrder;this.config={};config=$.extend(this.config,$.tablesorter.defaults,settings);$this=$(this);$.data(this,"tablesorter",config);$headers=buildHeaders(this);this.config.parsers=buildParserCache(this,$headers);cache=buildCache(this);var sortCSS=[config.cssDesc,config.cssAsc];fixColumnWidth(this);$headers.click(function(e){var totalRows=($this[0].tBodies[0]&&$this[0].tBodies[0].rows.length)||0;if(!this.sortDisabled&&totalRows>0){$this.trigger("sortStart");var $cell=$(this);var i=this.column;this.order=this.count++%2;if(this.lockedOrder)this.order=this.lockedOrder;if(!e[config.sortMultiSortKey]){config.sortList=[];if(config.sortForce!=null){var a=config.sortForce;for(var j=0;j<a.length;j++){if(a[j][0]!=i){config.sortList.push(a[j]);}}}config.sortList.push([i,this.order]);}else{if(isValueInArray(i,config.sortList)){for(var j=0;j<config.sortList.length;j++){var s=config.sortList[j],o=config.headerList[s[0]];if(s[0]==i){o.count=s[1];o.count++;s[1]=o.count%2;}}}else{config.sortList.push([i,this.order]);}};setTimeout(function(){setHeadersCss($this[0],$headers,config.sortList,sortCSS);appendToTable($this[0],multisort($this[0],config.sortList,cache));},1);return false;}}).mousedown(function(){if(config.cancelSelection){this.onselectstart=function(){return false};return false;}});$this.bind("update",function(){var me=this;setTimeout(function(){me.config.parsers=buildParserCache(me,$headers);cache=buildCache(me);},1);}).bind("updateCell",function(e,cell){var config=this.config;var pos=[(cell.parentNode.rowIndex-1),cell.cellIndex];cache.normalized[pos[0]][pos[1]]=config.parsers[pos[1]].format(getElementText(config,cell),cell);}).bind("sorton",function(e,list){$(this).trigger("sortStart");config.sortList=list;var sortList=config.sortList;updateHeaderSortCount(this,sortList);setHeadersCss(this,$headers,sortList,sortCSS);appendToTable(this,multisort(this,sortList,cache));}).bind("appendCache",function(){appendToTable(this,cache);}).bind("applyWidgetId",function(e,id){getWidgetById(id).format(this);}).bind("applyWidgets",function(){applyWidget(this);});if($.metadata&&($(this).metadata()&&$(this).metadata().sortlist)){config.sortList=$(this).metadata().sortlist;}if(config.sortList.length>0){$this.trigger("sorton",[config.sortList]);}applyWidget(this);});};this.addParser=function(parser){var l=parsers.length,a=true;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==parser.id.toLowerCase()){a=false;}}if(a){parsers.push(parser);};};this.addWidget=function(widget){widgets.push(widget);};this.formatFloat=function(s){var i=parseFloat(s);return(isNaN(i))?0:i;};this.formatInt=function(s){var i=parseInt(s);return(isNaN(i))?0:i;};this.isDigit=function(s,config){return/^[-+]?\d*$/.test($.trim(s.replace(/[,.']/g,'')));};this.clearTableBody=function(table){if($.browser.msie){function empty(){while(this.firstChild)this.removeChild(this.firstChild);}empty.apply(table.tBodies[0]);}else{table.tBodies[0].innerHTML="";}};}});$.fn.extend({tablesorter:$.tablesorter.construct});var ts=$.tablesorter;ts.addParser({id:"text",is:function(s){return true;},format:function(s){return $.trim(s.toLocaleLowerCase());},type:"text"});ts.addParser({id:"digit",is:function(s,table){var c=table.config;return $.tablesorter.isDigit(s,c);},format:function(s){return $.tablesorter.formatFloat(s);},type:"numeric"});ts.addParser({id:"currency",is:function(s){return/^[$?.]/.test(s);},format:function(s){return $.tablesorter.formatFloat(s.replace(new RegExp(/[$]/g),""));},type:"numeric"});ts.addParser({id:"ipAddress",is:function(s){return/^\d{2,3}[\.]\d{2,3}[\.]\d{2,3}[\.]\d{2,3}$/.test(s);},format:function(s){var a=s.split("."),r="",l=a.length;for(var i=0;i<l;i++){var item=a[i];if(item.length==2){r+="0"+item;}else{r+=item;}}return $.tablesorter.formatFloat(r);},type:"numeric"});ts.addParser({id:"url",is:function(s){return/^(https?|ftp|file):\/\/$/.test(s);},format:function(s){return jQuery.trim(s.replace(new RegExp(/(https?|ftp|file):\/\//),''));},type:"text"});ts.addParser({id:"isoDate",is:function(s){return/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(s);},format:function(s){return $.tablesorter.formatFloat((s!="")?new Date(s.replace(new RegExp(/-/g),"/")).getTime():"0");},type:"numeric"});ts.addParser({id:"percent",is:function(s){return/\%$/.test($.trim(s));},format:function(s){return $.tablesorter.formatFloat(s.replace(new RegExp(/%/g),""));},type:"numeric"});ts.addParser({id:"usLongDate",is:function(s){return s.match(new RegExp(/^[A-Za-z]{3,10}\.? [0-9]{1,2}, ([0-9]{4}|'?[0-9]{2}) (([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(AM|PM)))$/));},format:function(s){return $.tablesorter.formatFloat(new Date(s).getTime());},type:"numeric"});ts.addParser({id:"shortDate",is:function(s){return/\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}/.test(s);},format:function(s,table){var c=table.config;s=s.replace(/\-/g,"/");if(c.dateFormat=="us"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$1/$2");}else if(c.dateFormat=="uk"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$2/$1");}else if(c.dateFormat=="dd/mm/yy"||c.dateFormat=="dd-mm-yy"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2})/,"$1/$2/$3");}return $.tablesorter.formatFloat(new Date(s).getTime());},type:"numeric"});ts.addParser({id:"time",is:function(s){return/^(([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(am|pm)))$/.test(s);},format:function(s){return $.tablesorter.formatFloat(new Date("2000/01/01 "+s).getTime());},type:"numeric"});ts.addParser({id:"metadata",is:function(s){return false;},format:function(s,table,cell){var c=table.config,p=(!c.parserMetadataName)?'sortValue':c.parserMetadataName;return $(cell).metadata()[p];},type:"numeric"});ts.addWidget({id:"zebra",format:function(table){if(table.config.debug){var time=new Date();}var $tr,row=-1,odd;$("tr:visible",table.tBodies[0]).each(function(i){$tr=$(this);if(!$tr.hasClass(table.config.cssChildRow))row++;odd=(row%2==0);$tr.removeClass(table.config.widgetZebra.css[odd?0:1]).addClass(table.config.widgetZebra.css[odd?1:0])});if(table.config.debug){$.tablesorter.benchmark("Applying Zebra widget",time);}}});})(jQuery);]]>
                  </item>
                  <item key="id"><![CDATA[jquery.tablesorter.min.js]]></item>
                  <item key="name"><![CDATA[jQuery tablesorter plugin: http://tablesorter.com]]></item>
                  <item key="type"><![CDATA[resource]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[GIF89a    #-0!   ,       gk$- ;]]></item>
                  <item key="id"><![CDATA[small_asc.gif]]></item>
                  <item key="name"><![CDATA[tablesorter: Asc]]></item>
                  <item key="type"><![CDATA[resource]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[GIF89a    #-0!   ,       T2Y ;]]></item>
                  <item key="id"><![CDATA[small_desc.gif]]></item>
                  <item key="name"><![CDATA[tablesorter: Desc]]></item>
                  <item key="type"><![CDATA[resource]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[GIF89a 	   #-0!   ,     	  	bxT2W>e`U  ;]]></item>
                  <item key="id"><![CDATA[small.gif]]></item>
                  <item key="name"><![CDATA[tablesorter: Small]]></item>
                  <item key="type"><![CDATA[resource]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSTable.titlealt"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext
##title=py: DC.Title.Alt
##
# --// BO titlealt //--

titlealt = zmscontext.attr('caption')
if titlealt:
    return titlealt
return zmscontext.display_type(zmscontext.REQUEST)

# --// EO titlealt //--
]]>
                  </item>
                  <item key="id"><![CDATA[titlealt]]></item>
                  <item key="name"><![CDATA[DC.Title.Alt]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSTable.widths"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext
##title=py: Col-Widths [list]
##
# --// BO widths //--
from Products.zms import standard

REQUEST = zmscontext.REQUEST
table = zmscontext.attr('table')
ncols = max(map(lambda x: len(x), table))
weights = map(lambda x: 1, range( ncols))
for row in table:
    i = 0
    for cell in row:
        weight = len(standard.re_sub('<(.*?)>', '',standard.dt_exec(zmscontext,cell.get('content',''))))
        weights[i] = weights[i] + weight
        i += 1
return map(lambda x: int((x*100.0)/sum(weights)), weights)

# --// EO widths //--
]]>
                  </item>
                  <item key="id"><![CDATA[widths]]></item>
                  <item key="name"><![CDATA[Col-Widths [list]]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSTable.format"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext
##title=py: contentEditable.Cell: Get format (@key)
##
# --// BO format //--

REQUEST = zmscontext.REQUEST
key = REQUEST.get('key')
if key:
    table = zmscontext.attr('table')
    col = int(key[key.find('_')+1:key.rfind('_')])
    row = int(key[key.rfind('_')+1:])
    return table[row][col]['format']
return ''

# --// EO format //--
]]>
                  </item>
                  <item key="id"><![CDATA[format]]></item>
                  <item key="name"><![CDATA[contentEditable.Cell: Get format (@key)]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSTable.setObjProperty"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext
##title=py: contentEditable.Cell: Set property (@pKey,@pValue)
##
# --// BO setObjProperty //--

request = zmscontext.REQUEST
key = request.get('pKey')
value = request.get('pValue')
if key.startswith('table_'):
    table = zmscontext.attr('table')
    col = int(key[key.find('_')+1:key.rfind('_')])
    row = int(key[key.rfind('_')+1:])
    table[row][col]['content'] = value
    lang = request.get('lang')
    zmscontext.setObjProperty('table',table_table,lang)

# --// EO setObjProperty //--
]]>
                  </item>
                  <item key="id"><![CDATA[setObjProperty]]></item>
                  <item key="name"><![CDATA[contentEditable.Cell: Set property (@pKey,@pValue)]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<!-- ZMSTable.standard_html -->

<div class="table-responsive" tal:define="global
		zmscontext options/zmscontext;
		standard      modules/Products.zms/standard;
		Std           modules/Products.PythonScripts/standard; newline_to_br nocall:Std/newline_to_br;
		rteformats    python:filter(lambda x: str(x.getRichedit())=='1',here.getTextFormats(request)); 
		table         python:zmscontext.attr('table');
		sortable      python:int(zmscontext.attr('sortable') in [1,True]);
		cols          python:zmscontext.attr('cols');
		summary       python:unicode(zmscontext.attr('attr_dc_description'),'utf-8');
		caption       python:unicode(zmscontext.attr('caption'),'utf-8');
		table_type    python:zmscontext.attr('type');
		resourceurl    python:'%s/%s.'%(zmscontext.metaobj_manager.absolute_url(),zmscontext.meta_id)">
	<tal:block tal:condition="python:sortable and request.get('ZMSTable.standard_html',True)">
		<tal:block tal:content="structure python:'<script>'"></tal:block>
			$(function(){
				$.plugin('tablesorter',{
					files: ['<tal:block tal:content="resourceurl"></tal:block>jquery.tablesorter.min.js']
					});
				$.plugin('tablesorter').get('.ZMSTable.sortable',function() {
						$(".ZMSTable.sortable").tablesorter({ 
								widgets: ["zebra"],
								widgetOptions:{
										zebra:["even", "odd"]
								}
						});
					});
			});
		<tal:block tal:content="structure python:'</script>'"></tal:block>
		<tal:block tal:content="structure python:'<style type=\042text/css\042>'"></tal:block>
			table.ZMSTable.sortable thead tr .header {
				background-image: url(<tal:block tal:content="resourceurl"></tal:block>small.gif);
				background-repeat: no-repeat;
				background-position: center right;
				cursor: pointer;
			}
			table.ZMSTable.sortable thead tr .headerSortUp {
				background-image: url(<tal:block tal:content="resourceurl"></tal:block>small_asc.gif);
			}
			table.ZMSTable.sortable thead tr .headerSortDown {
				background-image: url(<tal:block tal:content="resourceurl"></tal:block>small_desc.gif);
			}
		<tal:block tal:content="structure python:'</style>'"></tal:block>
		<tal:block tal:define="global dummy0 python:request.set('ZMSTable.standard_html',False)"></tal:block>
	</tal:block>
	<tal:block tal:condition="python:zmscontext.attr('colgroup')" tal:define="d python:{}">
		<tal:block tal:repeat="col python:zmscontext.attr('widths')">
			<tal:block tal:define="col_index repeat/col/index">
				<tal:block tal:condition="python:col_index<len(cols) and cols[col_index]">
					<tal:block tal:define="dummy0 python:zmscontext.operator_setitem(d,col_index+1,str(cols[col_index])+'%')"></tal:block>
				</tal:block>
			</tal:block>
		</tal:block>
		<tal:block tal:condition="python:len(d.keys())>0">
			<tal:block tal:content="structure python:'<style type=\042text/css\042>'"></tal:block>
				<tal:block tal:repeat="k python:d.keys()">
							table#<tal:block tal:content="python:zmscontext.id"></tal:block> tr th:nth-child(<tal:block tal:content="k"></tal:block>), 
							table#<tal:block tal:content="python:zmscontext.id"></tal:block> tr td:nth-child(<tal:block tal:content="k"></tal:block>) 
								{ width:<tal:block tal:content="python:d[k]"></tal:block> }
				</tal:block>
			<tal:block tal:content="structure python:'</style>'"></tal:block>
		</tal:block>
	</tal:block>
	<table tal:attributes="id python:zmscontext.id; class python:' '.join(['ZMSTable table bs-table']+[[],['sortable']][sortable]); summary summary">
		<caption tal:condition="python:caption" tal:content="structure caption">The caption</caption>
		<tal:block tal:repeat="row table">
			<tal:block tal:condition="python:table_type==1 and row==table[0]" tal:content="structure python:'<thead>'"></tal:block>
			<tal:block on-error="structure string:<!-- INDEX ERROR -->" tal:condition="python:table_type==1 and row==table[1]" tal:content="structure python:'<tbody>'"></tal:block>
			<tal:block tal:condition="repeat/row/odd"><tal:block tal:define="global tr_class python:'odd'"></tal:block></tal:block>
			<tal:block tal:condition="repeat/row/even"><tal:block tal:define="global tr_class python:'even'"></tal:block></tal:block>
			<tr tal:attributes="class tr_class">
				<tal:block tal:repeat="column row">
					<tal:block tal:define="
							row_index     repeat/row/index;
							col_index     repeat/column/index;
							tag           python:str(column.get('tag','')).lower();
							colspan       python:column.get('colspan',1);
							format        python:column.get('format','');
							pattern       python:'%3Cdtml-var%20\042 getlinkurl\\((.*?),request\\)\042=\042\042>\042&gt\073';
							replacement   python:'<dtml-var \042getLinkUrl(\\1,REQUEST)\042>\042>';
							content       python:standard.re_sub(pattern,replacement,column.get('content',''));
							content       python:[content,newline_to_br(content)][format==''];
							col_text      python:[standard.dt_exec(zmscontext,zmscontext.renderText(format,'table_%i_%i'%(col_index,row_index),content,request)),content][format in map(lambda x: x.getId(),rteformats)];
							col_text      python:zmscontext.validateInlineLinkObj(col_text);
							col_text      python:standard.re_sub('^(&nbsp\073)','',col_text);
							col_text      python:standard.re_sub('^<p>((\\w|\\W)*?)</p>$','\\1',col_text)">
						<tal:block tal:condition="python:tag in ['td','th']">
							<tal:block tal:content="structure python:'<%s%s>'%(tag,['',' colspan=\042%i\042'%colspan][int(colspan>1)])"></tal:block>
								<tal:block tal:condition="python:col_text" tal:content="structure col_text">The cell</tal:block>
								<tal:block tal:condition="python:not (col_text)">&nbsp;</tal:block>
							<tal:block tal:content="structure python:'</%s>'%tag"></tal:block>
						</tal:block>
						<td tal:condition="python:tag not in ['td','th']" style="background:transparent;"></td>
					</tal:block>
				</tal:block>
			</tr>
			<tal:block tal:condition="python:table_type==1 and row==table[0]" tal:content="structure python:'</thead>'"></tal:block>
			<tal:block on-error="structure string:<!-- INDEX ERROR -->" tal:condition="python:table_type==1 and row==table[-1]" tal:content="structure python:'</tbody>'"></tal:block>
		</tal:block>
	</table>
</div>

<!-- /ZMSTable.standard_html -->]]>
                  </item>
                  <item key="id"><![CDATA[standard_html]]></item>
                  <item key="name"><![CDATA[Template: ZMSTable]]></item>
                  <item key="type"><![CDATA[zpt]]></item>
                </dictionary>
              </item>
            </list>
          </item>
          <item key="access" type="dictionary">
            <dictionary>
              <item key="delete_custom"></item>
              <item key="delete_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
              <item key="insert_custom"><![CDATA[{$}]]></item>
              <item key="insert_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
            </dictionary>
          </item>
          <item key="enabled" type="int">1</item>
          <item key="id"><![CDATA[ZMSTable]]></item>
          <item key="name"><![CDATA[ZMSTable]]></item>
          <item key="package"><![CDATA[com.zms.foundation]]></item>
          <item key="revision"><![CDATA[3.2.10]]></item>
          <item key="type"><![CDATA[ZMSObject]]></item>
        </dictionary>
      </item>
    </dictionary>
  </item>
  <item type="dictionary">
    <dictionary>
      <item key="key"><![CDATA[ZMSTeaserContainer]]></item>
      <item key="value" type="dictionary">
        <dictionary>
          <item key="__obj_attrs__" type="list">
            <list>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[icon-bullhorn]]></item>
                  <item key="id"><![CDATA[icon_clazz]]></item>
                  <item key="name"><![CDATA[Icon (Class)]]></item>
                  <item key="type"><![CDATA[constant]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[f_css_defaults]]></item>
                  <item key="name"><![CDATA[CSS: Default]]></item>
                  <item key="type"><![CDATA[resource]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[e]]></item>
                  <item key="keys" type="list">
                    <list>
                      <item><![CDATA[ZMSNote]]></item>
                      <item><![CDATA[ZMSFile]]></item>
                      <item><![CDATA[type(ZMSTeaserElement)]]></item>
                    </list>
                  </item>
                  <item key="name"><![CDATA[Teaser-Elements]]></item>
                  <item key="repetitive" type="int">1</item>
                  <item key="type"><![CDATA[*]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "getTeaserElements"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=
##title=Function: Teaser-Elements
##
# --// BO getTeaserElements //--

request = container.REQUEST
teaserElmnts = []
obs = context.breadcrumbs_obj_path(portalMaster=False)
obs.reverse()
this = context.getSelf()
for ob in obs:
  abort_penetrance = ob != this and ob.meta_type == 'ZMSLinkElement'
  if abort_penetrance:
    break
  temp = []
  subobs = ob.filteredChildNodes( request, ['ZMSCustom','ZMSTeaserContainer'])
  for subob in subobs:
    if subob.meta_id == 'ZMSTeaserContainer':
      temp.extend( subob.filteredChildNodes( request))
    elif subob.getType() == 'ZMSTeaserElement':
      temp.append( subob)
  for teaserElmnt in temp:
    penetrance = teaserElmnt.attr('attr_penetrance')
    if ( penetrance in [0,'this',''] and context == ob) or \
       ( penetrance in [1,'sub_nav'] and context.meta_id in ['ZMS','ZMSFolder']) or \
       ( penetrance in [2,'sub_all']):
      teaserElmnts.insert( 0, teaserElmnt)
  abort_penetrance = ob.attr('attr_zmsteasercontainer_abort_penetrance') not in ['',0]
  if abort_penetrance:
    break
teaserElmnts.reverse()
return teaserElmnts

# --// EO getTeaserElements //--
]]>
                  </item>
                  <item key="id"><![CDATA[getTeaserElements]]></item>
                  <item key="name"><![CDATA[Function: Teaser-Elements]]></item>
                  <item key="type"><![CDATA[Script (Python)]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "pageelement_Teaser"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=here=None,request=None
##title=Template: Teaser
##
# --// BO pageelement_Teaser //--

request = container.REQUEST
RESPONSE =  request.RESPONSE

last_borderstyle = None
last_bgcolor_border = None
teaserElmnts = context.getTeaserElements()
if teaserElmnts:
  print '<div class="ZMSTeaserContainer">'
  for teaserElmnt in teaserElmnts:
    if teaserElmnt.meta_id in ['ZMSLinkElement','ZMSFile','ZMSTeaserElement']:
      name = 'pageelement_TeaserElement'
    else:
      name = 'bodyContentZMSCustom_%s'%teaserElmnt.meta_id
    method = getattr(teaserElmnt,name,None)
    if method is not None:
      method_result = method(teaserElmnt,request)
    else:
      method_result = teaserElmnt.getBodyContent(request)
    try:
      method_result = unicode(method_result,'utf-8')
    except:
      pass
    print method_result
  print '</div><!-- .ZMSTeaserContainer -->'

return unicode(printed).encode('utf-8')

# --// EO pageelement_Teaser //--
]]>
                  </item>
                  <item key="id"><![CDATA[pageelement_Teaser]]></item>
                  <item key="name"><![CDATA[Template: Teaser]]></item>
                  <item key="type"><![CDATA[Script (Python)]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<!-- ZMSTeaserContainer.renderShort -->

<tal:block tal:define="global 
		zmscontext options/zmscontext">
	<div class="form-small" tal:repeat="teaserElmnt python:zmscontext.getChildNodes(request)">
		<a tal:attributes="
						href python:'%s/manage_main?lang=%s'%(teaserElmnt.absolute_url(),request['lang']); 
						title python:zmscontext.getZMILangStr('CAPTION_EDIT')%teaserElmnt.display_type(request)"
				tal:content="structure python:teaserElmnt.display_icon(request)">
			the internal link
		</a>
		<tal:block tal:define="global 
				url      python:zmscontext.getLinkUrl(teaserElmnt.attr('attr_url'));
				img_src  python:teaserElmnt.attr('attr_img_src')+'?';
				title    python:teaserElmnt.attr('title');
				abstract python:zmscontext.search_quote(teaserElmnt.attr('attr_abstract'))">
			<tal:block tal:condition="python:title">
				<a tal:condition="python:url" tal:attributes="href url" target="_blank" class="zmi" tal:content="title"><b>The title</b></a>
				<tal:block tal:condition="python:not url" tal:content="title">The title</tal:block>
			</tal:block>
			<tal:block tal:condition="python:not title">
				<tal:block tal:condition="python:img_src">
					<div><i>&laquo;<tal:block tal:content="python:img_src[img_src.rfind('/')+1:img_src.find('?')]"></tal:block>&raquo;</i></div>
				</tal:block>
			</tal:block>
			<div tal:content="structure abstract">The abstract</div>
		</tal:block>
	</div>
</tal:block>

<!-- /ZMSTeaserContainer.renderShort -->]]>
                  </item>
                  <item key="id"><![CDATA[renderShort]]></item>
                  <item key="name"><![CDATA[ZMI: Render short]]></item>
                  <item key="type"><![CDATA[zpt]]></item>
                </dictionary>
              </item>
            </list>
          </item>
          <item key="access" type="dictionary">
            <dictionary>
              <item key="delete_custom"></item>
              <item key="delete_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
              <item key="insert_custom"><![CDATA[{$}]]></item>
              <item key="insert_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
            </dictionary>
          </item>
          <item key="enabled" type="int">1</item>
          <item key="id"><![CDATA[ZMSTeaserContainer]]></item>
          <item key="name"><![CDATA[ZMSTeaserContainer]]></item>
          <item key="package"><![CDATA[com.zms.foundation]]></item>
          <item key="revision"><![CDATA[3.3.0]]></item>
          <item key="type"><![CDATA[ZMSObject]]></item>
        </dictionary>
      </item>
    </dictionary>
  </item>
  <item type="dictionary">
    <dictionary>
      <item key="key"><![CDATA[ZMSTeaserElement]]></item>
      <item key="value" type="dictionary">
        <dictionary>
          <item key="__obj_attrs__" type="list">
            <list>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[icon-bullhorn]]></item>
                  <item key="id"><![CDATA[icon_clazz]]></item>
                  <item key="name"><![CDATA[Icon (Class)]]></item>
                  <item key="type"><![CDATA[constant]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[f_css_defaults]]></item>
                  <item key="name"><![CDATA[CSS: Default]]></item>
                  <item key="type"><![CDATA[resource]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_penetrance]]></item>
                  <item key="keys" type="list">
                    <list>
                      <item><![CDATA[this]]></item>
                      <item><![CDATA[sub_nav]]></item>
                      <item><![CDATA[sub_all]]></item>
                    </list>
                  </item>
                  <item key="mandatory" type="int">1</item>
                  <item key="name"><![CDATA[Penetrance]]></item>
                  <item key="type"><![CDATA[select]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_url]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[Url]]></item>
                  <item key="type"><![CDATA[url]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[attr_img]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[Image]]></item>
                  <item key="type"><![CDATA[image]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[title]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[DC.Title]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[text]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[Text]]></item>
                  <item key="type"><![CDATA[richtext]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSTeaserElement.attr_img_src"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext
##title=py: Alias: Image
##
# --// BO attr_img_src //--

img = zmscontext.attr('attr_img')
if img:
    return img.getHref(zmscontext.REQUEST)
return ''

# --// EO attr_img_src //--
]]>
                  </item>
                  <item key="id"><![CDATA[attr_img_src]]></item>
                  <item key="name"><![CDATA[Alias: Image]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSTeaserElement.attr_abstract"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext
##title=py: Alias: Abstract
##
# --// BO attr_abstract //--

return zmscontext.attr('text')

# --// EO attr_abstract //--
]]>
                  </item>
                  <item key="id"><![CDATA[attr_abstract]]></item>
                  <item key="name"><![CDATA[Alias: Abstract]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<!-- pageelement_TeaserElement -->

	<div class="ZMSTeaserElement" tal:define="global 
		url           python:here.getLinkUrl(here.attr('attr_url'),request);
		target_url    python:['_self','_blank'][here.attr('attr_url').rfind('://')>0];
		img_src_attr  python:here.attr('attr_img_src');
		img_src       python:img_src_attr+'?';
		img_filename  python:img_src[img_src.rfind('/')+1:img_src.find('?')];
		title_url     python:here.attr('title');
		title_txt     python:title_url;
		abstract      python:here.attr('attr_abstract')">
		
			<tal:block tal:condition="python:len(title_url) > 4 and title_url.startswith('__') and title_url.endswith('__')">
				<tal:block tal:define="global title_url python:title_url[2:-2]; title_txt python:''"></tal:block>
			</tal:block>
			
			<tal:block tal:condition="python:title_txt or img_filename" tal:define="global 
					img python:'<img class=\042title\042 src=\042'+img_src_attr+'\042 alt=\042'+title_txt+'\042 border=\0420\042/>'">
				
				<div class="graphic" tal:condition="python:img_filename">
					<tal:block tal:condition="python:url" tal:content="structure python:here.tal_anchor(url,target=target_url,attrs={'title':title_url},content=img)">the image</tal:block>
					<tal:block tal:condition="python:not url" tal:content="structure img">the image</tal:block>
				</div>
				<div class="title" tal:condition="python:title_txt">
					<tal:block tal:condition="python:url" tal:content="structure python:here.tal_anchor(url,target=target_url,attrs={'title':title_url},content=title_txt)">the title</tal:block>
					<tal:block tal:condition="python:not url" tal:content="structure title_txt">the title</tal:block>
				</div>
				
				<div tal:condition="python:len(abstract)+len(url)>0" class="text">
					<tal:block tal:content="structure abstract">The abstract</tal:block>
					<tal:block tal:condition="python:len(abstract)>0 and len(url)>0" tal:content="structure python:here.getLangStr('HREF_MORE',request['lang'])%(' href=\042%s\042 title=\042%s\042'%(url,title_url))">the url</tal:block>
				</div>
				
			</tal:block>
			
	</div>

<!-- /pageelement_TeaserElement -->]]>
                  </item>
                  <item key="id"><![CDATA[pageelement_TeaserElement]]></item>
                  <item key="name"><![CDATA[Template: Teaser-Element]]></item>
                  <item key="type"><![CDATA[Page Template]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<!-- ZMSTeaserElement.standard_html -->

<tal:block tal:define="global 
		zmscontext options/zmscontext">
	<div tal:condition="python:request.get('URL').find('/manage')>0" class="ZMSTeaserContainer">
		<tal:block tal:content="structure python:zmscontext.pageelement_TeaserElement(zmscontext,request)">
			The teaser-element
		</tal:block>
	</div>
	<tal:block  tal:condition="not:python:request.get('URL').find('/manage')>0" tal:content="structure python:zmscontext.pageelement_TeaserElement(zmscontext,request)">
		The teaser-element
	</tal:block >
</tal:block>

<!-- /ZMSTeaserElement.standard_html -->]]>
                  </item>
                  <item key="id"><![CDATA[standard_html]]></item>
                  <item key="name"><![CDATA[Template: ZMSTeaserElement]]></item>
                  <item key="type"><![CDATA[zpt]]></item>
                </dictionary>
              </item>
            </list>
          </item>
          <item key="access" type="dictionary">
            <dictionary>
              <item key="delete_custom"></item>
              <item key="delete_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
              <item key="insert_custom"><![CDATA[{$}]]></item>
              <item key="insert_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
            </dictionary>
          </item>
          <item key="enabled" type="int">1</item>
          <item key="id"><![CDATA[ZMSTeaserElement]]></item>
          <item key="name"><![CDATA[ZMSTeaserElement]]></item>
          <item key="package"><![CDATA[com.zms.foundation]]></item>
          <item key="revision"><![CDATA[3.1.0]]></item>
          <item key="type"><![CDATA[ZMSTeaserElement]]></item>
        </dictionary>
      </item>
    </dictionary>
  </item>
  <item type="dictionary">
    <dictionary>
      <item key="key"><![CDATA[ZMSTextarea]]></item>
      <item key="value" type="dictionary">
        <dictionary>
          <item key="__obj_attrs__" type="list">
            <list>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[icon-align-left]]></item>
                  <item key="id"><![CDATA[icon_clazz]]></item>
                  <item key="name"><![CDATA[Icon (Class)]]></item>
                  <item key="type"><![CDATA[constant]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<tal:block tal:define="
	zmscontext options/zmscontext;
	dummy0 python:request.set('CKEDITOR_config_removeButtons','JustifyLeft,JustifyCenter,JustifyRight')">
<script type="text/javascript">

$(function(){
	$('#text_'+getZMILang()).parent('form').submit(function() {
			var b = true;
			if (self.btnClicked != getZMILangStr('BTN_CANCEL') &&
					self.btnClicked != getZMILangStr('BTN_BACK')) {
				var txt = '<'+'xml>'+$('#text_'+getZMILang()).val().replace('&','')+'<'+'/xml>';
				if ( txt.indexOf( '<'+'dtml-') < 0) {
					try {
						var xmlString = txt.replace(/\&(\w*)\;/g,'');
						if (window.DOMParser) {
							var parser=new DOMParser();
							var doc=parser.parseFromString(xmlString,"text/xml");
							if ( doc.childNodes[0].nodeName == 'parsererror') {
								b = confirm(getZMILangStr('CAPTION_WARNING')+'\n'+doc.childNodes[0].childNodes[0].nodeValue+'\n'+getZMILangStr('MSG_CHANGE_ANYWAY')+'\n');
							}
						} else if (window.ActiveXObject) {
							var xmlDoc=new ActiveXObject("Microsoft.XMLDOM");
							xmlDoc.async="false";
							xmlDoc.loadXML(xmlString);
							if ( xmlDoc.childNodes.length == 0) {
								b = confirm(getZMILangStr('CAPTION_WARNING')+'\n'+'Invalid (X)HTML!\n'+getZMILangStr('MSG_CHANGE_ANYWAY')+'\n');
							}
						}
					}
					catch(e) {
						alert(e.message);
					}
				}
			}
			return b;
		});
	});

</script>
</tal:block>]]>
                  </item>
                  <item key="id"><![CDATA[interface0]]></item>
                  <item key="name"><![CDATA[interface0]]></item>
                  <item key="type"><![CDATA[interface]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="default"><![CDATA[##
return context.getTextFormatDefault()]]>
                  </item>
                  <item key="id"><![CDATA[format]]></item>
                  <item key="mandatory" type="int">1</item>
                  <item key="name"><![CDATA[Format]]></item>
                  <item key="type"><![CDATA[string]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="id"><![CDATA[text]]></item>
                  <item key="multilang" type="int">1</item>
                  <item key="name"><![CDATA[Text]]></item>
                  <item key="type"><![CDATA[richtext]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[## Script (Python) "ZMSTextarea.check_constraints"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext=None,options=None
##title=py: Hook: check constraints
##
# --// check_constraints //--

constraints = {}
request = zmscontext.REQUEST
obj_attr = zmscontext.getObjAttr('text')
text = zmscontext.getObjAttrValue(obj_attr,request)
if text.startswith('##') or text.find('<dtml-')>=0 or text.find('<tal:')>=0:
  constraints['RESTRICTIONS'] = constraints.get('RESTRICTIONS',[])
  constraints['RESTRICTIONS'].append(('restricted-access','text contains executable-code (py, tal, dtml)',['ZMS Administrator']))
return constraints

# --// /check_constraints //--
]]>
                  </item>
                  <item key="id"><![CDATA[check_constraints]]></item>
                  <item key="name"><![CDATA[Hook: check constraints]]></item>
                  <item key="type"><![CDATA[py]]></item>
                </dictionary>
              </item>
              <item type="dictionary">
                <dictionary>
                  <item key="custom"><![CDATA[<!-- ZMSTextarea.standard_html -->

<tal:block tal:define="global 
		zmscontext options/zmscontext;
		text          python:unicode(zmscontext.getText(request),'utf-8');
		format        python:unicode(zmscontext.attr('format'),'utf-8');
		renderedText  python:zmscontext.renderText(format,'text',text,request,zmscontext.id)"
		tal:content="structure renderedText">
	The text
</tal:block>

<!-- /ZMSTextarea.standard_html -->]]>
                  </item>
                  <item key="id"><![CDATA[standard_html]]></item>
                  <item key="name"><![CDATA[Template: ZMSTextarwa]]></item>
                  <item key="type"><![CDATA[zpt]]></item>
                </dictionary>
              </item>
            </list>
          </item>
          <item key="access" type="dictionary">
            <dictionary>
              <item key="delete_custom"></item>
              <item key="delete_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
              <item key="insert_custom"><![CDATA[{$}]]></item>
              <item key="insert_deny" type="list">
                <list>
                  <item></item>
                  <item></item>
                  <item></item>
                </list>
              </item>
            </dictionary>
          </item>
          <item key="enabled" type="int">1</item>
          <item key="id"><![CDATA[ZMSTextarea]]></item>
          <item key="name"><![CDATA[ZMSTextarea]]></item>
          <item key="package"><![CDATA[com.zms.foundation]]></item>
          <item key="revision"><![CDATA[3.1.1]]></item>
          <item key="type"><![CDATA[ZMSObject]]></item>
        </dictionary>
      </item>
    </dictionary>
  </item>
  <item type="dictionary">
    <dictionary>
      <item key="key"><![CDATA[com.zms.foundation]]></item>
      <item key="value" type="dictionary">
        <dictionary>
          <item key="__obj_attrs__" type="list">
            <list>
            </list>
          </item>
          <item key="access" type="dictionary">
            <dictionary>
              <item key="delete_custom"></item>
              <item key="delete_deny" type="list">
                <list>
                </list>
              </item>
              <item key="insert_custom"></item>
              <item key="insert_deny" type="list">
                <list>
                </list>
              </item>
            </dictionary>
          </item>
          <item key="enabled" type="int">0</item>
          <item key="id"><![CDATA[com.zms.foundation]]></item>
          <item key="name"><![CDATA[com.zms.foundation]]></item>
          <item key="package"></item>
          <item key="revision"><![CDATA[3.3.9]]></item>
          <item key="type"><![CDATA[ZMSPackage]]></item>
        </dictionary>
      </item>
    </dictionary>
  </item>
</list>