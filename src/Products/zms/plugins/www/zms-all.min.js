
$.plugins=$.plugins||{};$.plugins.cache=window.sessionStorage||{};$.plugins.settings={cache:true,ajax:{cache:true},context:$(document),target:$('head',this.context),init:function(){},preLoad:function(){},postLoad:function(){}
};var defaults=$.plugins.settings,cache=$.plugins.cache;Plugin=function(name,settings){var that=this;this.name=name;for(var i in settings){that[i]=settings[i]};this.context=this.context||settings.context;this.target=this.target||settings.target;this.loaded={};this.queue=[];this.tmp_callback=[];this.init.apply(this);return this};Plugin.prototype.getFile=function(url){if(!url||typeof url !='string'){throw new Error('$.plugin.getFile(url)-url {String} must be specified')}
var that=this,extension=url.split('.')[url.split('.').length-1],fileId=url.replace(/\W/gi,''),cached=cache[url],caching=(defaults.cache===true||defaults.cache=='true');if(extension.indexOf('?')>0){extension=extension.substring(0,extension.indexOf('?'))}
if(extension !='css'&&extension !='js'){throw new Error('$.plugin.getFile(url)-Invalid extension:'+extension+'\n\t'+url);return this}
if(caching&&this.loaded[url]){return this}
this.beforeGet(url);$('[data-file-id="'+fileId+'"]').remove();if(caching&&cached&&cached !='undefined'){if(extension=='css'){var base_url=url.substring(0,url.lastIndexOf('/')+1);this.target.append('<style type="text\/css" rel="stylesheet" data-file-id="'+fileId+'">'+cached+'<\/style>')}
else if(extension=='js'){this.target.append('<script type="text\/javascript" async="true" data-file-id="'+fileId+'">'+cached+'<\/script>')}
setTimeout(function(){that.afterGet(url)},1)} else {if(extension=='css'){$.get(url,function(response){var base_url=url.substring(0,url.lastIndexOf('/')+1);response=response.replace(/url\(\'/g,'url(\''+base_url);response=response.replace(/AlphaImageLoader\(src\=\'/g,'AlphaImageLoader(src=\''+base_url);that.loaded[url]=true;cache[url]=response;that.target.append('<style type="text\/css" rel="stylesheet" data-file-id="'+fileId+'">'+response+'<\/style>');that.afterGet(url)})}
else if(extension=='js'){(function(){var opts=$.extend({dataType:"script",url:url},defaults.ajax),onSuccess=opts.success||function(){};opts.success=function(){onSuccess.apply(this,arguments);var response=(typeof arguments[0]=='string')? arguments[0]:null;cache[url]=response;that.loaded[url]=true;that.afterGet(url)};$.ajax(opts)})()}}
return this};Plugin.prototype.beforeGet=function(url){this.queue.push(url);defaults.preLoad.call(this,url);return this};Plugin.prototype.afterGet=function(url){var that=this,index=$.inArray(url,this.queue);if(index==-1){throw new Error('$.plugin.afterGet(url)-Ignoring postLoad for file that should not be in queue:\n '+url);return this}
this.queue.splice(index,1);if(this.queue.length==0){this.run()}
defaults.postLoad.call(this,url);return this};Plugin.prototype.run=function(){var that=this;for(var i=0;i<this.tmp_callback.length;i++){(function(){var callback=that.tmp_callback[i];setTimeout(function(){callback.apply(that)},1)})()}
this.tmp_callback=[]}
Plugin.prototype.set=function(settings){var that=this;for(var key in settings){that[key]=settings[key]}}
Plugin.prototype.get=function(){var that=this,files=(typeof this.files=='string')? [this.files]:this.files,callback=arguments[1]||this.callback;this.selectors=arguments[0]||this.selectors;if(this.isNeeded()!==true){return this}
this.tmp_callback.push(callback);this.files=[];if(files.length==this.queue.length){if(this.queue.length==0){this.run()}
return this}
var getFile=function(file){that.getFile(file)};var that=this;for(var i=0;i<files.length;i++){(function(){var file=files[i];getFile(file)})()}
return this};Plugin.prototype.isNeeded=function(){var that=this,selectors=(typeof this.selectors=='string')? [this.selectors]:this.selectors,isNeeded;for(var i=0;i<selectors.length;i++){var selector=selectors[i];if($(selector,that.context).length > 0){isNeeded=true;break}
};return isNeeded||this};$.extend($,{plugin:function(name,param){var self=$.plugin;if(arguments.length==0){for(var i in $.plugins){if(i=='settings'||i=='cache'){continue} $.plugins[i].get()};return self}
else if(typeof name !='string'){throw new Error('$.plugin(name,[settings||callback])\n\t\t@param name\t\t{String}\n\t\t@param settings\t{Object}\n\t\t@param callback\t{Function}');return self}
if(typeof param=='object'&&typeof $.plugins[name]=='undefined'){var plugin=$.plugins[name];if(typeof plugin !='object'){$.plugins[name]=new Plugin(name,$.extend(defaults,param))}}
else {var plugin=$.plugins[name];if(typeof plugin !='object'){throw new Error('$.plugin:'+name+' is not specified');return self}
if(typeof param=='function'){plugin.get(param)}
else if(!param){return plugin}}
return self},getPlugin:function(){return $.plugin.apply(this,arguments)}
});
function pluginLanguage(){return getZMILangStr('LOCALE',{'nocache':""+new Date()})}
function zmiAutocomplete(s,o){pluginAutocomplete(s,function(){try {var prev_el=$(s).autocomplete(o).prev()[0];if($(prev_el).attr('class')!='input-group-prepend'){$(s).autocomplete(o).before('<div class="input-group-prepend"><span class="input-group-text"><i class="fas fa-search"></i></span></div>');$(s).closest('.col-sm-10,td,.col-sm-9.col-md-10').wrapInner('<div class="input-group"></div>')}
} catch(error){console.error(error);$(s).autocomplete(o).before('<div class="input-group-prepend"><span class="input-group-text"><i class="fas fa-search"></i></span></div>');$(s).closest('.col-sm-10,td,.col-sm-9.col-md-10').wrapInner('<div class="input-group"></div>')}
})}
function pluginFancybox(s,c){$.plugin('zmslightbox',{files:['/++resource++zms_/jquery/zmslightbox/zmslightbox.js','/++resource++zms_/jquery/zmslightbox/zmslightbox.css']
});$.plugin('zmslightbox').get(s,c)}
function showFancybox($sender){pluginFancybox('body',function(){show_zmslightbox($sender)});return false}
function pluginAutocomplete(s,c){$.plugin('autocomplete',{files:['/++resource++zms_/jquery/autocomplete/jquery.autocomplete.min.js','/++resource++zms_/jquery/autocomplete/jquery.autocomplete.css']
});$.plugin('autocomplete').get(s,c)}
function pluginSortable(s,c){$.plugin('sortable',{files:['/++resource++zms_/jquery/sortable/html5sortable.min.js','/++resource++zms_/jquery/sortable/html5sortable.css']
});$.plugin('sortable').get(s,c)}
function runPluginCropper(c){$.plugin('cropper',{files:[
'/++resource++zms_/jquery/cropper/cropper.css','/++resource++zms_/jquery/cropper/cropper.min.js','/++resource++zms_/jquery/cropper/jquery-cropper.min.js'
]
});$.plugin('cropper').get('body',c)}String.prototype.removeWhiteSpaces=function(){return(this.replace(/\s+/g,""))};String.prototype.leftTrim=function(){return(this.replace(/^\s+/,""))};String.prototype.rightTrim=function(){return(this.replace(/\s+$/,""))};String.prototype.basicTrim=function(){return(this.replace(/\s+$/,"").replace(/^\s+/,""))};String.prototype.superTrim=function(){return(this.replace(/\s+/g," ").replace(/\s+$/,"").replace(/^\s+/,""))};String.prototype.startsWith=function(str){return(this.match("^"+str)==str)};String.prototype.endsWith=function(str){return(this.match(str+"$")==str)};Array.prototype.indexOf=function(obj){var i,idx=-1;for(i=0;i<this.length;i++){if(this[i]==obj){idx=i;break}}return idx};Array.prototype.lastIndexOf=function(obj){this.reverse();var i,idx=-1;for(i=0;i<this.length;i++){if(this[i]==obj){idx=(this.length-1-i);break}}this.reverse();return idx};Array.prototype.contains=function(obj){var i,listed=false;for(i=0;i<this.length;i++){if(this[i]==obj){listed=true;break}}return listed};ZMI.prototype.get_document_element_url=function(url){let i;if(url.indexOf('/content')>=0){i=url.indexOf('/content')+'/content'.length}
else if(url.indexOf('://')>=0){i=url.indexOf('://')+'://'.length;i=i+url.substring(i).indexOf('/')}
return url.substring(0,i)}
ZMI.prototype.get_rest_api_url=function(url){const document_element_url=this.get_document_element_url(url);const i=document_element_url.length;return document_element_url+'/++rest_api'+url.substring(i)}
ZMI.prototype.parseURLParams=function(url){var qd={};var search=url.indexOf("?")>0?url.substring(url.indexOf("?")):"?";search.substring(1).split("&").forEach(function(item){var s=item.split("="),k=s[0],v=s[1]&&decodeURIComponent(s[1]);(qd[k]=qd[k]||[]).push(v)});return qd}
var zmiParams;$ZMI.registerReady(function(){zmiParams={};var href=self.location.href;var base_url=href;var delimiter_list=['?','#'];for(var h=0;h < delimiter_list.length;h++){var delimiter=delimiter_list[h];var i=base_url.indexOf(delimiter);if(i > 0){base_url=base_url.substring(0,i)}
var i=href.indexOf(delimiter);if(i > 0){var query_string=href.substring(i+1);if(h < delimiter_list.length-1){i=query_string.indexOf(delimiter_list[h+1]);if(i > 0){query_string=query_string.substring(0,i)}}
var l=query_string.split('&');for(var j=0;j < l.length;j++){i=l[j].indexOf('=');if(i < 0){break}
if(typeof zmiParams[l[j].substring(0,i)]=="undefined"){zmiParams[l[j].substring(0,i)]=unescape(l[j].substring(i+1))}}
}}
let is_manage_ui=self.location.href.indexOf('/manage')> 0;let is_preview_ui=self.location.href.indexOf('preview=preview')> 0;if(is_manage_ui||is_preview_ui){if(!document.getElementById('zmi_highlight_css')){let hilight_css=`
<style type="text/css" id="zmi_highlight_css">
body:not(.zmi).contentEditable.zmi-highlight:hover {cursor:pointer;background:unset !important;box-shadow:0 0 0 1px #07aee9}
body:not(.zmi).contentEditable.zmi-highlight:hover > * {transform:unset !important}
body:not(.zmi).contentEditable.zmi-highlight:hover:before {content:"+";font:normal 1rem Arial,sans-serif;color:white;text-align:center;line-height:1;width:1rem;height:1rem;margin:0;background-color:#07aee9;display:block;position:absolute;padding-right:1px;z-index:10}
</style>`;$('head').append(hilight_css)}
var page=$('.zms-page');var page_href=page.attr("data-absolute-url");var page_container_constructed=false;if(page.closest('article').length > 0){page.closest('article').wrapInner('<div class="contentEditable zms-page" data-absolute-url="'+page_href+'"></div>');page_container_constructed=true} else if(page.closest('.article').length > 0){page.closest('.article').wrapInner('<div class="contentEditable zms-page" data-absolute-url="'+page_href+'"></div>');page_container_constructed=true} else {const firstSibling=page.siblings().first();if(firstSibling.length==1&&!firstSibling.hasClass('portalClientId')){firstSibling.wrapInner('<div class="contentEditable zms-page" data-absolute-url="'+page_href+'"></div>');page_container_constructed=true}}
if(is_preview_ui){if(page_container_constructed==false){console.log('Page-Container Not Found:Please Add article-Element or .article-Class to the HTML-Element that is Nesting the Page Content')} else {console.log('Page=1st Sibling of Content Container;maybe use article-Element or .article-Class to mark the Content Container')}}
$('.contentEditable').mouseover(function(evt){evt.stopPropagation();$(this).addClass('zmi-highlight')}).mouseout(function(evt){$(this).removeClass('zmi-highlight')}).click(function(evt){evt.stopPropagation();if(evt.target !="undefined"&&$.inArray(evt.target.nodeName.toLowerCase(),['a','button','input','select','textarea'])>-1){return}
var href=$(this).attr("data-absolute-url");var lang=getZMILang();if(self.location.href.indexOf(href+'/manage_main')>=0||evt.shiftKey==true){href+='/manage_properties'}
else {href+='/manage_main'}
if(self.location.href.indexOf('/manage_translate')>0){href+='_iframe';href+='?lang='+lang;href+='&ZMS_NO_BODY=1';$ZMI.iframe(href,{},{})}
else if(self.location.href.indexOf('/manage')>0){href+='?lang='+lang;self.location.href=href}
else {href+='?lang='+lang+'&preview=contentEditable';window.top.location.href=href}
}).attr("title","Click to Edit!\nShift+Click to Properties Menu")}
if(typeof zmiParams['ZMS_HIGHLIGHT'] !='undefined'&&typeof zmiParams[zmiParams['ZMS_HIGHLIGHT']] !='undefined'){$.plugin('zmi_highlight',{files:['/++resource++zms_/jquery/plugin/jquery.plugin.zmi_highlight.js']
});$.plugin('zmi_highlight').get('body',function(){})}
});ZMI.prototype.getPhysicalPath=function(){var physical_path=$('meta[name="physical_path"]').attr('content');if(typeof physical_path=='undefined'){physical_path=window.location.href}
return physical_path}
ZMI.prototype.icon=function(name,extra){var tag='i';var icon='<'+tag+' class="'+this.icon_clazz(name)+'"';if(typeof extra !="undefined"){icon+=' '+extra}
icon+='></'+tag+'>';return icon}
ZMI.prototype.icon_clazz=function(name){return name.replace(/icon-/,'fas fa-')}
ZMI.prototype.icon_selector=function(name){var tag='i';if(typeof name=="undefined"){return tag
}
return tag+'.'+this.icon_clazz(name).replace(/\s/gi,'.')}
var zmiCursor=[];ZMI.prototype.setCursorWait=function(s){if(zmiCursor.length==0){$("body").css("cursor","wait")}
zmiCursor.push(s);console.log("setCursorWait["+zmiCursor.length+"]:"+s)}
ZMI.prototype.setCursorAuto=function(){zmiCursor.pop();if(zmiCursor.length==0){$("body").css("cursor","auto")}}
function getZMILang(){if(typeof zmiParams['lang']=='undefined'){if(typeof zmiLangStr !="undefined"){zmiParams['lang']=zmiLangStr['lang']}
if(typeof zmiParams['lang']=='undefined'){zmiParams['lang']='eng'}}
return zmiParams['lang']}
function getZMILangStr(key,data){var langStr=$ZMI.getLangStr(key);if(typeof langStr=="undefined"){if(typeof zmiLangStr!="undefined"){langStr=zmiLangStr[key]}
if(typeof langStr=='undefined'){langStr=key
}}
return langStr}
ZMI.prototype.getLangStr=function(key,lang){var k="get_lang_dict";var v=this.getCachedValue(k);if(typeof v=="undefined"){var url=this.getBaseUrl();v=$.ajax({url:url+'/get_lang_dict',async:false
}).responseJSON;this.setCachedValue(k,v)};if(typeof lang=="undefined"){lang=getZMILang()};var langStr;if(typeof v[key]!="undefined"){langStr=v[key][lang]};return langStr}
function getRefLang(elem){if(typeof elem !="undefined"&&$(elem).closest('.input-group').length > 0){let attr_ref=$(elem).closest('.input-group').children().first().val();let match=attr_ref.match(/lang=([a-zA-Z]+)/);let lang=match ? match[1]:null;return lang} else {return null}}
ZMI.prototype.getCachedValue=function(k){var v=localStorage["zmiCache["+k+"]"];return(typeof v=='undefined'||v=='undefined')? v:JSON.parse(v)}
ZMI.prototype.setCachedValue=function(k,v){localStorage.setItem("zmiCache["+k+"]",JSON.stringify(v));return v}
ZMI.prototype.getReqProperty=function(key,defaultValue){var data={};data['key']=key;if(typeof defaultValue !="undefined"){data['default']=defaultValue};var url=this.getPhysicalPath();if(url.indexOf('/content/')>0||url.slice(-8)=='/content'){url=url.substring(0,url.indexOf('/content')+'/content'.length)} else {url=''};var r=$.ajax({url:url+'/getReqProperty',data:data,datatype:'text',async:false
}).responseText;return r}
ZMI.prototype.getBaseUrl=function(key,defaultValue){var url=this.getPhysicalPath();if(url.indexOf('/content/')>0||url.slice(-8)=='/content'){url=url.substring(0,url.indexOf('/content')+'/content'.length)} else {url=''};return url}
ZMI.prototype.getConfProperty=function(key,defaultValue){var r=this.getCachedValue(key);if(typeof r=="undefined"){var data={};data['key']=btoa(key);if(typeof defaultValue !="undefined"){data['default']=defaultValue};var url=this.getBaseUrl();var r=$.ajax({url:url+'/getConfProperty',data:data,datatype:'text',headers:{'Cache-Control':'max-age=1800','X-Accel-Expires':1800},async:false
}).responseText;this.setCachedValue(key,r)}
return r}
ZMI.prototype.getConfProperties=function(prefix){var r=this.getCachedValue(prefix);if(typeof r=="undefined"){var data={};data['prefix']=btoa(prefix);var url=this.getBaseUrl();var r=$.ajax({url:url+'/getConfProperties',data:data,datatype:'text',async:false
}).responseText;this.setCachedValue(prefix,r)}
return eval("("+r+")")}
ZMI.prototype.display_icon=function(meta_type){var k="display_icon."+meta_type;var v=this.getCachedValue(k);if(typeof v=="undefined"){var data={}
data['meta_type']=meta_type;var url=this.getPhysicalPath();if(url.indexOf('/content/')>0||url.slice(-8)=='/content'){url=url.substring(0,url.indexOf('/content')+'/content'.length)} else {url=''}
v=$.ajax({url:url+'/display_icon',data:data,datatype:'text',async:false
}).responseText}
return this.setCachedValue(k,v)}
ZMI.prototype.HTMLDecode=function(str){var char_names={'Auml':'\u00C4','Ouml':'\u00D6','Uuml':'\u00DC','auml':'\u00E4','ouml':'\u00F6','uuml':'\u00FC','szlig':'\u00DF'
};for(var char_name in char_names){var char_code=char_names[char_name].toString(16);var re=new RegExp("&"+char_name+";","g");str=str.replace(re,char_code)}
return str}
ZMI.prototype.CopyToClipboard=function(str){var $temp=$("<textarea></textarea>");$("body").append($temp);try {$temp.val(str).select();document.execCommand("copy")} catch(e){}
$temp.remove()}
ZMI.prototype.show_spinner=function(elem){let alert=document.querySelector('#zmi_manage_tabs_message > div');if(alert)alert.style.opacity=.3;elem.title=elem.textContent;let w=elem.clientWidth+2;elem.innerHTML=`<i class="fas fa-spinner fa-spin" title="${getZMILangStr('MSG_LOADING')}" ></i>`;elem.style.width=`${w}px`}
ZMI.prototype.reset_spinner=function(elem){elem.innerHTML=elem.title;elem.removeAttribute('style');elem.blur()}
if(typeof $ !="undefined"){$ZMI.runReady()}
ZMI.prototype.forceChangePassword=function(){$("a#manage_userForm").click();$(".modal-header .close").hide()}
ZMI.prototype.getCoords=function(theElement,thePosition){var coords={x:0,y:0};var element=theElement;while(element){if(thePosition=="relative"&&$(element).css("position")=="absolute"){break}
coords.x+=element.offsetLeft;coords.y+=element.offsetTop;element=element.offsetParent}
return coords}
ZMI.prototype.getDescendantLanguages=function(){var base=self.location.href;if(base.indexOf('?')> 0){base=base.substring(0,base.indexOf('?'))}
base=base.substring(0,base.lastIndexOf('/'));var response=$.ajax({url:base+'/getDescendantLanguages',data:{id:getZMILang()},datatype:'text',async:false
}).responseText;var langs=eval('('+response+')');if(langs.length > 1){var labels='';for(var i=0;i < langs.length;i++){if(labels.length>0){labels+=','}
labels+=$.ajax({url:'getLanguageLabel',data:{id:langs[i]},datatype:'text',async:false
}).responseText}
return ' '+getZMILangStr('MSG_CONFIRM_DESCENDANT_LANGS').replace("%s",langs)}
return ''}
ZMI.prototype.getServerUrl=function(url){if(url.startsWith("/")||url.startsWith(".")){return ""}
var protocol=url;protocol=protocol.substring(0,protocol.indexOf(":")+3);var server_url=url;server_url=server_url.substring(protocol.length);server_url=protocol+server_url.substring(0,server_url.indexOf("/"));return server_url}
ZMI.prototype.relativateUrl=function(url,anchor,page_abs_url){if(typeof page_abs_url=="undefined"){page_abs_url=$('meta[name="version_container_abs_url"]').attr('content')}
var server_url=$ZMI.getServerUrl(url);var page_server_url=$ZMI.getServerUrl(page_abs_url);if(server_url.length > 0&&page_server_url.length > 0&&server_url !=page_server_url){return url}
var currntPath=page_abs_url.substring(page_server_url.length);var targetPath=url.substring(server_url.length);while(currntPath.length > 0&&targetPath.length > 0){var i=currntPath.indexOf('/');var j=targetPath.indexOf('/');if(i < 0){currntElmnt=currntPath}
else {currntElmnt=currntPath.substring(0,i)}
if(j < 0){targetElmnt=targetPath}
else {targetElmnt=targetPath.substring(0,j)}
if(currntElmnt !=targetElmnt){break}
if(i < 0){currntPath=''}
else {currntPath=currntPath.substring(i+1)}
if(j < 0){targetPath=''}
else {targetPath=targetPath.substring(j+1)}}
while(currntPath.length > 0){var i=currntPath.indexOf('/');if(i < 0){currntElmnt=currntPath;currntPath=''}
else {currntElmnt=currntPath.substring(0,i);currntPath=currntPath.substring(i+1)}
targetPath='../'+targetPath}
if(!targetPath.startsWith('/')){url='./'+targetPath}
if(typeof anchor !='undefined'){url+=anchor}
return url}
ZMI.prototype.relativateUrls=function(html,page_abs_url){if(typeof page_abs_url=="undefined"){page_abs_url=$('meta[name="version_container_abs_url"]').attr('content')}
var splitTags=['href="','src="'];for(var h=0;h < splitTags.length;h++){var splitTag=splitTags[h];var vSplit=html.split(splitTag);var v=vSplit[0];for(var i=1;i < vSplit.length;i++){var j=vSplit[i].indexOf('"');var url=vSplit[i].substring(0,j);if(url.indexOf("://")<0&&!url.startsWith("./")){url=this.relativateUrl(url,'',page_abs_url)}
v+=splitTag+url+vSplit[i].substring(j)}
html=v}
return html};$ZMI.registerReady(function(){$ZMI.setCursorWait("BO bootstrap.plugin.zmi");var manage_menu=typeof window.parent.frames!="undefined"&&typeof window.parent.frames.manage_menu!="undefined";$("body").each(function(){var data_root=$(this).attr('data-root');var data_path=$(this).attr('data-path');if(typeof data_root !="undefined"&&typeof data_path !="undefined"){if(manage_menu){$("#zmi-tab .breadcrumb").each(function(){if($(".btn-bookmark",this).length==0){$(this).append('<li class="btn-bookmark"><a href="javascript:;" title="Set Bookmark" class="align-text-top"><i class="far fa-bookmark text-muted"></a><li>')};var key="ZMS."+data_root+".bookmarks";var bookmarks=$ZMILocalStorageAPI.get(key,[]);$("a:last",this).click(function(){var index=bookmarks.indexOf(data_path);if(index >=0){bookmarks.splice(index,1);$('.fa-bookmark',this).removeClass("fas").addClass("far")}
else {bookmarks.push(data_path);$('.fa-bookmark',this).removeClass("far").addClass("fas")}
$ZMILocalStorageAPI.replace(key,bookmarks);var frames=window.parent.frames;try {for(var i=0;i < frames.length;i++){if(frames[i] !=window&&typeof frames[i].zmiBookmarksChanged=="function"){frames[i].zmiBookmarksChanged()}}
} catch(e){}
});var index=bookmarks.indexOf(data_path);if(index >=0){$('.fa-bookmark',this).removeClass("far").addClass("fas text-primary")} else {$('.fa-bookmark',this).removeClass("fas text-primary").addClass("far text-muted")}
})}
var key="ZMS."+data_root+".history";var history=$ZMILocalStorageAPI.get(key,[]);var index=history.indexOf(data_path);if(index >=0){history.splice(index,1)}
history.splice(0,0,data_path);while(history.length > 10){history.splice(history.length-1,1)}
$ZMILocalStorageAPI.replace(key,history);var frames=window.parent.frames;try {for(var i=0;i < frames.length;i++){if(frames[i] !=window&&typeof frames[i].zmiHistoryChanged=="function"){frames[i].zmiHistoryChanged()}}
} catch(e){}}
});var $change_dt=$(".zmi-change-dt,.zmi-created-dt");if($change_dt.length > 0){var fn=function(){$change_dt.each(function(){var $el=$(this);var mydate=$el.attr("title");if(typeof mydate!="undefined"){var myformat=getZMILangStr('DATETIME_FMT');var dtsplit=mydate.split(/[\/ .:]/);var dfsplit=myformat.split(/[\/ .:]/);df=new Array();for(dc=0;dc<dtsplit.length;dc++){df[dfsplit[dc]]=dtsplit[dc];df[dfsplit[dc].substring(1)]=parseInt(dtsplit[dc])}
var dstring=df['%Y']+'-'+df['%m']+'-'+df['%d']+' '+df['%H']+':'+df['%M']+':'+df['%S'];var date=new Date(df['Y'],df['m']-1,df['d']);var now=new Date();now.setHours(0,0,0);var daysBetween=(now.valueOf()-date.valueOf())/(24*60*60*1000);if(daysBetween<1){date=new Date(df['Y'],df['m']-1,df['d'],df['H'],df['M'],df['S']);now=new Date();var secondsBetween=(now.valueOf()-date.valueOf())/(1000);var minutesBetween=secondsBetween/(60);$(this).attr("data-mydate",getZMILangStr('TODAY')+" "+(minutesBetween<60?Math.floor(minutesBetween)+" min. ":df['%H']+':'+df['%M']))}
else if(daysBetween<2){$(this).attr("data-mydate",getZMILangStr('YESTERDAY')+" "+df['%H']+':'+df['%M'])}
else {$(this).attr("data-mydate",getZMILangStr('DATE_FMT').replace('%Y',df['%Y']).replace('%m',df['%m']).replace('%d',df['%d']))}}
else {$(this).attr("data-mydate",mydate)}
});setTimeout(fn,10000)};fn()}
$('a#navbar-sitemap').each(function(){var $a=$(this);if(self.window.parent.frames.length > 1&&typeof self.window.parent !="undefined"&&typeof self.window.parent.frames.manage_menu !="undefined"){$a.attr('target','_top')}
else {$a.attr('href',$a.attr('href')+'&dtpref_sitemap=1')}
});if(manage_menu){$('.zmi header a.toggle-lang').each(function(){var $a=$(this);$a.attr('target','_top');$a.attr('href','manage?lang='+$a.attr('data-language')+'&dtpref_sitemap=1'+'&came_from='+$a.attr('href'))})}
$(".help").each(function(){$(this).hide();var data_for=$(this).attr("data-for");$("label[for="+data_for+"],label[for="+data_for+"_"+getZMILang()+"]").each(function(){$(this).append('<i class="fas fa-info-circle text-info ml-1" title="'+getZMILangStr('TAB_HELP')+'..." onclick="var evt=arguments[0]||window.event;evt.stopPropagation();zmiModal(\'div.help[data-for='+data_for+']\',{title:\''+getZMILangStr('TAB_HELP')+':'+$(this).text().trim()+'\'})"></i>')})});$('[data-toggle="tooltip"]').tooltip();$('.zmi .main-nav li.active a').click(function(event){if($(window).width()< 767){event.preventDefault();$('.zmi .main-nav li:not(.active)').toggle();return false}
});if($('.object_has_titleimage')){$('.object_has_titleimage i.preview_on_hover').each(function(){var media_url=$(this).data('preview_url');if(media_url.search('.mp4')>-1){var this_container=$(this).closest('.zmi-manage-main-change');var media_html='<video autoplay="" autostart="" loop="" playsinline="" muted="" preload="auto"><source src="'+media_url+'"></video>';$(this).on('mouseout',function(){$('video',this_container).remove()}).on('mouseover',function(){if($('video',this_container).length==0){this_container.append(media_html)}
})}})};$(".collapse.filters").each(function(){var $body=$(this);var f=function(){var $hidden=$(".form-group.d-none",$body);var $other=$hidden.prevAll(".form-group");var $selects=$("select[name^='filterattr']",$other);var i=0;var c=0;$selects.each(function(){i++;if($(this).val()==''){if(i<$selects.length){$(this).parents(".form-group").remove()}
c++}
});if(c==0){var $cloned=$hidden.clone(true);$cloned.insertBefore($hidden).removeClass("d-none")}
var qfilters=0;var d={}
$("*[name^='filter']",$body).each(function(){var nodeName=this.nodeName.toLowerCase();if(nodeName=='input'||nodeName=='select'){var name=$(this).attr("name").replace(/\d/gi,'');if(typeof d[name]=="undefined"){d[name]=0}
$(this).attr("name",name+d[name]);qfilters=d[name];d[name]++}
});$("input#qfilters").val(qfilters)};$("select[name^=filterattr]",$body).each(function(){var that=this;$(that).click(f).keyup(f)});f()});var filter_timeout=null;$('table.table.table-striped.table-bordered.table-hover.zmi-sortable.zmi-selectable input.form-control:text').keyup(function(e){var that=this;if($(that).hasClass("form-disabled")){return false}
var f=function(){$(that).addClass("form-disabled");var form=that.form;form.action=self.location.href;form.submit()}
clearTimeout(filter_timeout);switch(e.keyCode){case 13:f();return false;default:filter_timeout=setTimeout(f,500);return true}
});$('div.single-line').each(function(){var $single_line=$(this);var $textarea=$('textarea',this);$textarea.prop({rows:1,wrap:'off'});if($single_line.hasClass("zmi-code")){$('textarea',$single_line).on('focus',function(){if(!$(this).hasClass('open-zmi-code')&&!($(this).val()=='')){$(this).addClass('open-zmi-code').removeClass('alert-warning').css('height','auto').animate({height:$(this).prop('scrollHeight')+'px'},600);if($(this).attr('data-dblclickhandler')){$(this).dblclick(function(e){var seltxt=window.getSelection().toString();if(seltxt.length==0||/\s/.test(seltxt)){$('.zmi-code-close',$single_line).remove();$('textarea',$single_line).animate({height:'30px'},0).css('height','auto').removeClass('open-zmi-code').addClass('alert-warning').blur();eval($(this).attr('data-dblclickhandler'))}})}
var close_btn='<i title="Close Editing" class="zmi-code-close fas fa-chevron-up text-primary text-center" style="cursor:pointer;margin:0 0 0 calc(50%);"></i>';$single_line.append(close_btn);$('.zmi-code-close',$single_line).click(function(){$('textarea',$single_line).animate({height:'30px'},600).css('height','auto').removeClass('open-zmi-code');$(this).remove()})}
});return}
if($single_line.hasClass("zmi-nodes")){$textarea.prop({title:getZMILangStr('ATTR_NODE')})}
if($(".input-group-append",this).length==0){$(this).addClass("input-group");if($textarea.prev('i').length==1){$textarea.prev('i').wrap('<div class="input-group-prepend"><span class="btn btn-secondary btn-sm"></span></div>')}
if($textarea.attr('data-style')){$(this).append('<div class="input-group-append"><a href="javascript:;" class="btn btn-secondary btn-sm" title="Click for Code Popup or Dbl-Click for Native Editor!" style="'+$textarea.attr('data-style')+'"></a></div>')} else {$(this).append('<div class="input-group-append"><a href="javascript:;" class="btn btn-secondary btn-sm"><i class="fas fa-ellipsis-v"></i></a></div>')};var clicks,timer,delay;clicks=0;delay=500;timer=null;$('.input-group-append',this).on('click',function(){clicks++;timer=setTimeout(function(){switch(clicks){case 1:var html='';html=html+'<div id="zmi-single-line-edit" class="inner">'+'<form class="form-horizontal" name="zmi-single-line-form">';if($single_line.hasClass("zmi-nodes")){html=html+'<div class="col-lg-10">'+'<div class="input-group">'+'<input class="form-control url-input" type="text" name="zmi-nodespicker-url-input">'+'<div class="input-group-append">'+'<a class="btn btn-secondary" href="javascript:;" onclick="zmiBrowseObjs(\'zmi-single-line-form\',\'zmi-nodespicker-url-input\',getZMILang())">'+'...'+'</a>'+'</div>'+'</div><!--.input-group-->'+'</div><!--.col-lg-10-->'}
html=`${html}<textarea class="form-control zmi-code" rows="10" wrap="off">${$textarea.val()}</textarea></form></div><!--#zmi-single-line-edit-->`;zmiModal(null,{body:html,resizable:true,title:getZMILangStr('BTN_EDIT')+':'+$textarea.attr('title'),resize:function(event,ui){var $container=$('#zmi-single-line-edit');var $ta=$('textarea',$container);var taCoords=$ZMI.getCoords($ta[0],"relative");$ta.css({height:Math.max(20,$container.innerHeight()-taCoords.y-20)+'px'})},close:function(event,ui){$textarea.val($('#zmi-single-line-edit textarea').val())}});break;case 2:eval($textarea.attr('data-dblclickhandler'));break}
clicks=0},delay)})}
});$('table.table-hover tbody tr').dblclick(function(evt){var href=null;if((href==null||typeof href=="undefined")&&$("a .fa-pencil-alt",this).length > 0){return $("a .fa-pencil-alt",this).parents("a")[0].click()}
else if((href==null||typeof href=="undefined")){href=$('a[target=]',this).attr('href')}
if(!(href==null||typeof href=="undefined")){self.location.href=href}
}).attr("title","Double-click to edit!");$("table.zmi-selectable input:checkbox,table.zmi-selectable input:radio").change(function(){var $table=$(this).parents("table");$("tr",$table).each(function(){if($("td:first input:checked",this).length==0){$(this).removeClass("zmi-selected")}
else {$(this).addClass("zmi-selected")}
})});var dragSrcEl=null;function handleDragStart(e){dragSrcEl=this;e.dataTransfer.effectAllowed='move';e.dataTransfer.setData('text/html',this.outerHTML);this.classList.add('zmi-selected')}
function handleDragOver(e){if(dragSrcEl){if(e.preventDefault){e.preventDefault()}
if((this.classList.contains("page")&&dragSrcEl.classList.contains("page"))||(this.classList.contains("pageelement")&&dragSrcEl.classList.contains("pageelement"))){this.classList.add('zmi-data-transfer-drag');e.dataTransfer.dropEffect='move'}
return false}}
function handleDragEnter(e){}
function handleDragLeave(e){this.classList.remove('zmi-data-transfer-drag')}
function handleDrop(e){if(e.stopPropagation){e.stopPropagation()}
if(dragSrcEl !=this){this.parentNode.removeChild(dragSrcEl);var dropHTML=e.dataTransfer.getData('text/html');this.insertAdjacentHTML('beforebegin',dropHTML);var dropElem=this.previousSibling;addDnDHandlers(dropElem);var that=this;var c=0;$('.zmi-sortable > li').each(function(){if($(this).attr("id")==that.id){var pos=$(this.previousSibling).position();var id=$ZMI.actionList.getContextId(dragSrcEl);var href=id+'/manage_moveObjToPos?lang='+getZMILang()+'&pos:int='+c+'&fmt=json';$.get(href,function(result){var message=eval('('+result+')');$ZMI.showMessage(pos,message,'alert-success zmi-dragged-info');$('.alert-success button').remove()})}
c++})}
this.classList.remove('zmi-data-transfer-drag');return false}
function handleDragEnd(e){this.classList.remove('zmi-selected')}
function addDnDHandlers(elem){elem.draggable=true;elem.addEventListener('dragstart',handleDragStart,false);elem.addEventListener('dragenter',handleDragEnter,false);elem.addEventListener('dragover',handleDragOver,false);elem.addEventListener('dragleave',handleDragLeave,false);elem.addEventListener('drop',handleDrop,false);elem.addEventListener('dragend',handleDragEnd,false)}
var sortables=document.querySelectorAll('ul.zmi-container.zmi-sortable .zmi-selectable');[].forEach.call(sortables,addDnDHandlers);$("input[name='ids:list']").attr('title',getZMILangStr('ACTION_SELECT').replace('%s',getZMILangStr('ATTR_OBJECT')));$(".zmi-container .zmi-item:first .right input[name='active']:checkbox").change(function(){zmiToggleSelectionButtonClick(this,$(this).prop("checked"))});$(".zmi-container .right input[name='ids:list']").change(zmiActionButtonsRefresh);$(".split-left i.constraint").each(function(){try {var $container=$(this).parents(".right");$(".split-right",$container).popover({html:true,title:$("div.constraint",$container)[0].outerHTML})} catch(e){console.error(e)}
});$('button.btn.split-right.dropdown-toggle').attr('title',getZMILangStr('ACTION_SELECT').replace('%s',getZMILangStr('ATTR_ACTION')));$(".zmi-action.btn-group").mouseover(function(evt){$(this).parents(".collapse").css({overflow:"visible"})}).mouseout(function(evt){$(this).parents(".collapse").css({overflow:"hidden"})});$(".zmi-container .zmi-item .zmi-action").focus(function(evt){$ZMI.actionList.over(this,evt)}).hover(function(evt){$ZMI.actionList.over(this,evt)},function(evt){$ZMI.actionList.out(this)});$(".zmi-action button.dropdown-toggle:not(.btn-card-header-menu)").click(function(evt){var el=$(this);if(!el.parent(".zmi-action").hasClass('loaded')){evt.preventDefault();evt.stopPropagation();setTimeout(function(){el.click()},100)}
});$ZMI.initInputFields($("body"));$("#subTab ul.nav.nav-tabs").each(function(){var anchor=$("a:first",this).attr("href");if(self.location.href.indexOf("#")>0){anchor=self.location.href.substring(self.location.href.indexOf("#")+1);if(anchor.indexOf('_')==0){anchor=anchor.substring(1)}
anchor='#'+anchor}
$("a[href='"+anchor+"']",this).click()});$(".ajax-lazy-load").each(function(){var $that=$(this);$that.html('<i class="fas fa-spinner fa-spin"></i>&nbsp;'+getZMILangStr('MSG_LOADING'));var ajax_url=$that.attr("data-ajax-url");var params={};$.get(ajax_url,params,function(data){$that.html(data)})});$ZMI.setCursorAuto("EO bootstrap.plugin.zmi");$('#menulock').val(+JSON.parse($ZMILocalStorageAPI.get('ZMS.menulock',0)));$('a.zmslightbox,a.fancybox').each(function(){var $img=$("img",$(this));$img.attr("data-hiresimg",$(this).attr("href"));$(this).click(function(){return showFancybox($img)})})});function zmiUnlockForm(form_id){var $form=$('input[name="form_id"][value="'+form_id+'"]').parents("form");if($('input[name="form_unlock"]',$form).length==0){$form.append('<input type="hidden" name="form_unlock" value="1">')}
$form.submit()}
ZMI.prototype.afterInitInputFields=function(h){if(typeof this.afterInitInputFieldsHandler=="undefined"){this.afterInitInputFieldsHandler=[]}
this.afterInitInputFieldsHandler.push(h)}
ZMI.prototype.initInputFields=function(container){$ZMI.setCursorWait("BO zmiInitInputFields["+$('form:not(.form-initialized)',container).length+"]");$(container).each(function(){var context=this;var data_root=$("body").attr('data-root');$(".collapse",context).each(function(){var id=$(this).attr('id');if(typeof id !="undefined"){var $toggle=$('a.card-toggle[href=\'#'+id+'\']');if($toggle.length > 0){var key="ZMS."+data_root+".collapse-"+id;var value=$ZMILocalStorageAPI.get(key,'1');if(value !=null){if($(this).hasClass('show')){if(value=='0'){$(this).removeClass('show')}
} else {if(value=='1'){$(this).addClass('show')}}
}}}
});$("i:first",$(".collapse",context).prev('.card-header')).removeClass("fa-caret-down").addClass("fa-caret-right");$("i:first",$(".collapse.show",context).prev('.card-header')).removeClass("fa-caret-right").addClass("fa-caret-down");$("a.card-toggle",this).click(function(){$(this).blur();var id=$(this).attr('href').substring(1);var key="ZMS."+data_root+".collapse-"+id;var $icon=$("i:first",this);var showing=$icon.hasClass("fa-caret-down")?1:0;if(showing){$icon.removeClass("fa-caret-down").addClass("fa-caret-right");$ZMILocalStorageAPI.set(key,'0')}
else {$icon.removeClass("fa-caret-right").addClass("fa-caret-down");$ZMILocalStorageAPI.set(key,'1')}
});$("input[type=password]",this).focus(function(){if($(this).val()=='******'){$(this).val('')}
}).blur(function(){if($(this).val()==''){$(this).val('******')}
})});$('form:not(.form-initialized)',container).submit(function(){var b=true;var context=this;if(typeof self.btnClicked=="undefined"||self.btnClicked=="BTN_BACK"||self.btnClicked=="BTN_CANCEL"||self.btnClicked=="BTN_DELETE"){return b}
if($(".form-richtext",this).length > 0){zmiRichtextOnSubmitEventHandler(this)}
$('select[multiple="multiple"]',this).each(function(){var name=$(this).attr("name");var form=$(this).parents("form");if($(this).hasClass('form-on-submit-selected')||($('select[name="zms_mms_src_'+name+'"]',form).length>0)){$("option",this).prop("selected","selected")}
});$(".has-error",this).removeClass("has-error");$(".form-group label.control-label.mandatory",this).filter(":visible").each(function(){var $label=$(this);var forName=$(this).attr("for");var labelText=$label.text().basicTrim();var $controlGroup=$label.parents(".form-group");var $controls=$("div:first",$controlGroup);var $control=$('input[name='+forName+'],textarea[name='+forName+'],select:not([name^="zms_mms_src_"])',$controls);$label.attr("title","");$control.attr("title","");if($control.length==1){var isBlank=false;var nodeName=$control.prop("nodeName").toLowerCase();var nodeType=$control.prop("type").toLowerCase();if(nodeName=="input"||nodeName=="textarea"){if($control.val().basicTrim().length==0&&typeof $control.attr("data-value-attr")!="undefined"){$control.val($control.attr($control.attr("data-value-attr")))}
isBlank=$control.val().basicTrim().length==0;if(isBlank&&nodeType=="file"){var name=$control.attr("name");var exists=$('input[name="exists_'+forName+'"]:hidden',$controlGroup).val();isBlank=!(exists=='True');var generate_preview=$('input[name="generate_preview_'+forName.replace(/_/,'hires_')+':int"]:checked',context).val();isBlank&=!(generate_preview=='1')}}
else if(nodeName=="select"){isBlank=(($("option:selected",$control).length==0)||($("option:selected",$control).length==1&&$("option:selected",$control).attr("value")==""))&&!$control.attr("disabled")=="disabled"}
if(isBlank){$controlGroup.addClass("has-error");$label.attr("title",getZMILangStr("MSG_REQUIRED").replace(/%s/,labelText));$control.attr("title",getZMILangStr("MSG_REQUIRED").replace(/%s/,labelText)).tooltip({placement:'top'});if(b){$control.focus()}
b=false}
else {var dataExclude=$(this).attr("data-exclude");if(typeof dataExclude !="undefined"){var excludeList=dataExclude.split(",");var v=$control.val();if($.inArray(v,excludeList)){$controlGroup.addClass("has-error")}}
}}
});var $password=$("input[type=password]",this).filter(":visible");if(($password.length==2)&&($($password[0]).prop("name").toLowerCase().indexOf("confirm")<0)&&($($password[1]).prop("name").toLowerCase().indexOf("confirm")>=0)&&($($password[0]).val().length==0||$($password[0]).val()!=$($password[1]).val())){var $controlGroup=$password.parents(".form-group");var $label=$("label.control-label",$controlGroup);$controlGroup.addClass("has-error");b=false}
if(b&&$('input#last_change_dt:hidden',this).length&&$('input[name="form_unlock"]',this).length==0){var result=$.ajax({url:'manage_get_node_json',data:{lang:getZMILang(),preview:'preview'},datatype:'text',async:false
});var node=eval("("+result.responseText+")");var change_dt=node["change_dt"];var change_uid=node["change_uid"];var last_change_dt=$('input#last_change_dt:hidden',this).val();var last_change_uid=$('input#last_change_uid:hidden',this).val();if(change_dt !=last_change_dt){var body='<div class="alert alert-error">'+'<h4><i class="fas fa-exclamation-triangle"></i> '+getZMILangStr('ATTR_LAST_MODIFIED')+'</h4>'+'<div>'+change_dt+' '+getZMILangStr('BY')+' '+change_uid+'</div>'+'</div>'+'<table class="table table-bordered table-striped">'+'<thead>'+'<tr class="form-group">'+'<th><label class="control-label">'+'</label></th>'+'<th><em>Diff</em></th>'+'<th><em>Mine</em></span></th>'+'<th><em>Theirs</em>('+change_uid+' <span class="zmi-change-dt">'+(new Date(change_dt)).toLocaleFormat(getZMILangStr('DATETIME_FMT'))+'</span>)</th>'+'</thead>'+'</tr>';for(var key in node){var $input=$("[name='"+key+"'],[name='"+key+"_"+getZMILang()+"']",this).filter("[data-initial-value]");if($input.length > 0){var $controlGroup=$input.parents(".form-group");var $label=$("label.control-label:first",$controlGroup);var remoteVal=(""+node[key]).replace(/\r\n/gi,"\n").trim();var currentVal=(""+$input.val()).replace(/\r\n/gi,"\n").trim();var initialVal=(""+$input.attr("data-initial-value")).replace(/\r\n/gi,"\n").trim();if("file"==$input.attr("type")){if(currentVal==""){currentVal=initialVal}}
if(currentVal !=initialVal){$input.addClass("form-modified")}
if(currentVal !=remoteVal){$input.removeClass("form-modified").addClass("form-conflicted").attr("data-remote-value",remoteVal);body+='<tr class="form-group">'+'<td><label class="control-label"><span>'+$label.text()+'</span></label></td>'+'<td><div style="overflow-y:scroll;max-height:20em" class="diff" id="'+$input.attr("name")+'_diff"></div></td>'+'<td><div style="overflow-y:scroll;max-height:20em" class="mine" id="'+$input.attr("name")+'_mine">'+currentVal+'</div></td>'+'<td><div style="overflow-y:scroll;max-height:20em" class="theirs" id="'+$input.attr("name")+'_theirs">'+remoteVal+'</div></td>'+'</tr>'}}}
var conflicts=$(".form-conflicted",this).length;if(conflicts > 0){b=false;var form_id=$('input[name=form_id]').val();body+='</table>'+'<div class="form-group">'+'<button class="btn btn-primary" value="'+getZMILangStr('BTN_SAVE')+'" onclick="zmiUnlockForm(\''+form_id+'\')">'+getZMILangStr('BTN_SAVE')+'</button> '+'<button class="btn btn-default" value="'+getZMILangStr('BTN_CANCEL')+'" onclick="window.open(self.location.href);">'+getZMILangStr('BTN_CANCEL')+'</button> '+'</div>';zmiModal(null,{body:body,title:getZMILangStr('CAPTION_WARNING')});$.plugin('diff',{files:[
'/++resource++zms_/jquery/diff/diff_match_patch.js','/++resource++zms_/jquery/diff/jquery.pretty-text-diff.min.js'
]});$.plugin('diff').set({context:this});$.plugin('diff').get(".form-conflicted",function(){$(".form-conflicted",context).each(function(){var id=$(this).attr("name")+"_diff";var $diffContainer=$("#"+id);$(this).prettyTextDiff({cleanup:true,originalContent:$(this).attr("data-initial-value").replace(/</gi,'&lt;'),changedContent:$(this).val().replace(/</gi,'&lt;'),diffContainer:$diffContainer
});var lines=$diffContainer.html().replace(/<span>/gi,'').replace(/<\/span>/gi,'').split("<br>");var show=[];var changed=false;for(var i=0;i < lines.length;i++){var line=lines[i];changed|=line.indexOf("<del>")>=0||line.indexOf("<ins>")>=0;if(changed){show.push(i)}
changed&=!(line.indexOf("</del>")>=0||line.indexOf("</ins>")>=0)}
var html=[];changed=false;for(var i=0;i < lines.length;i++){var line=lines[i];changed|=line.indexOf("<del>")>=0||line.indexOf("<ins>")>=0;line='<span class="line-number'+(changed?' line-changed':'')+'">'+(i+1)+'</span> '+lines[i];if(!(show.contains(i-1)||show.contains(i)||show.contains(i+1))){line='<span class="diff-unchanged hidden">'+line+'</span>'}
else {line=line+'<'+'br/>'}
html.push(line);changed&=!(line.indexOf("</del>")>=0||line.indexOf("</ins>")>=0)}
$diffContainer.html(html.join(""))})})}}}
return b}).each(function(){var context=this;if($(this).parents(".d-none").length>0){return}
$(this).addClass('form-initialized');$('select.form-multiautocomplete[multiple]:not(.d-none)',context).each(function(){var $select=$(this);var id=$select.attr('id');var ajax_url=$select.attr('data-ajax-url');var obj_id=$select.attr('data-obj-id');var attr_id=$select.attr('data-attr-id');$select.removeClass("form-control").addClass("zmi-select").attr({"data-autocomplete-add":false});$select.before(''+'<div class="input-group form-multiautocomplete">'+'<input type="text" id="_'+id+'" class="form-control form-autocomplete" data-ajax-url="'+ajax_url+'" data-obj-id="'+obj_id+'" data-attr-id="'+attr_id+'"/>'+'<div class="input-group-append">'+'<a href="javascript:;" class="btn btn-secondary"><i class="fas fa-plus text-primary"></i></a>'+'</div>'+'</div><!--.input-group-->');var $inputgroup=$select.prev();$("input",$inputgroup).keydown(function(e){if(e.which==13){e.preventDefault();e.stopPropagation();$(".input-group-append",$inputgroup).trigger("click");return false}
});$(".input-group-append .btn",$inputgroup).click(function(){var $input=$("input",$inputgroup);var v=$input.val();if(v.length>0){$input.val("");if($select.children("option[value='"+v+"']").length==0){$select.append('<option selected="selected" value="'+v+'" data-value="'+v+'">'+v+'</option>').removeClass("d-none");$ZMI.multiselect(context)}}
})});$('.form-autocomplete:not(.d-none)',context).each(function(){$(this).addClass("ui-autocomplete-input");var id=$(this).attr('id');var ajax_url=$(this).attr('data-ajax-url');var obj_id=$(this).attr('data-obj-id');var attr_id=$(this).attr('data-attr-id');zmiAutocomplete('#'+id,{serviceUrl:ajax_url,paramName:'q',params:{obj_id:obj_id,attr_id:attr_id,lang:getZMILang()},transformResult:function(response,originalQuery){var m={query:originalQuery,suggestions:$.map(response.split("\n"),function(x){return {value:x,data:x}})};return m}
})});$.plugin('multiselect',{files:[
$ZMI.getConfProperty('plugin.bootstrap.multiselect.js','/++resource++zms_/bootstrap/plugin/bootstrap.plugin.zmi.multiselect.js')]});$.plugin('multiselect').set({context:context});$.plugin('multiselect').get("select.zmi-select[multiple]:not(.d-none)",function(){$ZMI.multiselect(context)});if($("#zmi-toggle-activity").length==0){$("#attrActivity",context).each(function(){var $input=$(".activity input:checkbox",this);if($input.length>0){$(this).prev(".attr_last_modified").each(function(){$("#zmi-toggle-activity-btn",this).append('<span id="zmi-toggle-activity" style="vertical-align:inherit" title="'+getZMILangStr('ATTR_ACTIVE')+'">'+$ZMI.icon(($input.prop('checked')?'fas fa-check-square':'far fa-square')+' ui-helper-clickable')+'</span>&nbsp;');$("#zmi-toggle-activity").click(function(event){$input.click();$("i",this).attr("class",($input.prop('checked')?'fas fa-check-square':'far fa-square')+' ui-helper-clickable');event.stopPropagation()})})}
})}
$('input[type="submit"],button[type="submit"]',context).click(function(){self.btnClicked=$(this).attr("value")});$('.btn-radiogroup',context).each(function(){var key=$(this).attr('data-value');var $input=$('input#'+key);var val=$input.val();$(this).children('span').addClass("btn").click(function(){var item=$(this).attr('data-value');$input.val(item);$(this).siblings('.btn-info').removeClass('btn-info').addClass('btn-secondary');$(this).removeClass('btn-secondary').addClass('btn-info')}).each(function(){var item=$(this).attr('data-value');if(val==""){val=item;$input.val(val)}
if(item==val){$(this).addClass("btn-info")} else {$(this).addClass("btn-secondary")}
})});$(".form-group label.col-lg-2 control-label.mandatory",this).each(function(){var $label=$(this);$label.prepend('<i class="fas fa-exclamation"></i>')});$("input,select,textarea",this).each(function(){var $this=$(this);const initialValue=$this.val();$this.attr("data-initial-value",initialValue);$this.keyup(function(){$ZMI.set_form_modified($this,initialValue)})});$('input.zmi-input-icon-clazz',this).each(function(){var $input=$(this);var t='Use icon classes on https://fontawesome.com/v5/search?m=free \nand specifier classes like \'text-danger\' or \'deprecated\'';$input.wrap('<div class="input-group"></div>');$input.before('<span class="input-group-text"><i class="fas fa-invisible"></i></span>');$input.parent().children('span.input-group-text').wrap('<div class="input-group-prepend" style="cursor:pointer;" title="'+t+'"></div>');var fn=function(){var $container=$input.parents(".input-group");var $i=$("i",$container);$i.attr("class",$input.val())};$input.change(fn).keyup(fn).change();$input.prev().on('click',function(){var s='';$input.val().split(' ').forEach(function(v){if(v.split('fa-').length > 1){s=v.split('fa-')[1]}});window.open('https://fontawesome.com/v5/search?m=free&q='+s,'Fontawesome-V5','toolbar=no,scrollbars=yes,resizable=yes,top=100,left=100,width=480,height=720')})});$ZMI.initUrlInput(this);var $richedits=$('div[id^="zmiStandardEditor"]',this);if($richedits.length > 0){$richedits.each(function(){var elName=$(this).attr("id").substring("zmiStandardEditor".length);zmiRichtextInit(elName);var v=$("#"+elName).val();function matchAll(source,regexp){var matches=[];source.replace(regexp,function(){var arr=([]).slice.call(arguments,0);var extras=arr.splice(-2);arr.index=extras[0];arr.input=extras[1];matches.push(arr)});return matches.length ? matches:[]}
var l=matchAll(v,/<a data-id="(.*?)"(.*?)>(.*?)<\/a>/gi);if(l.length > 0){var labels=[];for(var i=0;i < l.length;i++){labels.push(' <span class="label">'+l[i][0]+'</span>')}
$(this).siblings(":last").after('<div class="inlinelinks">Inline-Links:'+labels.join(',')+'</div>')}
})}
var is_firefox=/firefox/i.test(navigator.userAgent);var icon_datepicker='far fa-calendar';var icon_datetimepicker='far fa-calendar';var icon_timepicker='far fa-clock';$("input.datepicker,input.datetimepicker,input.timepicker",this).each(function(){if(!$(this).parent().hasClass('data')){$(this).closest("div").addClass("input-group").removeClass("col-sm-9").removeClass("col-sm-10").removeClass("col-md-10").wrap('<div class="col-sm-5 col-md-4 col-lg-3"></div>');var icon_picker=eval('icon_'+$(this).prop('class').split(' ').filter(function(v){return v.endsWith('picker')}));$(this).before('<div class="input-group-prepend"><span class="input-group-text"><i class="'+icon_picker+'"></i></span></div>')}
if(is_firefox&&parseInt(navigator.userAgent.split('Firefox/')[1])< 93){if($(this).attr('type')=='datetime-local'){$(this).attr('type','date')}
$(this).attr('value',$(this).attr('value').split('T')[0]);$(this).dblclick(()=> {if($(this).attr('type')=='datetime-local'){$(this).attr('type','date')}
else if($(this).attr('type')=='date'){$(this).attr('type','datetime-local')}
$(this).attr('value',$(this).attr('data-initial-value'))})}
})});if(typeof this.afterInitInputFieldsHandler !="undefined"){for(var i in this.afterInitInputFieldsHandler){this.afterInitInputFieldsHandler[i]()}}
$ZMI.setCursorAuto("EO zmiInitInputFields")}
ZMI.prototype.showMessage=function(pos,message,context){$(".alert").remove();var html=''+'<div class="alert'+(typeof context=='undefined'?'':' '+context)+'" style="position:absolute;left:'+pos.left+'px;top:'+pos.top+'px;">'+'<button type="button" class="close" data-dismiss="alert">&times;</button>'+'<span class="message">'+message+'</span>'+'</div>';$('body').append(html);window.setTimeout('$(".alert").hide("slow")',2000)}
var zmiModalStack=[];function zmiModal(s,opt){$ZMI.setCursorWait("zmiModal");if(typeof opt=="undefined"){var id=zmiModalStack[zmiModalStack.length-1];$('#'+id).modal(s)}
else if(typeof opt=="object"){var id=typeof opt['id']=="undefined"?"zmiModal"+(s==null||typeof $(s).attr('id')=="undefined"?zmiModalStack.length:$(s).attr('id')):opt['id'];var body=s==null?opt['body']:$(s).html();if(s!=null&&opt['remove']==true){$(s).remove()}
if(typeof id!="undefined"&&typeof body!="undefined"){zmiModalStack.push(id);var html=''+'<div class="modal" id="'+id+'" tabindex="-1" role="dialog">'+'<div class="modal-dialog" role="document">'+'<div class="modal-content">'+'<div class="modal-header">'+'<h5 class="modal-title">'+opt['title']+'</h5>'+'<button type="button" class="close" data-dismiss="modal" aria-label="'+getZMILangStr('BTN_CLOSE')+'">'+'<span aria-hidden="true">&times;</span>'+'</button>'+'</div>'+'<div class="modal-body">'+body+'</div>'+'<div class="modal-footer">'+'</div>'+'</div><!--/.modal-content-->'+'</div><!--/.modal-dialog-->'+'</div><!--/.modal-->';$('#'+id).remove();$("body").append(html);var buttons=opt['buttons'];if(typeof buttons=='object'){for(var i=0;i < buttons.length;i++){var button=buttons[i];$('#'+id+' .modal-footer').append('<button type="submit">'+button['text']+'</button> ');var $button=$('#'+id+' .modal-footer button:last');for(var k in button){var v=button[k];if(typeof v=="function"){$button.on(k,eval("("+v+")"))} else {$button.attr(k,v)}}
}}
$('#'+id).on('show.bs.modal',function(){if(typeof opt['beforeOpen']=='function'){opt['beforeOpen'](this)}
}).on('shown.bs.modal',function(){if(typeof opt["width"] !="undefined"){$("#"+id+" .modal-dialog").css({width:opt["width"]})}
if(typeof opt['open']=='function'){opt['open'](this)}
$ZMI.initInputFields($("#"+id))}).on('hide.bs.modal',function(){if(typeof opt['beforeClose']=='function'){opt['beforeClose'](this)}
}).on('hidden.bs.modal',function(){if(typeof opt['close']=='function'){opt['close'](this)}
zmiModalStack.pop()}).modal(opt['modal']);if(typeof opt['minWidth'] !='undefined'){$('#'+id+' .modal-content').css('minWidth',opt['minWidth']);$('#'+id+' .modal-dialog').css('minWidth',opt['minWidth'])}
$('#'+id+' .modal-dialog').css('transform','translate('+((zmiModalStack.length-1)*2)+'em,'+((zmiModalStack.length-1)*2)+'em)')}}
$ZMI.setCursorAuto("zmiModal");return false}
ZMI.prototype.iframe=function(href,data,opt){$ZMI.setCursorWait("$ZMI.iframe");data=typeof data=="undefined" ? {}:data;opt=typeof opt=="undefined" ? {}:opt;var url=href+"?";for(var k in data){url+=k+"="+data[k]+"&"}
if(typeof opt['iframe'] !='undefined'){var width='100%';var height=typeof opt['height']=='undefined' ? '100%':opt['height'];opt['body']='<iframe src="'+url+'" width="'+width+'" height="'+height+'" frameBorder="0"></iframe>';zmiModal(null,opt);$ZMI.setCursorAuto("zmiIframe")} else {$.get(href,data,function(result){var $result=$(result);if($("div#system_msg",$result).length>0){var manage_tabs_message=$("div#system_msg",$result).text();manage_tabs_message=manage_tabs_message.substring(0,manage_tabs_message.lastIndexOf("("));var href=self.location.href;href=href.substring(0,href.indexOf("?"))+"?lang="+getZMILang()+"&manage_tabs_message="+manage_tabs_message;self.location.href=href} else {if(opt['json']){result=`<pre class="zmi-code json">${JSON.stringify(result,null,space=4)}</pre>`}
opt['body']=result;if(typeof opt['title']=="undefined"){var title=$("div.zmi",result).attr("title");if(typeof title !="undefined"&&title){opt['title']=title}}
zmiModal(null,opt);$ZMI.setCursorAuto("$ZMI.iframe")}
})}
return false}
ZMIObjectTree=function(){};$ZMI.objectTree=new ZMIObjectTree();ZMIObjectTree.prototype.init=function(s,href,p){var that=this;that.p=p?p:{};that.p.params=that.p.params?that.p.params:{};that.active=[];$(s).html('<i class="fas fa-spinner fa-spin"></i>&nbsp;'+getZMILangStr('MSG_LOADING'));var doc_href=$ZMI.get_document_element_url($ZMI.getPhysicalPath());that.metamodel=$.ajax({url:$ZMI.get_rest_api_url(doc_href)+'/metaobj_manager',async:false
}).responseJSON;that.p.params.lang=getZMILang();$.get($ZMI.get_rest_api_url(href)+'/get_parent_nodes',that.p.params,function(result){$(s).html('');var context=s;result.forEach(node=> {var html=that.addPages([node]);$(context).append(html);if(typeof that.p['addPages.callback']=='function'){that.p['addPages.callback']()};context=`ul[data-id="${node.uid}"] li`;that.active.push({id:node.uid})});$('li',s).addClass('active');var callback=that.p['init.callback'];if(typeof callback !='undefined'){callback()}
}).fail(function(jqXHR){if(jqXHR.status===401){parent.window.location.reload()}
})}
ZMIObjectTree.prototype.addPages=function(nodes){var that=this;var html="";if(that.p.filter){nodes=nodes.filter(that.p.filter)};if(typeof nodes=='undefined'||nodes==null||typeof nodes=='string'){nodes=[]} else if(typeof nodes=='object'&&!Array.isArray(nodes)){nodes=[nodes]};nodes.forEach(node=> {var data_id='{$'+node.uid+'}';var link_url=node.index_html;var icon=that.metamodel[node.meta_id] ? $ZMI.icon(that.metamodel[node.meta_id].icon_clazz):$ZMI.icon('far fa-file');var anchor='';var css=[ node.is_page ? 'is_page':'is_page_element' ];var callback=that.p['toggleClick.callback'];if((node.titlealt.toUpperCase().search('REDIRECT')>-1)&&(node.attr_dc_identifier_url_redirect&&node.attr_dc_identifier_url_redirect.trim()!=''))return;if(node.meta_id=='ZMSGraphic'&&link_url){link_url=`<img data-id=&quot;${data_id}&quot;src=&quot;${link_url}&quot;>`} else if(node.meta_id=='ZMSFile'&&link_url){var $path_elements=link_url.split('/');var $fname=$path_elements[$path_elements.length-1 ].split('?')[0];link_url=`<a data-id=&quot;${data_id}&quot;href=&quot;${link_url}&quot;target=&quot;_blank&quot;>${$fname}</a>`};if(!node.active){css.push("inactive")};if(node.restricted){css.push("restricted")};if(node.attr_dc_type){css.push('type-'+node.attr_dc_type)};html+=`<ul data-id="${node.uid}" class="zmi-page ${node.meta_id}${node.is_page_element ? ' is_page_element':''}">`;html+=`<li class="${css.join(' ')}">`;if(!(that.p.params.meta_types=='ZMS'&&node.meta_id=='ZMS'&&!node.has_portal_clients)){html+=`<i class="fas fa-caret-right toggle" title="+" onclick="$ZMI.objectTree.toggleClick(this ${typeof callback=='undefined' ? '':','+callback})"></i> `} else {html+=`<i class="fas fa-caret-right toggle" title="-" style="visibility:hidden"></i> `};if(node.is_page_element){if(node.index_html&&/\.(gif|jpe?g|png|webp|svg)$/i.test(node.index_html)){html+=`<span class="preview_on_hover preview_image preview_ready" style="--preview_url:url(${node.index_html});cursor:help" title="${getZMILangStr('TAB_PREVIEW')}">${icon}</span> `} else {html+=`<span class="preview_on_hover preview_text" style="cursor:help" data-preview_text="Loading ..." onmouseover="$ZMI.objectTree.preview_load(this)" title="${getZMILangStr('TAB_PREVIEW')}">${icon}</span> `}}
html+=`<a href="${node.getPath}"
data-link-url="${link_url}"
data-uid="${node.uid}"
data-anchor="${anchor}"
data-page-titlealt="${node.titlealt.replace(/"/g,'&quot;').replace(/'/g,'&apos;')}"
onclick="return zmiSelectObject(this);return false;">`;if(!node.is_page_element){html+=icon+' '}
html+=node.titlealt;html+='</a>';html+='</li>';html+='</ul><!--.zmi-page-->'});return html}
ZMIObjectTree.prototype.toggleClick=function(toggle,callback){var that=this;var $container=$(toggle).parents("li:first");$container.children("ul").remove();if($(toggle).hasClass("fa-caret-right")){$(toggle).removeClass("fa-caret-right").addClass("fa-caret-down").attr({title:'-'});var uid=$("[data-uid]:first",$(toggle).parent()).attr("data-uid");var href=$ZMI.get_document_element_url($ZMI.getPhysicalPath());$container.append('<div id="loading" class="zmi-page"><i class="fas fa-spinner fa-spin"></i>&nbsp;&nbsp;'+getZMILangStr('MSG_LOADING')+'</div>');that.p.params.lang=getZMILang();$.get($ZMI.get_rest_api_url(href)+'/'+uid+'/get_child_nodes',that.p.params,function(result){$("#loading").remove();if(result.length==0){$(toggle).removeClass("fa-caret-down").attr({title:''})}
else {var html=that.addPages(result);$container.append(html);if(typeof that.p['addPages.callback']=='function'){that.p['addPages.callback']()}
for(var i=0;i < that.active.length;i++){var d=that.active[i];$("ul[data-id=\'"+d.id+"] > li").addClass('active')}}
if(typeof callback=='function'){callback()}
})} else {if($(toggle).hasClass("fa-caret-down")){$(toggle).removeClass("fa-caret-down").addClass("fa-caret-right").attr({title:'+'})}
if(typeof callback=='function'){callback()}}}
ZMIObjectTree.prototype.preview_load=function(sender){var data_id=$(sender).closest('.zmi-page').attr('data-id');if(!$(sender).hasClass('preview_loaded')){var abs_url=$(sender).parent('li').children('a[href]').attr('href');$.get($ZMI.get_rest_api_url(abs_url)+'/get_body_content',{lang:getZMILang(),preview:'preview'},function(data){try {data=JSON.parse(data)} catch(e){data=data.replaceAll('\n',' ').replaceAll('\t',' ');data=data.replace(/<!--[\s\S]*?-->/g,'').replace(/<style[\s\S]*?<\/style>/gi,'').replace(/<script[\s\S]*?<\/script>/gi,'')};data=$(data).text().trim();$(sender).attr('data-preview_text',data);$(sender).addClass('preview_loaded')})}}
ZMIActionList=function(){};$ZMI.actionList=new ZMIActionList();ZMIActionList.prototype.getContextId=function(el){var context=$(el).hasClass("zmi-item")?$(el):$(el).parents("li.zmi-item");var context_id=$(context).attr("id");return typeof context_id=="undefined"||context_id==""?"":context_id.replace(/zmi_item_/gi,"")}
ZMIActionList.prototype.over=function(el,e,cb){var that=this;if(typeof cb=="undefined"){$("button.split-left",el).css({visibility:"visible"})}
var $button=$('button.btn.split-right.dropdown-toggle',el);$button.click(function(){var $right=$(this).parents(".right");var selected=$("input:checkbox",$right).length?$("input:checkbox",$right).prop("checked"):false;$(".dropdown-header",$right).each(function(index){var actualCollapsed=$("i",this).hasClass("fa-caret-right");var expectedCollapsed=(index==0&&!selected)||(index > 0&&selected);if(actualCollapsed !=expectedCollapsed){$(this).click()}
})});$('*',$button).hide();if($(el).hasClass("loaded")||$(el).hasClass("loading")){if(typeof cb=="function"){cb()}
return}
$(el).addClass("loading");$(document.body).css("cursor","wait");var lang=getZMILang();var context_id=this.getContextId(el);$("button.split-left",el).click(function(){if(!$(el).hasClass("loading")){if($(".fa-plus-sign",this).length==0){var action=self.location.href;action=action.substring(0,action.lastIndexOf("/")+1);if(context_id==""){action+="manage_properties"}
else {if($ul.html().indexOf(context_id+"/manage_main")<0){return false}
action+=context_id+"/manage_main"}
action+="?lang="+lang;self.location.href=action}
else {$('button.btn.split-right.dropdown-toggle',el).click()}}
return false});var action=self.location.origin+self.location.pathname;action=action.substring(0,action.lastIndexOf("/"));action+="/manage_ajaxZMIActions";var params={};params['lang']=lang;params['context_id']=context_id;$.get(action,params,function(data){var value=eval('('+data+')');var id=value['id'].replace(/\./,"_");var actions=value['actions'];$(el).append('<div class="dropdown-menu"></div>');$ul=$(".dropdown-menu",el);var startsWithSubmenu=actions.length > 1&&actions[1][0].indexOf("-----")==0&&actions[1][0].lastIndexOf("-----")> 0;var o=0;if(startsWithSubmenu){o=2;var html='';var action=actions[1];var optlabel=action[0];var opticon='<i class="fas fa-plus-sign"></i>';optlabel=optlabel.substring("-----".length);optlabel=optlabel.substring(0,optlabel.lastIndexOf("-----"));optlabel=optlabel.basicTrim();$("button.split-left",el).html(opticon+' '+optlabel)}
for(var i=o;i < actions.length;i++){if(o==0&&i==1){$ul.append('<a class="dropdown-item" href="javascript:zmiToggleSelectionButtonClick($(\'li.zmi-item'+(id==''?':first':'#zmi_item_'+id)+'\'))"><i class="fas fa-check-square"></i> '+getZMILangStr('BTN_SLCTALL')+'/'+getZMILangStr('BTN_SLCTNONE')+'</a>')}
var action=actions[i];var optlabel=action[0];var optvalue=action[1];var opticon=action[2];var optid='';var opttitle='';if(action.length==5){optid=action[3];opttitle=action[4]}
if(action.length==6){var optlabel=action[1];var optvalue=action[2];var opticon=action[3];var optid=action[4];var opttitle=action[5]}
if(optlabel.indexOf("-----")==0&&optlabel.lastIndexOf("-----")> 0){opticon='<i class="fas fa-caret-down"></i>';optlabel=optlabel.substring("-----".length);optlabel=optlabel.substring(0,optlabel.lastIndexOf("-----"));optlabel=optlabel.basicTrim();$ul.append('<div class="dropdown-header '+optvalue+'">'+opticon+' '+optlabel+'</div>')}
else {if(opticon.indexOf('<')!=0){opticon=$ZMI.icon(opticon)}
var html='';html+='<a class="dropdown-item" title="'+opttitle+'" href="javascript:$ZMI.actionList.exec($(\'li.zmi-item'+(id==''?':first':'#zmi_item_'+id)+'\'),\''+optlabel+'\',\''+optvalue+'\',\''+optid+'\')">';html+=opticon+' <span>'+optlabel+'</span>';html+='</a>';$ul.append(html)}}
if(typeof e!="undefined"&&$ul.innerHeight()<$(document).innerHeight()&&e.pageY>$ul.innerHeight()){$(el).addClass("dropup")}
$(".dropdown-header",$ul).click(function(event){var duration=(event.pageX&&event.pageY)? 400:0;$("i",this).toggleClass("fa-caret-down").toggleClass("fa-caret-right");$(this).nextUntil(".dropdown-header").slideToggle(duration);event.stopImmediatePropagation();event.stopPropagation()});$(el).removeClass("loading").addClass("loaded");$(document.body).css("cursor","auto");if(typeof cb=="function"){cb()}
}).fail(function(jqXHR){if(jqXHR.status===401){parent.window.location.reload()}
})}
ZMIActionList.prototype.out=function(el){$("button.split-left",el).css({visibility:"hidden"});var $button=$('button.btn.split-right.dropdown-toggle',el);$('*',$button).show()}
ZMIActionList.prototype.exec=function(sender,label,target,meta_id=''){var id_prefix=this.getContextId(sender);if(typeof id_prefix !='undefined'&&id_prefix !=''){id_prefix=id_prefix.replace(/(\d*?)$/gi,'')} else {id_prefix='e'}
var $el=$(".zmi-action",sender);var $fm=$(".zmi-action-form");var sort_id=$(".zmi-sort-id",$el).text();$("input[name='custom']").val(label);if(typeof sort_id!="undefined"&&sort_id.length>0&&!isNaN(sort_id)){$("input[name='_sort_id:int']").val(sort_id)}
if(target.toLowerCase().indexOf('manage_addproduct/')==0&&target.toLowerCase().indexOf('form')>0){var inputs=$("input:hidden",$fm);var data={};for(var i=0;i < inputs.length;i++){var $input=$(inputs[i]);var id=$input.attr("id");if(jQuery.inArray(id,['form_id','id_prefix','_sort_id','custom','lang','preview'])>=0){data[$input.attr('name')]=$input.val()}}
data['id_prefix']=id_prefix;var title='<i class="fas fa-plus-sign"></i> '+getZMILangStr('BTN_INSERT')+':&nbsp;'+label;if(meta_id!=''){data['meta_id']=meta_id}
$('<li id="manage_addProduct" class="zmi-item zmi-highlighted"><div class="center">'+title+'</div></li>').insertAfter($el.parents(".zmi-item"));$ZMI.iframe(target,data,{id:'zmiIframeAddDialog',title:title,width:800,open:function(event,ui){$ZMI.runReady();$('#addInsertBtn').click(function(){self.btnClicked=$(this).text();var $fm=$(".modal form.form-horizontal");$("input[name=btn]:hidden",$fm).remove();$fm.append('<input type="hidden" name="btn" value="BTN_INSERT">');$fm.submit()});$('#addCancelBtn').click(function(){zmiModal("hide")});if(['ZMSSqlDb','ZMSTable'].indexOf($('#ZMS_INSERT').val())==-1&&$('#zmiIframeAddDialog .form-group:not([class*="activity"]).form-control').length==0){$('#addInsertBtn').click()}
},close:function(event,ui){$('#manage_addProduct').remove()},buttons:[
{id:'addInsertBtn',text:getZMILangStr('BTN_INSERT'),name:'btn','class':'btn btn-primary'},{id:'addCancelBtn',text:getZMILangStr('BTN_CANCEL'),name:'btn','class':'btn btn-secondary'}
]
})}
else {var $div=$el.parents("div.right");var $input=$("input[name='ids:list']",$div);$input.prop("checked",true);zmiActionButtonsRefresh(sender);var params=$ZMI.parseURLParams(target);var target=target.indexOf("?")>0?target.substring(0,target.indexOf("?")):target;if(this.confirm($fm,target,params)){var c=0;for(var k in params){var id='hidden_'+k+'_'+c;$fm.append('<input type="hidden" id="'+id+'" name="'+k+'">');$('input#'+id,$fm).val(params[k]);c++}
$("input[name='id_prefix']",$fm).val(id_prefix);$("input[name='ids:list']",$fm).remove();$("input[name='ids:list']",$("div.right")).each(function(){if(this.checked)$fm.append(this)});$fm.attr("action",target);$fm.attr("method","POST");$fm.submit()}
else {$("input[name='ids:list']",$div).prop("checked",false);zmiActionButtonsRefresh(sender)}}}
ZMIActionList.prototype.confirm=function(fm,target,data){var b=true;var i=$("input[name='ids:list']:checkbox:checked").length;if(target.indexOf("../")==0){i=1}
if(target.indexOf("manage_rollbackObjChanges")>=0){var msg=getZMILangStr('MSG_ROLLBACKVERSIONCHANGES');msg=msg.replace("%i",""+i);b=confirm(msg)}
else if(target.indexOf("manage_cutObjects")>=0){var msg=getZMILangStr('MSG_CONFIRM_CUTOBJS')+$ZMI.getDescendantLanguages();msg=msg.replace("%i",""+i);b=i > 0&&confirm(msg)}
else if(target.indexOf("manage_eraseObjs")>=0){var msg=getZMILangStr('MSG_CONFIRM_DELOBJS');msg=msg.replace("%i",""+i);b=i > 0&&confirm(msg)}
else if(target.indexOf("manage_deleteObjs")>=0){var msg=getZMILangStr('MSG_CONFIRM_TRASHOBJS');msg=msg.replace("%i",""+i);msg+=$ZMI.getDescendantLanguages();b=i > 0&&confirm(msg)}
else if(target.indexOf("manage_undoObjs")>=0){var msg=getZMILangStr('MSG_CONFIRM_DISCARD_CHANGES');msg=msg.replace("%i",""+i);b=i > 0&&confirm(msg)}
else if(target.indexOf("manage_executeMetacmd")>=0){var msg=$.ajax({url:'getMetaCmdDescription',data:data,datatype:'text',traditional:true,async:false
}).responseText;if(typeof msg !='undefined'&&msg.length > 0){msg=msg.replace("%i",""+i);b=confirm(msg)}}
else if(target==""){b=false}
return b}
function zmiActionButtonsRefresh(sender,evt){$(".zmi-selectable").each(function(){if($(".right input:checked",this).length > 0){$(this).addClass("zmi-selected")}
else {$(this).removeClass("zmi-selected")}
})}
function zmiToggleSelectionButtonClick(sender,v){var $fm=$(sender).closest('form,.zmi-form-container');var $inputs=$('input:checkbox:not([id~="active"]):not([id~="attr_dc_coverage"])',$fm);if(typeof v=="undefined"){v=!$inputs.prop('checked')}
$inputs.prop('checked',v).change();zmiActionButtonsRefresh(sender)}
function zmiBrowseObjs(fmName,elName,lang,selectedLang){let title=getZMILangStr('CAPTION_CHOOSEOBJ');let href="manage_browse_iframe";let elValue='';if(fmName.length>0&&elName.length>0){$('form[name='+fmName+'] input[name="'+elName+'"]').each(function(){if($(this).parents('div.modal.show').length > 0){elValue=$(this).val();return false} else {elValue=$(this).val()}
})};href+='?lang='+lang;href+='&defaultLang='+lang;if(typeof selectedLang=="string"&&selectedLang.length > 0){href+='&selectedLang='+selectedLang}
href+='&fmName='+fmName;href+='&elName='+elName;href+='&elValue='+encodeURIComponent(elValue);if(typeof selectedText=="string"){href+='&selectedText='+encodeURIComponent(selectedText)}
zmiModal(null,{body:'<iframe src="'+href+'" style="width:100%;min-width:'+$ZMI.getConfProperty('zmiBrowseObjs.minWidth','200px')+';height:100%;min-height:'+$ZMI.getConfProperty('zmiBrowseObjs.minHeight','62vh')+';border:0;"></iframe>',title:title
});return false}
function zmiBrowseObjsApplyUrlValue(fmName,elName,elValue,elTitle){$('form[name='+fmName+'] input[name="'+elName+'"]').val(elValue).change();if(typeof elTitle !="undefined"){$('form[name='+fmName+'] input[name^=title]:text').each(function(){if($(this).val()==''){$(this).val(elTitle).change()}
})}}
function zmiDialogClose(){zmiModal("hide")}
function setInputSelection(e,selection){e.focus();if(e.setSelectionRange){e.setSelectionRange(selection.start,selection.end)} else if(e.createTextRange){e=e.createTextRange();e.collapse(true);e.moveEnd('character',selection.end);e.moveStart('character',selection.start);e.select()}}
function getInputSelection(el){var start=0,end=0,normalizedValue,range,textInputRange,len,endRange;if(typeof el.selectionStart=="number"&&typeof el.selectionEnd=="number"){start=el.selectionStart;end=el.selectionEnd} else {range=document.selection.createRange();if(range&&range.parentElement()==el){len=el.value.length;normalizedValue=el.value.replace(/\r\n/g,"\n");textInputRange=el.createTextRange();textInputRange.moveToBookmark(range.getBookmark());endRange=el.createTextRange();endRange.collapse(false);if(textInputRange.compareEndPoints("StartToEnd",endRange)>-1){start=end=len} else {start=-textInputRange.moveStart("character",-len);start+=normalizedValue.slice(0,start).split("\n").length-1;if(textInputRange.compareEndPoints("EndToEnd",endRange)>-1){end=len} else {end=-textInputRange.moveEnd("character",-len);end+=normalizedValue.slice(0,end).split("\n").length-1}}
}}
return {start:start,end:end
}}
var selectedInput=null;var selectedText={start:-1,end:-1};function untagSelected(tag,leftDelimiter,rightDelimiter){var v=$(selectedInput).val();var pre=v.slice(0,selectedText.start);var range=v.slice(selectedText.start,selectedText.end);var post=v.slice(selectedText.end);while(range.indexOf(" ")==range.length-1){range=range.slice(0,range.length-1);post=" "+post}
var tagName=tag.indexOf(" ")>0?tag.substring(0,tag.indexOf(" ")):tag;var startTag=leftDelimiter+tag+rightDelimiter;var startRe=new RegExp(leftDelimiter+tag+"(.*?)"+rightDelimiter,"gi");var endTag=leftDelimiter+"/"+tagName+rightDelimiter;var endRe=new RegExp(leftDelimiter+"/"+tag+rightDelimiter,"gi");var preMatch=pre.match(startRe);var postMatch=post.match(endRe);if(preMatch!=null&&postMatch!=null){var preMatch=preMatch[preMatch.length-1];var postMatch=postMatch[0];if(pre.endsWith(preMatch)&&post.startsWith(postMatch)){var newPre=pre.replace(preMatch,'');var newPost=post.replace(postMatch,'');$(selectedInput).val(newPre+range+newPost);var offset=newPre.length-pre.length;selectedText={start:selectedText.start+offset,end:selectedText.start+offset+range.length};setInputSelection(selectedInput,selectedText)}
return true}
return false}
function tagSelected(tag,leftDelimiter,rightDelimiter){var v=$(selectedInput).val();var pre=v.slice(0,selectedText.start);var range=v.slice(selectedText.start,selectedText.end);var post=v.slice(selectedText.end);while(range.indexOf(" ")==range.length-1){range=range.slice(0,range.length-1);post=" "+post}
var tagName=tag.indexOf(" ")>0?tag.substring(0,tag.indexOf(" ")):tag;var tagAttrs=tag.indexOf(" ")>0?tag.substring(tag.indexOf(" ")):"";if(tagName=='a'&&tagAttrs==''){if(range.indexOf("@")> 0){tagAttrs=' href="mailto:'+range+'"'}
else if(range.indexOf("://")> 0){tagAttrs=' href="'+range+'" target="_blank"'}}
if(tagName=='a'&&tagAttrs==''){zmiBrowseObjs('','',getZMILang())}
else {var startTag=leftDelimiter+tagName+tagAttrs+rightDelimiter;var endTag=leftDelimiter+"/"+tagName+rightDelimiter;var newRange=startTag+range+endTag;$(selectedInput).val(pre+newRange+post);var offset=startTag.length;selectedText={start:selectedText.start+offset,end:selectedText.start+offset+range.length};setInputSelection(selectedInput,selectedText);return true}
return false}
function formatSelected(tag,leftDelimiter,rightDelimiter){if(!untagSelected(tag,leftDelimiter,rightDelimiter)){tagSelected(tag,leftDelimiter,rightDelimiter)}}
function setTextFormatInput(tag,fmName,elName){self.fm=document.forms[ fmName];self.el=self.fm.elements[ elName];if(typeof self.el=='undefined'){self.el=document.getElementsByName(elName)[0]}
$('#'+elName).height(document.getElementById(elName).scrollHeight);formatSelected(tag,'<','>')}
function storeCaret(input){selectedInput=input;selectedText=getInputSelection(input)}
function zmiRecordSetMoveRow(context,qIndex,delta){var $form=$(context).closest('form');if(typeof qIndex !="undefined"){var $btnGroup=$(context).closest('.btn-group');var $input=$("input:checkbox:first",$btnGroup);$form.append('<input type="hidden" name="qindex:int" value="'+$input.val()+'">')}
$form.append('<input type="hidden" name="pos:int" value="'+(qIndex+1)+'">');$form.append('<input type="hidden" name="newpos:int" value="'+(qIndex+1+delta)+'">');$('input[name="action"]',$form).val('move');$form.submit()}
function zmiRecordSetDeleteRow(context,qIndex){var $form=$(context).closest('form');if(typeof qIndex !="undefined"){var $btnGroup=$(context).closest('.btn-group');var $input=$("input:checkbox:first",$btnGroup);$input.prop('checked',true).change()}
if(confirm(getZMILangStr('MSG_CONFIRM_DELOBJS').replace('%i',$("input[name='qindices:list']:checked").length))){$('input[name="action"]',$form).val('delete');$form.submit()}
else if(typeof qIndex !="undefined"){var $input=$('input[value="'+qIndex+'"]',$form);$input.prop('checked',false).change()}
return false}
function zmiRecordSetDuplicateRow(context,qIndex){var $form=$(context).closest('form');if(typeof qIndex !="undefined"){var $btnGroup=$(context).closest('.btn-group');var $input=$("input:checkbox:first",$btnGroup);$input.prop('checked',true).change()}
if(confirm(getZMILangStr('MSG_CONFIRM_DUPLICATEOBJS').replace('%i',$("input[name='qindices:list']:checked").length))){$('input[name="action"]',$form).val('duplicate');$form.submit()}
else if(typeof qIndex !="undefined"){var $input=$('input[value="'+qIndex+'"]',$form);$input.prop('checked',false).change()}
return false}
$ZMI.registerReady(function(){var hidWidth;var scrollBarWidths=40;var widthOfList=function(){var itemsWidth=0;$('.wrapper .nav.nav-tabs li').each(function(){var itemWidth=$(this).outerWidth();itemsWidth+=itemWidth});return itemsWidth};var widthOfHidden=function(){return(($('.wrapper').outerWidth())-widthOfList()-getLeftPosi())-scrollBarWidths};var getLeftPosi=function(){try {return $('.wrapper .nav.nav-tabs').position().left} catch(err){return 0
}
};var reAdjust=function(){if(($('.wrapper').outerWidth())< widthOfList()){$('.scroller-right').show()} else {$('.scroller-right').hide()}
if(getLeftPosi()<0){$('.scroller-left').show()} else {$('.item').animate({left:"-="+getLeftPosi()+"px"},'slow');$('.scroller-left').hide()}}
$('.scroller-right').click(function(){$('.scroller-left').fadeIn('slow');$('.scroller-right').fadeOut('slow');$('.wrapper .nav.nav-tabs').animate({left:"+="+widthOfHidden()+"px"},'slow',function(){})});$('.scroller-left').click(function(){$('.scroller-right').fadeIn('slow');$('.scroller-left').fadeOut('slow');$('.wrapper .nav.nav-tabs').animate({left:"-="+getLeftPosi()+"px"},'slow',function(){})});reAdjust();$(window).on('resize',function(e){reAdjust()})});function isScrolledIntoView(elem){var docViewTop=$(window).scrollTop();var docViewBottom=docViewTop+$(window).height();var elemTop=$(elem).offset().top;var elemBottom=elemTop+$(elem).height();return((elemBottom <=docViewBottom)&&(elemTop >=docViewTop))};$ZMI.registerReady(function(){const scrollToTopButton=document.getElementById('js-top');const stickyControls=document.getElementsByClassName('sticky-controls')[0];if(scrollToTopButton||stickyControls){window.onscroll=function(){let y=window.scrollY;if(y > 42&&scrollToTopButton){scrollToTopButton.className="back-to-top show"} else {scrollToTopButton.className="back-to-top hide"}
if(stickyControls!=undefined){if(!isScrolledIntoView(stickyControls)){stickyControls.classList.add('sticky-controls-activated')}
if(y==0){stickyControls.classList.remove('sticky-controls-activated')}}
};if(scrollToTopButton){scrollToTopButton.onclick=()=> {$('html,body').animate({scrollTop:0
},600);return false}}}});var zmiExpandConfFilesProgress=false;function zmiExpandConfFiles(el,pattern){if(!zmiExpandConfFilesProgress){if($("option",el).length==1){zmiExpandConfFilesProgress=true;$ZMI.setCursorWait("zmiExpandConfFiles");var first=null;if($("option",el).length==1){first=$("option:first",el).html();$("option:first",el).html(getZMILangStr('MSG_LOADING'))}
$.get('getConfFiles',{pattern:pattern},function(data){if(first!=null){$("option:first",el).html(first)}
Object.keys(data).map(k=>([k,data[k]])).sort((a,b)=>(a[1].localeCompare(b[1]))).forEach(option=> {$(el).append('<option value="'+option[0]+'">'+option[1]+'</option>')});zmiExpandConfFilesProgress=false;$ZMI.setCursorAuto("zmiExpandConfFiles")})}}}
ZMI.prototype.initUrlInput=function(context){var fn_url_input_each=function(){var $input=$(this);if(!$input.parent().hasClass('input-group')){var fmName=$input.parents("form").attr("name");var elName=$input.attr("name");$input.wrap('<div class="input-group"></div>');var $inputgroup=$input.parent();if($input.prop("disabled")){$inputgroup.append(`
<div class="input-group-append">
<span class="input-group-text"><i class="fas fa-ban"></i></span>
</div>`)} else {$inputgroup.append(`
<div class="input-group-append">
<a class="btn btn-secondary" href="javascript:;" onclick="return zmiBrowseObjs('${fmName}','${elName}',getZMILang(),getRefLang(this))">
<i class="fas fa-link"></i>
</a>
</div>`)}
var fn=function(){$inputgroup.next(".breadcrumb,[aria-label=breadcrumb]").remove();$.ajax({url:'zmi_breadcrumbs_obj_path',data:{lang:getZMILang(),zmi_breadcrumbs_ref_obj_path:$input.val()},datatype:'text',success:function(response){$inputgroup.next(".breadcrumb,[aria-label=breadcrumb]").remove();$inputgroup.after(response.replace(/<!--(.*?)-->/gi,'').trim())}
})};$input.change(fn).change()}}
$("input.url-input",context).each(fn_url_input_each);$("textarea.url-input",context).each(function(){var $input=$(this);var fmName=$input.parents("form").attr("name");var elName=$input.attr("name");var $container=$input.parent();$input.hide();$container.append(`
<div class="url-input-container"></div>
<input type="hidden" name="new_${elName}"/>
<a class="btn btn-secondary" href="javascript:;" onclick="return zmiBrowseObjs('${fmName}','new_${elName}',getZMILang(),getRefLang(this))">
<i class="fas fa-plus"></i>
</a>`);$("input[name='new_"+elName+"']",$container).change(function(){var v=$(this).val();var l=$input.val().length==0?[]:$input.val().split("\n");if(!l.contains()){l.push(v);$input.val(l.join("\n")).change()}
$(this).val("")});$input.change(function(){var v=$(this).val();var l=$input.val().length==0?[]:$input.val().split("\n");var $inputContainer=$(".url-input-container",$container);$inputContainer.html('');for(var i=0;i < l.length;i++){$inputContainer.append('<input class="form-control url-input" type="text" value="'+l[i]+'" disabled="disabled"> ')}
$("input.url-input",$inputContainer).each(fn_url_input_each);$(".input-group-append",$inputContainer).replaceWith('<div class="input-group-append"><a class="btn btn-secondary" href="javascript:;"><i class="fas fa-times"></i></a></div>');$("input.url-input",$inputContainer).next().click(function(){$(this).parents(".input-group").next(".breadcrumb").remove();$(this).parents(".input-group").remove();var l=[];$("input",$inputContainer).each(function(){var v=$(this).val();if(v.length > 0){l.push(v)}
});$input.val(l.join("\n")).change()})}).change()})}
ZMI.prototype.removeFromMultiselect=function(src){if(typeof src=="string"){src=document.getElementById(src)}
var selected=new Array();var index=0;while(index < src.options.length){if(src.options[index].selected){selected[index]=src.options[index].selected}
index++}
index=0;var count=0;while(index < selected.length){if(selected[index])src.options[count]=null;else
count++;index++}
sortOptions(src)}
ZMI.prototype.appendToMultiselect=function(src,data,defaultSelected){var label=data;var value=data;if(typeof data=="object"){label=data.label;value=data.value;if(data.orig){label=data.orig}}
if(typeof src=="string"){src=document.getElementById(src)}
for(var i=0;i < src.options.length;i++){if(src.options[i].value==value){return}}
if(typeof defaultSelected=="undefined"){defaultSelected=false}
var option=new Option(label,value,defaultSelected);src.options[ src.length]=option}
ZMI.prototype.selectFromMultiselect=function(fm,srcElName,dstElName){var src=fm.elements[srcElName];var dst=fm.elements[dstElName];var selected=new Array();var index=0;while(index < src.options.length){if(src.options[index].selected){var newoption=new Option(src.options[index].text,src.options[index].value,true,true);dst.options[dst.length]=newoption;selected[index]=src.options[index].selected}
index++}
index=0;var count=0;while(index < selected.length){if(selected[index])src.options[count]=null;else
count++;index++}
sortOptions(src);sortOptions(dst);return false}
ZMI.prototype.selectAllFromMultiselect=function(fm,srcElName,dstElName){var src=fm.elements[srcElName];var dst=fm.elements[dstElName];var index=0;while(index < src.options.length){src.options[index].selected=true;index++}
this.selectFromMultiselect(fm,srcElName,dstElName);return false}
function addOption(object,name,value,selectedValue){var defaultSelected=value.length > 0&&value==selectedValue;var selected=value.length > 0&&value==selectedValue;object.options[object.length]=new Option(name,value,defaultSelected,selected)}
function sortOptions(what){var copyOption=new Array();for(var i=0;i<what.options.length;i++)copyOption[i]=new Array(what[i].text,what[i].value);copyOption.sort();for(var i=what.options.length-1;i>-1;i--){what.options[i]=null}
for(var i=0;i<copyOption.length;i++)addOption(what,copyOption[i][0],copyOption[i][1])}
ZMI.prototype.set_form_modified=function(context,initialValue){let nowValue=$(context).val();if($(context).attr('id')!=undefined&&$(context).attr('id').indexOf('editor_')==0){nowValue=CKEDITOR.instances[$(context).attr('id')].getData()};const $body=$('body.zmi');const $btn_save=$('.controls.save button[value="BTN_SAVE"]',$(context).closest('form'));const $form=$(context).parents('form');const $formGroup=$(context).parents('.form-group');if(initialValue==undefined){initialValue=$(context).data('initial-value')};if(nowValue==initialValue){$formGroup.removeClass('form-modified')} else {$formGroup.addClass('form-modified')}
if($('.form-group.form-modified').length==0){$body.removeClass('form-modified');$btn_save.removeClass('btn-primary').addClass('btn-secondary')} else {$body.addClass('form-modified');$btn_save.removeClass('btn-secondary').addClass('btn-primary')}
if($('#form_modified',$form).length==0){$form.append('<input type="hidden" id="form_modified" name="form_modified:boolean" value="1">')}
}
ZMILocalStorageAPI=function(){};ZMILocalStorageAPI.prototype._clear=function(cb){for(var k in localStorage){if(!(k.indexOf("_")==0)){delete localStorage[k]}}}
ZMILocalStorageAPI.prototype.keys=function(){var l=[];for(var k in localStorage){l.push(k)}
l.sort();return l}
ZMILocalStorageAPI.prototype.get=function(k,d){var v=d;var l=this.keys();var done=[];for(var i=0;i < l.length;i++){var lsk=l[i];var nv=null;if(lsk.indexOf(k+".")==0){var nk=lsk.substring((k+".").length);if(nk.indexOf(".")> 0){nk=nk.substring(0,nk.indexOf("."));if($.inArray(k+"."+nk,done)<0){nv=$ZMILocalStorageAPI.get(k+"."+nk);done.push(k+"."+nk)}}
else {nv=localStorage[lsk]}
if(nv !=null){if(isNaN(nk)){if(typeof v=="undefined"){v={}}
v[nk]=nv}
else {if(typeof v=="undefined"){v=[]}
v.push(nv)}}}
else if(lsk==k){nv=localStorage[lsk];if(typeof nv !="undefined"){v=nv}}}
return v}
ZMILocalStorageAPI.prototype._set=function(k,v){if(typeof v=="object"){if(Array.isArray(v)){for(var i=0;i < v.length;i++){this._set(k+"."+i,v[i])}}
else {for(var i in v){this._set(k+"."+i,v[i])}}}
else {localStorage[k]=v}}
ZMILocalStorageAPI.prototype.set=function(k,v,r){this._set(k,v);if(r){self.location.reload()}}
ZMILocalStorageAPI.prototype._del=function(k){var l=this.keys();for(var i=0;i < l.length;i++){var lsk=l[i];if(lsk==k||lsk.indexOf(k+".")==0){delete localStorage[lsk]}}}
ZMILocalStorageAPI.prototype.del=function(k,r){this._del(k);if(r){self.location.reload()}}
ZMILocalStorageAPI.prototype.toggle=function(k,r){if(this.get(k,null)==null){this.set(k,"1",r)}
else {this.del(k,r)}}
ZMILocalStorageAPI.prototype.replace=function(k,v,r){this._del(k);this._set(k,v);if(r){self.location.reload()}}
$ZMILocalStorageAPI=new ZMILocalStorageAPI();
function add_new_row(this_btn){let $where_insert=$(this_btn).closest('tr');let table_id=$(this_btn).closest('table').attr('id').split('_').pop();let row_count=$('tbody tr',$(this_btn).closest('table')).length;let new_row_name=`new_row_${table_id}_${row_count}`;let old_id_html=(table_id=='languages')? '':`<input type="hidden" name="old_ids:list" value="new${row_count}">`;let new_btn_html=`
${old_id_html}
<span class="btn btn-secondary mr-1 w-100" style="color:#999"
title="Revoke New Row"
onclick="javascript:remove_row($(this))">
<i class="fas fa-undo-alt"></i>
</span>
`;let $new_row=$where_insert.clone(true);$new_row.find('td').each(function(){$(this).find('input,select,textarea').each(function(){$(this).removeAttr('disabled');$(this).removeAttr('id');let tag_name=$(this).prop('tagName').toLowerCase();let field_name=$(this).attr('name').split(':')[0];let field_type=$(this).attr('type');let new_field_value=`new${row_count}`;let new_field_name=`${field_name}_${new_field_value}`;if(field_name.slice(-1)=='0'&&!field_name.includes('_0_')){new_field_name=field_name.replace('0',row_count)} else if(field_name.includes('_0_')){new_field_name=field_name.replace('_0_',`_${row_count}_`)}
$(this).attr('name',new_field_name);if(!(tag_name=='select')){$(this).val(new_field_value)};if(tag_name=='input'&&field_type !='checkbox'){$(this).attr('placeholder',new_field_value)};if(field_type=='checkbox'){$(this).attr('name',`${new_field_name}:int`);$(this).val(1)};if($(this).hasClass('url-input')){$(this).closest('.input-group').replaceWith(`<input class="form-control url-input" name="${escapeHtml(new_field_name)}" placeholder="Select Url..."/>`)}})});$new_row.find('td.meta-sort').html(new_btn_html);$new_row.removeClass('row_insert').attr('id',new_row_name);$new_row.insertBefore($where_insert);$ZMI.set_form_modified($('.meta-id input',$new_row));$ZMI.initUrlInput($("td.meta-url",$new_row));$where_insert.find('input:not([type="checkbox"]),select,textarea').each(function(){$(this).val(undefined)});$('input,textarea,select','tr.row_insert').attr('disabled',true)};function remove_row(context){$ZMI.set_form_modified(context);$(context).closest('tr').hide('slow',function(){$(this).closest('tr').remove()});if($(context).closest('td').find('select').length > 0){renew_sort_options(this_table=$(context).closest('table'))}
};function renew_sort_options(this_table){let lang=getZMILang();$('tr[id*="new_row"]').each(function(){$(this).removeAttr('id')});let table_id=this_table.attr('id').split('_').pop();let $rows=$('tbody tr',this_table);let sort_options_len=$rows.length;let row_counter=0;$rows.each(function(){row_counter++;let sort_options_html=``;let old_id=$(this).find('td.meta-id input').attr('name');let old_id_html=(table_id=='languages')? '':`<input type="hidden" name="old_ids:list" value="${old_id}">`;for(let i=1;i < sort_options_len;i++){if(i==row_counter){sort_options_html+=`<option value="${i}" selected>${i}</option>`} else {sort_options_html+=`<option value="${i}">${i}</option>`}
};const new_btn_html=`
<div class="input-group input-group-sm">
${old_id_html}
<select class="zmi-sort form-control-sm"
onchange="zmiFormSubmit(this,{btn:'move_to',id:'${old_id}','pos:int':this.selectedIndex})">
${sort_options_html}
</select>
<div class="input-group-append">
<a class="btn btn-secondary" title="Delete Meta Attribute"
hx-get="manage_changeMetaProperties?btn=BTN_DELETE&target=zmi_manage_tabs_message&lang=${lang}&id=${old_id}"
hx-target="#zmi_manage_tabs_message"
hx-on:htmx:after-request="remove_row(this)">
<i class="fas fa-times"></i>
</a>
</div>
</div>
`;if(row_counter < sort_options_len){$(this).find('td.meta-sort').html(new_btn_html);htmx.process($(this).find('td.meta-sort')[0])}})};function get_lang_terms_count(){let lang_terms_count=0;let lang_dict_json=$.ajax({url:$ZMI.getBaseUrl()+'/get_lang_dict',async:false
}).responseJSON;$ZMI.setCachedValue('get_lang_dict',lang_dict_json);let lang_dict=ZMI.prototype.getCachedValue('get_lang_dict');if(lang_dict!='undefined'){if(typeof lang_dict=='object'){lang_terms_count=Object.keys(lang_dict).length} else {lang_terms_count=Object.keys(JSON.parse(lang_dict)).length}
};return lang_terms_count};const escapeHtml=(unsafe)=> {return unsafe
.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#039;')}