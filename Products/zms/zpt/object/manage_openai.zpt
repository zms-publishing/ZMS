<!DOCTYPE html>
<html lang="en" tal:define="standard modules/Products.zms/standard">
<head tal:replace="structure python:here.zmi_html_head(here,request)">zmi_html_head</head>
<body tal:attributes="
	data-root python:here.getRootElement().getHome().id;
	data-client python:here.getHome().id;
	id python:'zmsid_%s'%(here.id);
	class python:here.zmi_body_class(id='manage-menu')">
<header class="navbar navbar-nav navbar-expand navbar-dark flex-row bd-navbar">
	<a class="navbar-brand" target="_blank" title="OpenAI" 
		href="https://openai.com" target="_blank"><i class="fas fa-fingerprint"></i> OpenAI</a>
<style>
.message {
	color: #666;
	background-color: #ccc;
}
.reply {
	color: #333;
	background-color: #fff;
}
.error {
	color: #900;
	background-color: #fff;
	font-family: Courier Next,courier,monospace;
}
</style>
</header>

<div class="zmi-openai">
<div id="console"></div>
<div style="position: fixed; bottom: 0; width: 100%; background: white; padding: 10px; box-shadow: 0 -2px 5px rgba(0,0,0,0.1);">
	<textarea class="form-control" id="message" style="width: 100%;" placeholder="Enter your message to OpenAI here..."></textarea>
</div>
</div>

<tal:block tal:content="structure python:here.zmi_html_foot(here,request)">zmi_html_foot</tal:block>
<script>
$(function() {
	$('#message').on('keypress', function(e) {
		if (e.which === 13) { // Check if Enter key is pressed
			e.preventDefault(); // Prevent default behavior of Enter key
			const message = $(this).val();
			$.ajax({
				method: "GET",
				url: "++rest_api/openai_chat",
				dataType: "json",
				data: {message: message}})
			.always(function(reply) {
				if (reply.error) {
					$('#console').prepend('<div class="error">' + $('<div/>').text('['+reply.error.code+'] '+reply.error.message).html() + '</div>');
				}
				else {
					$('#console').prepend('<div class="reply">' + $('<div/>').text(reply.message.content).html() + '</div>');
				}
				$('#console').prepend('<div class="message">' + $('<div/>').text(message).html() + '</div>');
			});
			$(this).val('');
		}
	}).focus();
});
</script>
<script type="text/javascript" charset="UTF-8" src="/++resource++zms_/object/manage_openai.js"></script>
</body>
</html>